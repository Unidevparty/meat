<?xml version="1.0" encoding="utf-8"?>
<templates application="nexus" templategroups="a:1:{s:11:&quot;skin_nexus_&quot;;s:8:&quot;contains&quot;;}">
  <templategroup group="skin_nexus_clients">
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>
	<if test="empty($current)">{$this->lang->words['altcontacts_add']}<else />{$this->lang->words['altcontacts_edit_title']}</if>
</h2>
<form action='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=save" base="public"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	
	<ul class='ipsForm_vertical'>
		<li class='ipsField'>
			<label class='ipsField_title' for='name'>{$this->lang->words['altcontacts_enter_name']} <span class='ipsForm_required'>*</span></label>
			<p class='ipsField_content'><input name='name' class='input_text' id='name' size='40' value='{$current['members_display_name']}' /></p>
			<p class='desc'>
				{$this->lang->words['altcontacts_add_blurb']}<br />
				{parse expression="sprintf( $this->lang->words['altcontacts_create'], "<a href='{parse url="app=core&amp;module=global&amp;section=register" base="public"}'>{$this->lang->words['altcontacts_create_link']}</a>" )"}
			</p>
		</li>
		<li class='ipsField ipsField_select'>
			<label class='ipsField_title' for='name'>{$this->lang->words['altcontacts_purchases']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				<select name='purchases[]' multiple='multiple' class='full_width'>
					<foreach loop="purchases:$purchases as $p">
						<option value='{$p['ps_id']}' <if test="in_array( $p['ps_id'], explode( ',', $current['purchases'] ) )">selected='selected'</if>>{$p['ps_name']}</option>
					</foreach>
				</select>
			</div>
		</li>
		<li class='ipsField ipsField_checkbox'>
			<input type='checkbox' name='billing' id='billing' value='1' <if test="$current['billing']">checked='checked'</if> />
			<p class='ipsField_content'>
				<label for='billing'>{$this->lang->words['altcontacts_billing']}</label>
			<p>
		</li>
		<li class='ipsField ipsField_checkbox'>
			<input type='checkbox' name='support' id='support' value='1' <if test="$current['support']">checked='checked'</if> />
			<p class='ipsField_content'>
				<label for='support'>{$this->lang->words['altcontacts_support']}</label>
			<p>
		</li>
	</ul>
	<div class='controls padding'>
		<div class='buttons'>
			<input type='submit' class='button' value='{$this->lang->words['altcontacts_save_mini']}' />
		</div>
	</div>
</form>
<script type="text/javascript">
	ipb.nexus.setUpAltContacts();
</script>]]></template_content>
      <template_name>altContactForm</template_name>
      <template_data>$purchases, $current</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['altcontacts']}</h2>
<div class='master_list'>
	<if test="altContacts:|:count( $contacts )">
		<foreach loop="contacts:$contacts as $c">
			<div class='row touch-row'>
				<div class='icon'>
					<img src='{$c['pp_thumb_photo']}' class='photo' />
				</div>
				<div class='rowContent'>
					<a class='title' href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=edit&amp;id={$c['member_id']}&amp;k={$this->member->form_hash}" base="public"}'>{$c['members_display_name']}</a><br />
					<if test="$c['billing']"><span class='ipsBadge ipsBadge_light'>{$this->lang->words['altcontacts__billing']}</span></if> <if test="$c['support']"><span class='ipsBadge ipsBadge_light'>{$this->lang->words['altcontacts__support']}</span></if><br />
					<span class='desc'>{$c['purchases']}</span>
					
				</div>
			</div>
		</foreach>
	</if>
	<div class='controls'>
		<div class='buttons'>
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=add" base="public"}' class='button'>{$this->lang->words['altcontacts_add_mini']}</a>
		</div>
	</div>
</div>
<!--<a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=delete&amp;id={$c['member_id']}&amp;k={$this->member->form_hash}" base="public"}' class='cancel'>{$this->lang->words['altcontacts_remove']}</a>-->]]></template_content>
      <template_name>alternateContacts</template_name>
      <template_data>$contacts, $purchases</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['purchase_associate']}</h3>
<div class='master_list'>
	<foreach loop="options:$options as $p">
		<div class='row touch-row'>
			<if test="imageMargin:|:$p['img']">
				<div class='icon'>
					<img src='{$p['img']}' {parse resize_image="{$p['img']}" maxwidth="60" maxheight="60"} class='left' />
				</div>
			</if>
			<div class='rowContent'>
				<h4 class='product_title'>
					<a href='{parse url="app=nexus&module=clients&section=purchases&do=do_assoc&id={$purchase['ps_id']}&assoc={$p['ps_id']}&secure_key={$this->member->form_hash}" base="public"}'>{$p['ps_name']}</a>
					<if test="cancelled:|:$purchase['ps_cancelled']">
						<span class='negative desc'>({$this->lang->words['invoices_canc']})</span>
					<else />
						<if test="expired:|:!$purchase['ps_active']">
							<span class='zero desc'>({$this->lang->words['invoices_expd']})</span>
						</if>
					</if>
				</h4>
				<p>{$this->lang->words['purchased']}: <strong>{parse date="$p['ps_start']" format="joined"}</strong></p>
				<if test="expiryDate:|:$purchase['ps_expire']">
					<p>{$this->lang->words['expires']}: <strong>{parse date="$p['ps_expire']" format="joined" relative="false"}</strong></p>
				</if>
			</div>
		</div>
	</foreach>
</div>]]></template_content>
      <template_name>associate</template_name>
      <template_data>$purchase, $options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=hosting&amp;do=do_bandwidth" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='id' value='{$account['ps_id']}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['haccount_buy_bandwidth']}</h1>
		<br />
		<div class='ipsPad_double'>
			<select name='option'>
				<foreach loop="options:$options as $k => $v">
					<option value='{$k}'>{$v}</option>
				</foreach>
			</select>
		</div>
	</div>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['haccount_buy_bandwidth']}' class='input_submit' />
	</fieldset>
</form>]]></template_content>
      <template_name>buyBandwidth</template_name>
      <template_data>$options, $account</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['cancel_title'], $purchase['ps_name'] )"}</h2>
<p class='message error'>
	{$this->lang->words['cancel_blurb']}
	<if test="hasGroupedChildren:|:$hasGroupedChildren">
		<br />
		{$this->lang->words['cancel_g_blurb']}
	</if>
</p>
<fieldset class='submit'>
	<a class='button' href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=do_cancel&amp;id={$purchase['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['purchase_cancel']}</a>&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
</fieldset>]]></template_content>
      <template_name>cancel</template_name>
      <template_data>$purchase, $hasGroupedChildren</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>cfield</template_name>
      <template_data>$field, $extra, $name, $editable</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=hosting&amp;do=do_password" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='id' value='{$account['ps_id']}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['haccount_change_password']}</h1>
		<br />
		<ul class='ipsForm ipsForm_horizontal'>
			<li class='ipsField'>
				<label for='option' class='ipsField_title'>{$this->lang->words['haccount_password']}</label>
				<p class='ipsField_content'>
					<input name='password' id='password' value='{$account['account_password']}' type='text' class='input_text' size='40' maxlength='255' />
				</p>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['personal_info_save']}' class='input_submit' />
	</fieldset>
</form>]]></template_content>
      <template_name>changeHostingPassword</template_name>
      <template_data>$account</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.mobile.nexus.js'></script>
<script type='text/javascript'>
	nexus.clientArea.init();
</script>
<php>
	$active = array();		
	$sections = array('purchases', 'invoices', 'support', 'altcontacts', 'payouts', 'donations', 'referrals');
	
	if( in_array( $this->request['section'], $sections ) )
	{
		$active = array('section' => $this->request['section'], 'text' => $this->request['section']);
	}
	else if( $this->request['section'] == 'info' )
	{
		$active = array('section' => 'info', 'text' => 'personal_info');
	}
	else if( $this->request['section'] == 'splash' )
	{
		$active = array('section' => 'splash', 'text' => 'overview');
	}
	else if( $this->request['module'] == 'support' )
	{
		$active = array('section' => 'support', 'text' => 'support');
	}
</php>			
<div class='ipsNavRow padding'>
	<div class='ipsNavOption'>
		<a href='#' id='nexus_nav_toggle'>{$this->lang->words[ $active['text'] ]}</a>
	</div>
</div>
<ul id='nexus_nav_menu' class='ipsNavMenu' style='display: none'>
	<if test=loggedIn:|:"$this->memberData['member_id']">
		<li <if test="splashActive:|:$this->request['section'] == 'splash'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients" base="public"}'>{$this->lang->words['overview']}</a></li>
		<li <if test="purchasesActive:|:$this->request['section'] == 'purchases' or $this->request['section'] == 'hosting'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases" base="public"}'>{$this->lang->words['purchases']}</a></li>
		<li <if test="invoicesActive:|:$this->request['section'] == 'invoices'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices" base="public"}'>{$this->lang->words['invoices']}</a></li>
	</if>
	<if test="supportOn:|:!empty( $this->caches['support_departments'] )">
		<li <if test="supportActive:|:$this->request['module'] == 'support'">class='active'</if>><a href='{parse url="app=nexus&amp;module=support" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['support']}</a></li>
		<if test="loggedInAlt:|:$this->memberData['member_id']">
			<li <if test="altActive:|:$this->request['section'] == 'altcontacts'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts" base="public"}'>{$this->lang->words['altcontacts']}</a></li>
		</if>
	</if>
	<if test="hasCredit:|:$this->memberData['member_id'] and $this->memberData['cm_credits'] and $this->settings['nexus_payout']">
		<li <if test="payoutsActive:|:$this->request['section'] == 'payouts'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=payouts" base="public"}'>{$this->lang->words['credit']}</a></li>
	</if>
	<if test="donationsOn:|:!empty( $this->caches['donation_goals'] )">
		<li <if test="donationsActive:|:$this->request['section'] == 'donations'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=donations" base="public"}'>{$this->lang->words['donations']}</a></li>
	</if>
	<!--<if test="referralsOn:|:$this->memberData['member_id'] and $this->settings['cm_ref_on']">
		<li <if test="referralsActive:|:$this->request['section'] == 'referrals'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=referrals" base="public"}'>{$this->lang->words['referrals']}</a></li>
	</if>-->
	<if test="billingInfoOn:|:$this->memberData['member_id'] and !$this->settings['nexus_hide_info']">
		<li <if test="billingActive:|:$this->request['section'] == 'info'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=info" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['personal_info']}</a></li>
	</if>
</ul>
{$rightBar}
{$content}]]></template_content>
      <template_name>clientarea</template_name>
      <template_data><![CDATA[$content, $rightBar='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>credit</template_name>
      <template_data>$errors, $gateways, $pendingPayouts, $maxCredit</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['donations']}</h2>
<if test="errorMessage:|:$this->request['error']">
	<p class='message error'>
		{parse expression="sprintf( $this->lang->words['donations_error'], "{$this->settings['nexus_currency']}" )"}
	</p>
</if>
<div class='master_list'>
	<foreach loop="goals:$goals as $goal">
		<div class='row'>
			<h4>{$goal['d_name']}</43>
			<p>{$goal['d_desc']}</p>
			
			<if test="hasGoal:|:$goal['d_goal']">
				<table>
					<tr>
						<td width='{$goal['percent']}%' style='background-color:#225985' nowrap='nowrap'></td>
						<td width='{$goal['left']}%' style='background-color:#d8dde8' nowrap='nowrap'></td>
					</tr>
				</table>
				<p class='desc' style='padding: 2px'>{parse expression="sprintf( $this->lang->words['donations_progress'], "{parse currency="$goal['d_current']"}", "{parse currency="$goal['d_goal']"}" )"}</p>
			</if>
			
			<br />
			<form action='{parse url="app=nexus&amp;module=payments&amp;section=donate" base="public"}' method='post'>
				<input type='hidden' name='goal' value='{$goal['d_id']}' />
				{$this->lang->words['donations_donate_enter']} <input name='amount' class='input_text' /> <input type='submit' class='button' value='{$this->lang->words['donations_donate']}' />
			</form>
		</div>
	</foreach>
</div>]]></template_content>
      <template_name>donations</template_name>
      <template_data>$goals</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['donations_thanks']}</h3>
<p class='message'>{$this->lang->words['donations_received']}</p>
<if test="hasGoal:|:$goal['d_goal']">
	<div class='master_list'>
		<div class='row'>
			<table>
				<tr>
					<td width='{$goal['percent']}%' style='background-color:#225985' nowrap='nowrap'></td>
					<td width='{$goal['left']}%' style='background-color:#d8dde8' nowrap='nowrap'></td>
				</tr>
			</table>
			<p class='desc' style='padding: 2px'>{parse expression="sprintf( $this->lang->words['donations_progress'], "{parse currency="$goal['d_current']"}", "{parse currency="$goal['d_goal']"}" )"}</p>
		</div>
	</div>
</if>]]></template_content>
      <template_name>donations_thanks</template_name>
      <template_data>$goal</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['cancel_title'], $purchase['ps_name'] )"}</h2>
<p class='message error'>{$this->lang->words['gr_cancel_blurb']}</p>
<fieldset class='submit'>
	<a class='button' href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=do_gr_cancel&amp;id={$purchase['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['purchase_cancel']}</a>&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
</fieldset>]]></template_content>
      <template_name>grcancel</template_name>
      <template_data>$purchase</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['client_area']}</h2>
<if test="pendingInvoices:|:!empty($invoices)">
	<h3 class='inline_header'>{$this->lang->words['status_pend']}</h3>
	<div class='master_list alternate'>
		<foreach loop="invoices:$invoices as $invoice">
			<div class='row touch-row'>
				<strong><a class='title' href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}'>{IPSText::truncate( $invoice['i_title'], 35 )}</a></strong>
				<br />
				<span class='desc'>{parse currency="$invoice['i_total']"}</span>
			</div>
		</foreach>
	</div>
</if>
<if test="openSupportRequests:|:!empty($requests)">
	<h3 class='inline_header'>{$this->lang->words['sr_open']}</h3>
	<div class='master_list alternate'>
		<foreach loop="requests:$requests as $request">
			<div class='row touch-row <if test="$request['_isUnread']">unread</if>'>
				<a class='title' href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="public"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a>
				<br />
				<span class='ipsBadge ipsBadge_default'>{$request['r_status_text']}</span> &nbsp;<span class='desc'>{$request['r_department_text']} &middot; {parse date="$request['r_last_reply']" format="joined"}</span>
			</div>
		</foreach>
	</div>
</if>
<!--	
<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['ca_welcome'], $name )"}</h1>
	<br />
	<p class='ipsType_pagedesc'>{$ca_home}</p>
	<br />
	<if test="pendingInvoices:|:!empty($invoices)">
		<div class='maintitle'>{$this->lang->words['status_pend']}</div>
		<table class='ipb_table' style='margin-bottom:25px'>
			<foreach loop="invoices:$invoices as $invoice">
				<tr>
					<td class='short' style='width: 50px'><span class='desc'>#{$invoice['i_id']}</span></td>
					<td>
						<a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}'><strong>{$invoice['i_title']}</strong></a><br />
						<span class='desc'>{parse date="$invoice['i_date']" format="long"}</span>
					</td>
					<td style='text-align: right; min-width: 100px'>
						<if test="invoiceIsPayable:|:$invoice['i_status'] == 'pend' or $invoice['i_status'] == 'expired'">
							<if test="paymentHeld:|:$invoice['t_id']">
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=receive&amp;do=check&amp;id={$invoice['t_id']}&amp;ac=1" base="{$this->settings['nexus_https']}"}'>{$this->lang->words[ 'invoice_list_' . $invoice['t_status'] ]}</a>
							<else />
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}' class='input_submit'>{$this->lang->words['invoices_pay']}</a>
							</if>
						</if>
					</td>
					<td style='text-align: right; width: 10%; font-size: 16px;'>
						{parse currency="$invoice['i_total']"}
					</td>
				</tr>
			</foreach>
		</table>
	</if>
	<if test="openSupportRequests:|:!empty($requests)">
		<div class='maintitle'>{$this->lang->words['sr_open']}</div>
		<table class='ipb_table topic_list' style='margin-bottom:25px'>
			<tr class='header'>
				<th>&nbsp;</th>
				<th>{$this->lang->words['support_title']}</th>
				<th>{$this->lang->words['support_last_reply']}</th>
				<th>{$this->lang->words['support_status']}</th>
			</tr>
			<foreach loop="requests:$requests as $request">
				<tr class='__topic <if test="$request['_isUnread']">unread</if>'>
					<td class='col_f_icon altrow short'><if test="$request['_isUnread']"><img src='{$this->settings['img_url']}/t_new.png' /></if></td>
					<td>
						<if test="!$request['r_status_open'] && !$request['r_status_locked']">
							<strong><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="public"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a></strong>
						<else />
							<a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="public"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a>
						</if>
						<br />
						<span class='desc'>{$request['r_department_text']}</span>
					</td>
					<td class='desc'>{parse date="$request['r_last_reply']" format="joined"}</td>
					<td>
						{$request['r_status_text']}
					</td>
				</tr>
			</foreach>
		</table>
	</if>
</div>-->]]></template_content>
      <template_name>home</template_name>
      <template_data>$name, $invoices, $requests, $ca_home</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsFilterBar four_filters clearfix'>
	<ul>
		<li class='<if test="pendActive:|:$this->request['status'] == 'pend' or !$this->request['status']">selected</if>' id='t_pend'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=pend" base="public"}'>{$this->lang->words['invoices_pend']}</a></li>
		<li class='<if test="paidActive:|:$this->request['status'] == 'paid'">selected</if>' id='t_paid'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=paid" base="public"}'>{$this->lang->words['invoices_paid']}</a></li>
		<li class='<if test="expdActive:|:$this->request['status'] == 'expd'">selected</if>' id='t_expd'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=expd" base="public"}'>{$this->lang->words['invoices_expd']}</a></li>
		<li class='<if test="cancActive:|:$this->request['status'] == 'canc'">selected</if>' id='t_canc'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=canc" base="public"}'>{$this->lang->words['invoices_canc']}</a></li>
	</ul>
</div>]]></template_content>
      <template_name>invoiceFilters</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>networkStatus</template_name>
      <template_data>$offline, $message</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['payout_request']}</h1>
	<br />
	<p class='ipsType_pagedesc'>
		{$this->lang->words['payouts_info']}
	</p>
	<br />
	<form action='' method='post' id='payout_request'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
		<input type='hidden' name='gateway' value='{$gateway}' />
		<ul>
		<foreach loop="settings:$settings as $k => $data">
			<li class='field'>
				<label for='f_{$k}'>{$data['title']}</label>
				<if test="isTextInput:|:$data['type'] == 'formInput'">
					<input name='data[{$k}]' id='f_{$k}' class='input_text' size='30' />
				<else />
					<if test="isTextArea:|:$data['type'] == 'formTextarea'">
						<textarea name='data[{$k}]' class='input_text' rows='4' cols='30'></textarea>
					</if>
				</if>
				<if test="hasDesc:|:$data['desc']">
					<span class='desc'>{$data['desc']}</span>
				</if>
			</li>
		</foreach>
		</ul>
		<br />
		
		<input type='submit' class='input_submit' value='{$this->lang->words['payouts_submit']}' />&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=payouts" base="public"}' title='{$this->lang->words['cancel']}' class='cancel'>{$this->lang->words['cancel']}</a>
	</form>
</div>]]></template_content>
      <template_name>payoutInfo</template_name>
      <template_data>$settings, $gateway</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['personal_info']}</h2>
<form action='{parse url="app=nexus&amp;module=clients&amp;section=info&amp;do=save" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<div class='ipsExpanderList' id='customer_info'>
		<if test="cardMethods:|:!empty( $cardMethods )"><h2 class='ipsExpanderList_trigger' data-pane='info'><span></span>Personal Information</h2></if>
		<div class='ipsExpanderList_pane' id='expander_pane_info'>
			<ul class='ipsForm ipsForm_vertical'>
				<foreach loop="fields:$fields as $f">
					<if test="isText:|:$f['f_type'] == 'text' and $f['f_column'] != 'cm_address_2'">
						<li class='ipsField'>
							<if test="isAddress:|:$f['f_column'] == 'cm_address_1'">
								<label for='{$f['f_column']}' class='ipsField_title'>{$this->lang->words['cm_address']}</label>
								<div class='ipsField_content'>
									<input type='text' class='input_text' id='{$f['f_column']}' size='40' maxlength='255' value='{$member[ $f['f_column'] ]}' name='{$f['f_column']}' /><br />
									<input type='text' class='input_text' id='cm_address_2' size='40' maxlength='255' value='{$member['cm_address_2']}' name='cm_address_2' style='margin-top: 4px' />
								</div>
							<else />
								<label for='{$f['f_column']}' class='ipsField_title'>{$f['f_name']}</label>
								<p class='ipsField_content'>
									<input type='text' class='input_text' id='{$f['f_column']}' size='40' maxlength='255' value='{$member[ $f['f_column'] ]}' name='{$f['f_column']}' />
								</p>
							</if>
						</li>
					</if>
					<if test="isDropdown:|:$f['f_type'] == 'dropdown'">
						<li class='ipsField ipsField_select'>
							<label for='{$f['f_column']}' class='ipsField_title'>{$f['f_name']}</label>
							<div class='ipsField_content'>
								<select name='{$f['f_column']}' class='full_width' id='{$f['f_column']}' <if test="isCountry:|:$f['f_column'] == 'cm_country'">onchange='states()'</if>>
									<foreach loop="options:explode( "\n", $f['f_extra'] ) as $k => $v">
										{parse variable="selected" default="" oncondition="$v == $member[ $f['f_column'] ] or $k == $member[ $f['f_column'] ]" value=" selected='selected'"}
										<option value='<if test="isCountrySelect:|:$f['f_column'] == 'cm_country'">{$v}<else />{$k}</if>'{parse variable="selected"}><if test="isCountryWords:|:$f['f_column'] == 'cm_country'">{$this->lang->words['nc_'.$v]}<else />{$v}</if></option>
									</foreach>
								</select>
							</div>
						</li>
					</if>
					<if test="isSpecial:|:$f['f_type'] == 'special'">
						<li class='ipsField ipsField_select'>
							<label for='cm_state'  class='ipsField_title'>{$this->lang->words['cm_state']}</label>
							<div class='ipsField_content'>
								<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$member['cm_state']}' />
								<foreach loop="statesSelect:$states as $country => $_states">
									<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
										<foreach loop="states:$_states as $s">
											{parse variable="selected" default="" oncondition="$s[0] == $member['cm_state']" value=" selected='selected'"}
											<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
										</foreach>
									</select>
								</foreach>
							</div>
						</li>
					</if>
				</foreach>
			</ul>
		</div>
		<if test="cardMethods:|:!empty( $cardMethods )">
			<h2 class='ipsExpanderList_trigger' data-pane='card'><span></span>Payment Cards</h2>
			<div class='ipsExpanderList_pane' id='expander_pane_card'>
				<ul class='ipsForm ipsForm_vertical'>
					<li class='ipsField'>
						<label class='ipsField_title'>{$this->lang->words['checkout_card_number']}</label>
						<p class='ipsField_content'>
							<input type='text' class='input_text' id='card_number' size='40' maxlength='255' value='{$card}' <if test="showFieldNameCredit:|:$showFieldNames">name='card_number'</if> />
						</p>
					</li>
					<li class='ipsField ipsField_select'>
						<label class='ipsField_title'>{$this->lang->words['checkout_card_expire']}</label>
						<div class='ipsField_content'>
							<select <if test="showFieldNameExpireMonth:|:$showFieldNames">name='exp_month'</if> id='exp_month' class='input_select'>
								<option value='00'></option>
								<option value='01'>01</option>
								<option value='02'>02</option>
								<option value='03'>03</option>
								<option value='04'>04</option>
								<option value='05'>05</option>
								<option value='06'>06</option>
								<option value='07'>07</option>
								<option value='08'>08</option>
								<option value='09'>09</option>
								<option value='10'>10</option>
								<option value='11'>11</option>
								<option value='12'>12</option>
							</select>
							<select <if test="showFieldNameExpireYear:|:$showFieldNames">name='exp_year'</if> id='exp_year' class='input_select'>
								<option value='0'></option>
								<foreach loop="years:range( date('Y'), date('Y')+10 ) as $y">
									<option value='$y'>$y</option>
								</foreach>
							</select>
						</div>
					</li>
					<li class='ipsField'>
						<label class='ipsField_title'>{$this->lang->words['checkout_card_cvv2']}</label>
						<p class='ipsField_content'>
							<input type='text' class='input_text' id='code' size='6' maxlength='4' value='' <if test="showFieldNameCardCode:|:$showFieldNames">name='card_code'</if> />  <img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' /><br />
							<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>
						</p>
					</li>
					<if test="oneMethod:|:count( $cardMethods ) == 1">
						<input type='hidden' name='card_method' value='{$cardMethods[0][0]}' />
					<else />
						<li class='ipsField ipsField_select'>
							<label class='ipsField_title'>{$this->lang->words['checkout_card_type']}</label>
							<div class='ipsField_content'>
								<select name='card_method' id='cc_method' class='input_select'>
									<foreach loop="cardMethods:$cardMethods as $m">
										<option value='{$m[0]}'>{$m[1]}</option>
									</foreach>
								</select>
							</div>
						</li>
					</if>
				</ul>
			</div>
		</if>
	</div>
	<script type='text/javascript'>
		$('customer_info').expandify( { defaultTrigger: 'info' } );
	</script>	
	<div class='controls padding'>
		<div class='buttons'>
			<input type='submit' value='{$this->lang->words['personal_info_save']}' class='button' />
		</div>
	</div>
</form>
<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
</script>

<script type='text/javascript'>
	function states()
	{
		var s = $('text-states').value.toLowerCase();
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			_display = c + '-states';
			$( c + '-states' ).select('option').each ( function ( elem ) {
				if ( elem.value.toLowerCase() == s || elem.innerHTML.toLowerCase() == s )
				{
					elem.selected = true;
				}
			} );
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
</script>]]></template_content>
      <template_name>personalInfo</template_name>
      <template_data>$fields, $member, $states, $card, $cardMethods, $showFieldNames, $stripeData</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<meta charset="{$this->settings['gb_char_set']}" />
<style media='screen, print' type='text/css'>
	body {
		font-family: Helvetica, sans-serif;
	}
</style>
<div style='background-color: #F7FBFC'>
	<div style='text-align: center; font-size: 1.5em'>
		{parse expression="sprintf( $this->lang->words['gv_title'], $this->settings['board_name'] )"}
		<div style='font-size: 3em'>
			{parse currency="$data['amount']"}
		</div>
	</div>
</div>
	<div style='text-align: center; margin-top: 50px;'>
		<if test="$data['message']">
			<if test="$data['recipient_name']">
				{$data['recipient_name']},<br /><br />
			</if>
			{$data['message']}<br /><br /><br />
			<if test="$data['sender']">
				{$data['sender']}
			</if>
		</if>
	</div>
	<div style='background-color: #F7FBFC; padding: 5px; text-align: center; margin-top: 50px;'>
		<strong>{$this->lang->words['gv_redeem_code']}:<br />{$purchase['ps_id']}{$data['code']}</strong>
		<br /><br />
		{parse expression="sprintf( $this->lang->words['gv_redeem_url'], $this->registry->output->buildSeoUrl( 'app=nexus&amp;module=payments&amp;do=redeem', 'public', 'redeem', 'redeem' ) )"}
	</div>]]></template_content>
      <template_name>printGiftVoucher</template_name>
      <template_data>$purchase, $data</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset={$this->settings['gb_char_set']}" />
		<title>{parse expression="sprintf( $this->lang->words['invoice_number'], $invoice['i_id'] )"}: {$invoice['i_title']}</title>
		
		<style type="text/css">
		body {
		  font-family:Tahoma;
		}
		
		#page {
		  width:800px;
		  margin:0 auto;
		  padding:15px;
		
		}
		
		table {
		  width:100%;
		}
		
		td {
		padding:5px;
		}
		</style>
		
	</head>
	
	<body>
		<div id="page">
		
			<div>
				<div style='float:left'>
					<h1>{parse expression="sprintf( $this->lang->words['invoice_number'], $invoice['i_id'] )"}: {$invoice['i_title']}</h1>
					<if test="hasPo:|:$invoice['i_po']">
						<strong>{$this->lang->words['invoice_po']}: {$invoice['i_po']}</strong>
						<br /><br />
					</if>
					<strong>{$this->lang->words[ 'invoices_' . $invoice['i_status'] ]}</strong>
				</div>
				
				<div style='float:right'>
					{$header}
					<br /><br />
					{parse date="$invoice['i_date']" format="date", relative="false"}
				</div>
				
				<br style='clear:both' />
				
				</div>
		
			<p>
				{$member['cm_first_name']} {$member['cm_last_name']}<br />
				{$member['cm_address_1']}<br />
				<if test="addressLine2:|:$member['cm_address_2']">{$member['cm_address_2']}<br /></if>
				{$member['cm_city']}<br />
				<if test="state:|:$member['cm_state']">{$member['cm_state']}<br /></if>
				{$member['cm_zip']}<br />
				{$member['cm_country']}<br />
			</p>
			
			<hr />
			
			<div id='content'>
			    <table>
					<tr>
						<td style='font-weight:bold'>{$this->lang->words['item']}</td>
						<td style='font-weight:bold'>{$this->lang->words['cart_unit']}</td>
						<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
						<td style='font-weight:bold'>{$this->lang->words['cart_line']}</td>
					</tr>
					<foreach loop="items:$invoice['items'] as $item">
						<tr>
							<td>
								{$item['itemName']}
							</td>
							<td>
								{$item['cost']}
							</td>
							<td>
								{$item['quantity']}
							</td>
							<td>
								{$item['line']}
							</td>
						</tr>
					</foreach>
					<tr style='font-weight: bold'>
						<td style='text-align: right' colspan='3'>{$this->lang->words['store_subtotal']}</td>
						<td>{$invoice['subtotal']}</td>
					</tr>
					<if test="discount:|:$invoice['i_discount']">
						<tr style='font-weight: bold'>
							<td style='text-align: right' colspan='3'>{$invoice['i_discount']}% {$this->lang->words['store_bundle_discount']}</td>
							<td>{$invoice['discount_amount']}</td>
						</tr>
					</if>
					<if test="tax:|:$invoice['tax']">
						<tr style='font-weight: bold'>
							<td style='text-align: right' colspan='3'>{$this->lang->words['store_tax']}</td>
							<td>{parse currency="$invoice['tax']"}</td>
						</tr>
					</if>
					<tr style='font-weight: bold'>
						<td style='text-align: right' colspan='3'>{$this->lang->words['store_total']}</td>
						<td><strong>{$invoice['i_total']}</strong></td>
					</tr>
				</table>
				<hr />
				<if test="notes:|:$invoice['i_notes']">
					<p style='text-align: center'>{$invoice['i_notes']}</p>
					<hr />
				</if>
				<if test="footer:|:$footer">
					<p style='text-align: center'>{$footer}</p>
					<hr />
				</if>
		  </div>
		</div>
	</body>
</html>]]></template_content>
      <template_name>printInvoice</template_name>
      <template_data>$invoice, $member, $header, $footer</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='row touch-row'>
	<if test="imageMargin:|:$purchase['img']">
		<div class='icon'>
			<img src='{$purchase['img']}' {parse resize_image="{$purchase['img']}" maxwidth="60" maxheight="60"} class='left' />
		</div>
	</if>
	<div class='rowContent'>
		<h4 class='product_title'>
			<if test="link:|:$purchase['ps_item_uri']">
				<a href='{parse url="{$purchase['ps_item_uri']}" base="public"}'>{$purchase['ps_name']}</a>
			<else />
				<if test="hideLink:|:$purchase['hide_link']">
					{$purchase['ps_name']}
				<else />
					<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}'>{$purchase['ps_name']}</a>
				</if>
			</if>
			<if test="cancelled:|:$purchase['ps_cancelled']">
				<span class='negative desc'>({$this->lang->words['invoices_canc']})</span>
			<else />
				<if test="expired:|:!$purchase['ps_active']">
					<span class='zero desc'>({$this->lang->words['invoices_expd']})</span>
				</if>
			</if>
		</h4>
		<p>{$this->lang->words['purchased']}: <strong>{parse date="$purchase['ps_start']" format="joined"}</strong></p>
		<if test="expiryDate:|:$purchase['ps_expire']">
			<p>{$this->lang->words['expires']}: <strong>{parse date="$purchase['ps_expire']" format="joined" relative="false"}</strong></p>
		</if>
		<if test="lkey:|:$purchase['lkey_key']">
			<br />
			<p><img src='{$this->settings['img_url']}/nexus/lkey.png' alt='{$this->lang->words['nexus_lkey']}' title='{$this->lang->words['nexus_lkey']}' /> <span class='desc'>{$purchase['lkey_key']}</span></p>
		</if>
	</div>
</div>
<if test="hasChildren:|:is_array( $parentMap[ $purchase['ps_id'] ] )">
	<foreach loop="children:$parentMap[ $purchase['ps_id'] ] as $child">
		{parse template="purchaseRow" group="nexus_clients" params="$purchases[ $child ], $parentMap, $purchases"}
	</foreach>
</if>]]></template_content>
      <template_name>purchaseRow</template_name>
      <template_data>$purchase, $parentMap, $purchases</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=do_reactivate&amp;id={$purchase['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' method='post'>
<h2 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['reactivate_title'], $purchase['ps_name'] )"}</h2>
<ul class='ipsForm ipsForm_vertical'>
	<li class='ipsField ipsField_select'>
		<label class='ipsField_title'>{$this->lang->words['reactivate_terms']}</label>
		<div class='ipsField_content'>
			<select name='renewals'>
				<foreach loop="$renewOptions as $k => $v">
					<option value='{$k}'>{$v}</option>
				</foreach>
			</select>
		</div>
	</li>
</ul>
<fieldset class='submit'>
	<input type='submit' class='button' value='{$this->lang->words['purchase_reactivate']}' />&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
</fieldset>
</form>]]></template_content>
      <template_name>reactivate</template_name>
      <template_data>$purchase, $renewOptions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>reactivateWithSiblings</template_name>
      <template_data>$purchase, $siblings</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>referrals</template_name>
      <template_data>$banners, $blurb, $url, $rules</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;id={$purchase['ps_id']}&amp;do=do_renew" base="public"}' method='post'>
<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<h2>{parse expression="sprintf( $this->lang->words['renew_title'], $purchase['ps_name'] )"}</h2>
	<ul class='ipsForm ipsForm_vertical'>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['renew_length']}</label>
			<div class='ipsField_content'>
				<select name='cycles'>
					<foreach loop="$options as $k => $v">
						<option value='{$k}'>{$v}</option>
					</foreach>
				</select>
			</div>
		</li>
	</ul>
	<fieldset class='submit'>
		<input type='submit' class='button full_width' value='{$this->lang->words['purchase_renew']}' />
	</fieldset>
</form>]]></template_content>
      <template_name>renewForm</template_name>
      <template_data>$purchase, $options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['your_purchases']}</h1>
	<br />
	<p class='ipsType_pagedesc'>
		{$this->lang->words['purchases_renew_blurb']}
	</p>
	<br />
	<ul class='nexus_block_list' id='package_change'>
		<foreach loop="options:$purchases as $p">
			<li class='clear clearfix row2'>
				<div style='margin-left: 55px'>
					<h3><a href='{parse url="app=nexus&module=clients&section=purchases&amp;do=renew&amp;id={$p['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$p['ps_name']}</a></h3>
					<p class='block_text'>
						{$p['ps_renewal_terms']}
					</p>
				</div>
			</li>
		</foreach>
	</ul>
	<br />
	{$pagination}
</div>]]></template_content>
      <template_name>renewPurchaseOptions</template_name>
      <template_data>$purchases, $pagination</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['track_shipment']}</h2>
<div class='master_list'>
	<div class='row'>
		{$this->lang->words['ship_order_ordered']} {$this->lang->getDate( $order['o_date'], 'JOINED', true )}<br />
		<if test="$order['o_status'] == 'done'">
			{$this->lang->words['ship_order_shipped']} {$this->lang->getDate( $order['o_shipped_date'], 'JOINED', true )}<br />
			<if test="$trackingInfo['delivered']">
				{$this->lang->words['ship_order_delivered']} {$this->lang->getDate( $trackingInfo['delivered'], 'JOINED', true )}<br />
			<else />
				<if test="$trackingInfo['eta']">
					{$this->lang->words['ship_order_eta']} {$this->lang->getDate( $trackingInfo['eta'], 'JOINED', true )}<br />
				</if>
			</if>
		</if>
	</div>
</div>
<h3>{$this->lang->words['shiporder_items']}</h3>
<div class='master_list'>
	<foreach loop="items:$items as $item">
		<div class='row'>
			<h4>
				<span class='desc'>{$item['quantity']} x </span>{$item['itemName']}
			</h4>
			<if test="$item['cfields']">
				<span class='desc'>{parse expression="str_replace('<br /><br />', '<br />', $item['cfields'])"}</span>
			</if>
		</div>
	</foreach>
</table>
<h3 class='maintitle'>{$this->lang->words['shiporder_track']}</h3>
<div class='master_list'>
	<if test="!empty( $trackingInfo['data'] )">
		<foreach loop="items:$trackingInfo['data'] as $event">
			<div class='row'>
				<h4>{$this->lang->getDate( $event['time'], 'LONG', true )}</h4>
				<h4>{$event['event']}</h4>
				<if test="$event['location']"><span class='desc'>{$event['location']}</span><br /></if>
				<span class='desc'>{$event['notes']}</span>
			</div>
		</foreach>
	<else />
		<if test="$trackUrl">
			<div class='row touch-row'>
				<a class='title' href='{$trackUrl}' target='_blank'>{$this->lang->words['shiporder_track_click']}</a>
			</div>
		<else />
			<div class='row'>
				{$this->lang->words['track_empty']}
			</div>
		</if>
	</if>
</div>]]></template_content>
      <template_name>shippingOrder</template_name>
      <template_data>$order, $items, $trackingInfo, $trackUrl</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['your_invoices']}</h2>
<div class='master_list'>
	<if test="!empty( $invoices )">
		<foreach loop="invoices:$invoices as $invoice">
			<div class='row touch-row'>
				<a class='title' href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}'>{$invoice['i_title']}</a><br />
				<span class='desc'><strong>{parse currency="$invoice['i_total']"}</strong> &middot; {parse date="$invoice['i_date']" format="long"}</span>
			</div>
		</foreach>
	<else />
		<div class='row no_messages'>
			{$this->lang->words['invoices_none']}
		</div>
	</if>
</div>]]></template_content>
      <template_name>showInvoices</template_name>
      <template_data>$invoices</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['your_purchases']}</h2>
<div class='master_list product_list'>
	<if test="havePurchases:|:count($purchases)">
		<foreach loop="children:$parentMap[0] as $item">
			{parse template="purchaseRow" group="nexus_clients" params="$purchases[ $item ], $parentMap, $purchases"}
		</foreach>
	<else />
		<div class='row'>{$this->lang->words['nopurchases']}</div>
	</if>
</div>]]></template_content>
      <template_name>showPurchases</template_name>
      <template_data>$purchases, $parentMap</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['change_package']}</h3>
<div class='master_list'>
	<div class='row'>
		{$this->lang->words['change_package_blurb']}
	</div>
	<form action='{parse url="app=nexus&module=clients&section=purchases&amp;do=change&amp;id={$purchase['ps_id']}" base="public"}' method='post'>
		<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
		<foreach loop="options:$options as $option">
			<div class='row'>
				<div class='icon'>
					<input type='radio' name='select' value='{$option['p_id']}' class='input_radio' />
				</div>
				<div class='rowContent'>
					<h4 class='product_title'>{$option['p_name']}</h4>
					{$option['cost']}
					<if test="renewalTerms:|:$option['cost'] && $option['renewal_terms']"><br /></if>
					{$option['renewal_terms']}
				</div>
			</div>
		</foreach>
		<div class='controls'>
			<div class='buttons'>
				<input type='submit' value='{$this->lang->words['change_save']}' class='button full_width' />
			</div>
		</div>
	</form>
</div>]]></template_content>
      <template_name>showUpgradeOptions</template_name>
      <template_data>$purchase, $options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h2><span class='ipsBadge ipsBadge_dark'>{parse expression="$this->lang->words['invoices_'.$invoice['i_status']]"}</span> {parse expression="sprintf( $this->lang->words['invoice_number'], $invoice['i_id'] )"}</h2>
<div class='master_list cart_review'>
	<if test="payable:|:$invoice['i_status'] == 'pend' or $invoice['i_status'] == 'expired'">
		<div class='row' id='invoice_buttons'>
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=cancel&amp;id={$invoice['i_id']}&amp;secure_key={$this->member->form_hash}&amp;boink=ca" base="public"}' class='button delete right full_width' style='width: 48% !important;'>{$this->lang->words['invoice_cancel']}</a>
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}' class='button left full_width' style='width: 48% !important;'>{$this->lang->words['invoices_pay']}</a>
		</div>
	</if>
	<h3>{$this->lang->words['invoice_itemized']}</h3>
	<foreach loop="items:$invoice['items'] as $item">
		<div class='row'>
			<span class='price right'>
				{$item['line']}
			</span>
			<h4>
				<span class='desc'>{$item['quantity']} x </span>{$item['itemName']}
			</h4>
			<if test="$item['cfields']">
				<span class='desc'>{parse expression="str_replace('<br /><br />', '<br />', $item['cfields'])"}</span>
			</if>
		</div>
	</foreach>
	<div class='row subtotal'>
		<span class='price right'>{$invoice['subtotal']}</span>
		<h4>{$this->lang->words['store_subtotal']}</h4>
	</div>
	<if test="discount:|:$invoice['i_discount']">
		<div class='row subtotal'>
			<span class='price right'>{$invoice['discount_amount']}</span>
			<h4>{$invoice['i_discount']}% {$this->lang->words['store_bundle_discount']}</h4>
		</div>
	</if>
	<if test="tax:|:$invoice['tax']">
		<div class='row subtotal'>
			<span class='price right'>{parse currency="$invoice['tax']"}</span>
			<h4>{$this->lang->words['store_tax']}</h4>
		</div>
	</if>
	<div class='row subtotal total'>
		<span class='price right'>{$invoice['i_total']}</span>
		<h4>{$this->lang->words['store_total']}</h4>
	</div>
</div>]]></template_content>
      <template_name>viewInvoice</template_name>
      <template_data>$invoice</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<!--<form action='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=notes" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='id' value='{$invoice['i_id']}' />
	<h3 class='bar'>{$this->lang->words['invoice_notes']}</h3>
	<div class='ipsBox_container ipsPad'>
		<ul>
			<li class='field'>
				<label for='po'>{$this->lang->words['invoice_po']}</label>
				<input name='po' class='input_text' size='25' id='po' value='{$invoice['i_po']}' />
			</li>
			<li class='field'>
				<label for='notes'>{$this->lang->words['invoice_notes']}</label>
				<textarea name='notes' id='notes' rows='10' cols='25'>{$invoice['i_notes']}</textarea>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['invoice_notes_submit']}' />
	</fieldset>
</form>-->]]></template_content>
      <template_name>viewInvoiceRight</template_name>
      <template_data>$invoice</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='master_list product_list'>
	<div class='row'>
		<if test="image:|:$package['image']">
			<div class='icon'>
				<img src='{$package['image']}' {parse resize_image="{$package['image']}" maxwidth="60" maxheight="60"} class='left' />
			</div>
		</if>
		<div class='rowContent'>
			<h4 class='product_title'>
				{$package['ps_name']}
			</h4>
			<p>
				{$this->lang->words['purchased']}: <strong>{parse date="$package['ps_start']" format="long"}</strong></strong>
				<if test="expiryDate:|:$package['ps_expire']">
					<br />
					{$this->lang->words['expires']}: <strong>{parse date="$package['ps_expire']" format="long" relative="false"}</strong>
				</if>
			</p>
		</div>
	</div>
	<if test="$content[ $package['ps_item_id'] ]['html'] or $content[ $package['ps_item_id'] ]['attachmentHtml']">
		<div class='row'>
			{$content[ $package['ps_item_id'] ]['html']}
			{$content[ $package['ps_item_id'] ]['attachmentHtml']}
		</div>
	</if>
</div>
<if test="extra:|:$extra">
	{$extra['mainBox']}
</if>
<if test="pendingInvoices:|:$package['ps_invoice_pending']">
	<p class='message'>
		<if test="$package['ps_invoice_pending'] == 1">
			{$this->lang->words['purchase_invoice_pending']}<br /><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices" base="public"}'>{$this->lang->words['view_pending_invoices']}</a>
		<else />
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$package['ps_invoice_pending']}" base="public"}'>{$this->lang->words['purchase_invoice_pending']}</a>
		</if>
	</p>
</if>
<if test="downloads:|:count($downloads)">
	<h3>{parse expression="sprintf( $this->lang->words['purchase_download'], "" )"}</h3>
	<div class='master_list'>
		<foreach loop="downloads:$downloads as $d">
			<div class='row'>
				<if test="hash:|:$d['hash']">
					<a href='{parse url="app=downloads&module=display&section=download&do=confirm_download&id={$d['file_id']}&hash={$d['hash']}" base="public"}'>{parse expression="sprintf( $this->lang->words['purchase_download_with_version'], "{$d['file_name']}", "{$d['file_version']}" )"}</a>
				<else />
					<a href='{parse url="app=downloads&module=display&section=download&do=confirm_download&id={$d['file_id']}" base="public"}'>{parse expression="sprintf( $this->lang->words['purchase_download_with_version'], "{$d['file_name']}", "{$d['file_version']}" )"}</a>
				</if>
			</div>
		</foreach>
	</div>
</if>
<if test="customFields:|:!empty($fields)">
	<h3>{$this->lang->words['store_package_info']}</h3>
		<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=update&amp;id={$package['ps_id']}" base="public"}' method='post'>
			<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
			<ul class='ipsForm ipsForm_vertical'>
				<foreach loop="fields:$fields as $f">
					<li class='ipsField'>
						<label class='ipsField_title'>{$f->name}</label>
						{$f->edit()}
					</li>
				</foreach>
			</ul>
			<if test="editable:|:$editable">
			<div class='controls'>
				<div class='buttons'>
					<input type='submit' class='button full_width' value='{$this->lang->words['save_changes']}' />
				</div>
			</div>
		</form>
	</div>
</if>]]></template_content>
      <template_name>viewPackage</template_name>
      <template_data>$content, $support, $package, $fields, $editable, $current, $downloads, $extra, $upgradeOptions, $assocOptions, $shipOrder=NULL</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<p class='message'>{$message}</p>
<div class='master_list'>
	<div class='row'>
		<a href='{$ad['ad_link']}'><img src='{$ad['ad_image']}' /></a>
		<br /><br />
		<if test="$ad['ad_terms']">
			<label>{$this->lang->words['ad_terms']} </label>
			{$ad['terms']}
			<br />
		</if>
		<label>{$this->lang->words['ad_clicks_sofar']} </label>
		{$ad['ad_clicks']}
		<br />
		<label>{$this->lang->words['ad_impressions_sofar']} </label>
		{$ad['ad_impressions']}
	</div>
</div>]]></template_content>
      <template_name>viewPackageAdvertisement</template_name>
      <template_data>$message, $ad</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='master_list'>
	<div class='row'>
		<table class='ipb_table'>
			<tr>
				<td width='20%'><strong>{$this->lang->words['haccount_server']}</strong></td>
				<td>{$account->server->data['server_hostname']}</td>
				<td>{$ftp} &nbsp;&nbsp; {$cp}</td>
			</tr>
			<tr>
				<td width='20%'><strong>{$this->lang->words['haccount_domain']}</strong></td>
				<td><a href='http://{$account->data['account_domain']}' target='_blank'>{$account->data['account_domain']}</a></td>
				<td>&nbsp;</td>
			</tr>
			<tr>
				<td width='20%'><strong>{$this->lang->words['haccount_username']}</strong></td>
				<td>{$account->data['account_username']}</td>
				<td>&nbsp;</td>
			</tr>
			<tr>
				<td width='20%'><strong>{$this->lang->words['haccount_password']}</strong></td>
				<td>{$account->data['account_password']}</td>
				<td>{$changePass}</td>
			</tr>
			<foreach loop="$accountInformation as $rv">
				<tr>
					<td width='20%'><strong>{$r[0]}</strong></td>
					<td>{$r[1]}</td>
					<td>{$r[2]}</td>
				</tr>
			</foreach>
		</table>
	</div>
</div>]]></template_content>
      <template_name>viewPackageHosting</template_name>
      <template_data>$account, $accountInformation, $ftp, $cp, $changePass</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['nexus_lkey']}</h3>
<div class='master_list'>
	<div class='row'>
		<img src='{$this->settings['img_url']}/nexus/lkey.png' alt='{$this->lang->words['nexus_lkey']}' title='{$this->lang->words['nexus_lkey']}' /> {$lkey['lkey_key']}
	</div>
</div>]]></template_content>
      <template_name>viewPackageLkey</template_name>
      <template_data>$lkey</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='master_list product_list'>
	<div class='row'>
		<if test="trackLink:|:$shipOrder['o_id']">
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=track&amp;id={$shipOrder['o_id']}" base="public"}' class='button secondary'>{$this->lang->words['track_shipment']}</a>
		</if>
		<if test="supportLink:|:$support and $package['ps_active']">
			<a href='{parse url="app=nexus&amp;module=support&amp;section=new&amp;&amp;department={$support}&amp;package={$package['ps_id']}" base="public"}' class='button secondary'>{$this->lang->words['new_support_request']}</a>
		</if>
		<if test="renewLink:|:$package['renewable']">
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=renew&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='button secondary'>{$this->lang->words['purchase_renew']}</a>
		</if>
		<if test="upgradeLink:|:!empty($upgradeOptions)">
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=change&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='button secondary'>{$this->lang->words['change_package']}</a>
		</if>
		<if test="assocLink:|:!empty($assocOptions)">
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=assoc&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='button secondary'>{$this->lang->words['purchase_associate']}</a>
		</if>
		{$extra['buttons']}
		<if test="reviewLink:|:$reviewable">
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;&amp;do=review_write&amp;id={$package['ps_item_id']}" base="public"}' class='button secondary'>{parse expression="ucwords($this->lang->words['write_a_review'])"}</a>
		</if>
		<if test="cancelLink:|:$package['ps_active'] and !$package['ps_cancelled'] and ( $package['ps_renewals'] or $package['ps_grouped_renewals'] )">
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=cancel&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='button secondary'>{$this->lang->words['purchase_cancel']}</a>
		</if>
		<if test="reactivateLink:|:( $package['ps_cancelled'] or !$package['ps_renewals'] ) and $package['ps_can_reactivate'] == 1">
			<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=reactivate&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='button secondary'>{$this->lang->words['purchase_reactivate']}</a>
		</if>
	</div>
</div>]]></template_content>
      <template_name>viewPackageRight</template_name>
      <template_data>$content, $support, $package, $fields, $editable, $current, $downloads, $extra, $upgradeOptions, $assocOptions, $reviewable, $shipOrder=NULL</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_nexus_emails">
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_new_invoice']} <#AUTOPAY_REASON#><br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
{$this->lang->words['ne_info_only']} <#SHIP#>
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>autopay</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_new_invoice']}. {$this->lang->words['ne_autopay_fail']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<a href='<#LINK#>'>{$this->lang->words['ne_login_for_payment_urgent']}</a>. {$this->lang->words['ne_autopay_provider']} <a href='<#DETAILS_LINK#>'>{$this->lang->words['ne_autopay_details']}</a>.
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>autopay_fail</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[{parse expression="nl2br($this->lang->words['autoresolve_warning'])"}<br />]]></template_content>
      <template_name>autoresolve</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<strong><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice->id}" base="public"}'>{parse expression="sprintf( $this->lang->words['invoice_number'], $invoice->id )"} - {$invoice->title}</a></strong><br />
<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['cart_desc']}</td>
		<td style='font-weight:bold'>&nbsp;</tdh>
		<td style='font-weight:bold'>{$this->lang->words['cart_unit']}</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_line']}</td>
	</tr>
	<foreach loop="$invoice->items as $k => $item">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>
				<if test="hasLink:|:$item['itemURI']">
					<a href='{parse url="{$item['itemURI']}" base="public"}'>{$item['itemName']}</a>
				<else />
					<if test="isRenewal:|:$item['act'] == 'renewal'">
						<a href='{parse url="app=nexus&module=clients&section=purchases&do=view&id={$item['itemID']}" base="public"}'>{$item['itemName']}</a>
					<else />
						{$item['itemName']}
					</if>
				</if>
			</td>
			<td>
				<if test="is_array( $item['cfields'] )">
					<foreach loop="$item['cfields'] as $id => $value">
						{$cfields[ $id ]['cf_name']}: {$invoice->getCustomFieldValue( $cfields[ $id ], $value )}<br />
					</foreach>
				</if>
			</td>
			<td class='short'>
				<if test="is_array( $item['prices'] )">
					{parse expression="invoice::formatPrices( $item['prices'] )"}
				<else />
					{$this->lang->formatMoney( $item['cost'] )}
				</if>
			</td>
			<td class='short'>
				{$item['quantity']}
			</td>
			<td>
				{$this->lang->formatMoney( $invoice->getLinePrice( $k ) )}
			</td>
		</tr>
	</foreach>
	<if test="$invoice->discount or $tax">
		<tr style='font-weight: bold'>
			<td style='text-align: right' colspan='4'>{$this->lang->words['store_subtotal']}</td>
			<td>{$this->lang->formatMoney( $subtotal )}</td>
		</tr>
		<if test="$invoice->discount">
			<tr style='font-weight: bold'>
				<td style='text-align: right' colspan='4'>{$invoice->discount}% {$this->lang->words['store_bundle_discount']}</td>
				<td>{$this->lang->formatMoney( - ( $subtotal - $invoice->total - $tax ) )}</td>
			</tr>
		</if>
		<if test="$tax">
			<tr style='font-weight: bold'>
				<td style='text-align: right' colspan='4'>{$this->lang->words['store_tax']}</td>
				<td>{$this->lang->formatMoney( $tax )}</td>
			</tr>
		</if>
	</if>
	<tr style='font-weight: bold'>
		<td style='text-align: right' colspan='4'>{$this->lang->words['store_total']}</td>
		<td><strong>{$this->lang->formatMoney( $invoice->total )}</strong></td>
	</tr>
</table>
<br />]]></template_content>
      <template_name>genericInvoiceTable</template_name>
      <template_data>$invoice, $cfields, $subtotal, $tax</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['purchase_id']}</td>
		<td style='font-weight:bold'>{$this->lang->words['purchase_name']}</td>
		<td style='font-weight:bold'>{$this->lang->words['purchase_expire']}</td>
		<td style='font-weight:bold'>{$this->lang->words['purchase_renewals']}</td>
	</tr>
	<foreach loop="$purchases as $purchase">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>{$purchase['ps_id']}</td>
			<td>{$purchase['ps_name']}</td>
			<td>{parse date="$purchase['ps_expire']" format="JOINED"}</td>
			<td>{$purchase['renewal']}</td>
		</tr>
	</foreach>
</table>
<br />]]></template_content>
      <template_name>genericPurchasesTable</template_name>
      <template_data>$purchases</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<div style='margin-top: 10px; font-size: 2em'>
	<#AMOUNT#> {$this->lang->words['gift_voucher']}
</div>
<br />
<br />
<if test="$data['message']">
	<div style="background: #ebf0f3; padding: 10px;">
		<#RECIPIENT#>
		<#MESSAGE#>
		<#SENDER#>
	</div>
	<br /><br />
</if>
<strong>
	{$this->lang->words['gv_redeem_code']}:<br />
	<#CODE#><br />
	<br />
	<a href='<#LINK#>'>{$this->lang->words['gv_redeem_now']}</a>
</strong>]]></template_content>
      <template_name>giftVoucher</template_name>
      <template_data>$purchase, $data</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_invoice_warn']}.<br />
<br />
<br />
<#PURCHASES_TABLE#>
<br />
{$this->lang->words['ne_invoice_warn_explain']}<br />
<#INVOICE_DATE#><br />
<br />
{$this->lang->words['ne_invoice_warn_check']}<br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>invoice_warn</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_new_invoice']}.<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<a href='<#LINK#>'>{$this->lang->words['ne_login_for_payment']}</a>
<br />
{$this->lang->words['ne_note_expiry_dates']}<br />
<br />]]></template_content>
      <template_name>new_invoice</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_failed']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}</a> {$this->lang->words['or']} <a href='<#LINK#>'>{$this->lang->words['ne_login_for_other_payment']}</a>.<br />
<br />]]></template_content>
      <template_name>payment_failed</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_held']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
{$this->lang->words['ne_additional_approved']}<br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>payment_held</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_received']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
<#SHIP#><br />
<br />]]></template_content>
      <template_name>payment_received</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_refunded']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
{$this->lang->words['ne_refund_explain']}<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}</a> {$this->lang->words['or']} <a href='<#LINK#>'>{$this->lang->words['ne_login_for_other_payment']}</a>.<br />
<br />]]></template_content>
      <template_name>payment_refunded</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_order_thanks']}<br />
<br />
<#INSTRUCTIONS_HTML#>
<br />
<br />
<#INVOICE_TABLE#>
<br />
<a href='<#LINK#>'>{$this->lang->words['ne_login_for_payment']}</a>
<br />
{$this->lang->words['ne_additional_confirm']}<br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>payment_waiting</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_support_reply']}<br />
<br />
<div style="background: #ebf0f3; padding: 10px;">
	<#MESSAGE#>
</div>
<br />
<br />
<#REPLY_NOTIFY#>]]></template_content>
      <template_name>reply</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_ship_canc_notification']}<br />
<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['item']}</td>
		<td style='font-weight:bold'>&nbsp;</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
	</tr>
	<foreach loop="$items as $item">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>{$item['itemName']}</td>
			<td>
				<if test="is_array( $item['cfields'] )">
					<foreach loop="$item['cfields'] as $id => $value">
						{$cfields[ $id ]['cf_name']}: {$value}<br />
					</foreach>
				</if>
			</td>
			<td>{$item['quantity']}</td>
		</tr>
	</foreach>
</table>
<br />
<br />
<#SHIP_METHOD#><br />
{$address['first_name']} {$address['last_name']}<br />
{$address['address_1']}<br />
<if test="$address['address_2']">
	{$address['address_2']}<br />
</if>
{$address['city']}<br />
<if test="$address['state']">
	{$address['state']}<br />
</if>
{$address['zip']}<br />
<br />
<br />
<#TRACKING#><br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>shipping_canceled</template_name>
      <template_data>$items, $cfields, $address</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_ship_notification']}<br />
<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['item']}</td>
		<td style='font-weight:bold'>&nbsp;</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
	</tr>
	<foreach loop="$items as $item">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>{$item['itemName']}</td>
			<td>
				<if test="is_array( $item['cfields'] )">
					<foreach loop="$item['cfields'] as $id => $value">
						{$cfields[ $id ]['cf_name']}: {$value}<br />
					</foreach>
				</if>
			</td>
			<td>{$item['quantity']}</td>
		</tr>
	</foreach>
</table>
<br />
<br />
<#SHIP_METHOD#><br />
{$address['first_name']} {$address['last_name']}<br />
{$address['address_1']}<br />
<if test="$address['address_2']">
	{$address['address_2']}<br />
</if>
{$address['city']}<br />
<if test="$address['state']">
	{$address['state']}<br />
</if>
{$address['zip']}<br />
<br />
<br />
<#TRACKING#><br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>shipping_notification</template_name>
      <template_data>$items, $cfields, $address</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#STAFF_NAME#>,<br />
<br />
{$this->lang->words['ne_support_staff']}<br />
<br />
<strong><#TITLE#></strong><br />
<br />
<div style="background: #ebf0f3; padding: 10px;">
	<#MESSAGE#>
</div>
<br />
<br />
<#REPLY_NOTIFY#>]]></template_content>
      <template_name>staff_notify</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_support_new']}<br />
<br />
<strong><a href='<#LINK#>'><#TITLE#></a></strong><br />
<br />
<div style="background: #ebf0f3; padding: 10px;">
	<#MESSAGE#>
</div>
<br />
<br />
<#REPLY_NOTIFY#>]]></template_content>
      <template_name>support</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_nexus_payments">
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="inAcp:|:IN_ACP">
	<style type='text/css'>		
.swfupload {
	position: absolute;
	z-index: 1;
}
	
#attachments { }
	#attachments li {
		background-color: #e4ebf2;
		border: 1px solid #d5dde5;
		padding: 6px 20px 6px 42px;
		margin-bottom: 10px;
		position: relative;
	}
	
		#attachments li p.info {
			color: #69727b;
			font-size: 0.8em;
			width: 300px;
		}
	
		#attachments li .links, #attachments li.error .links, #attachments.traditional .progress_bar {
			display: none;
		}
			
			#attachments li.complete .links {
				font-size: 0.9em;
				margin-right: 15px;
				right: 0px;
				top: 12px;
				display: block;
				position: absolute;
			}
			
		#attachments li .progress_bar {
			margin-right: 15px;
			width: 200px;
			right: 0px;
			top: 15px;
			position: absolute;
		}
	
		#attachments li.complete, #attachments li.in_progress, #attachments li.error {
			background-repeat: no-repeat;
			background-position: 12px 12px;
		}
	
		#attachments li.in_progress {
			background-image: url({$this->settings['public_dir']}style_images/master/loading.gif);
		}
	
		#attachments li.error {
			background-image: url({$this->settings['public_dir']}style_images/master/exclamation.png);
			background-color: #e8caca;
			border: 1px solid #ddafaf;
		}
		
			#attachments li.error .info {
				color: #8f2d2d;
			}
	
		#attachments li.complete {
			background-image: url({$this->settings['public_dir']}style_images/master/accept.png);
		}
		
		#attachments li .thumb_img {
			left: 6px;
			top: 6px;
			width: 30px;
			height: 30px;
			overflow: hidden;
			position: absolute;
		}
/*div.post_form fieldset.attachments span.desc {
	margin: 0 0 0 15px;
	display: inline;
	clear: none;
}*/
.attach_controls {
	background: url( {$this->settings['public_dir']}style_images/master/icon_attach.png ) no-repeat 3px;
	padding-left: 35px;
	min-height: 82px;
}
	.attach_controls .ipsType_subtitle { margin-bottom: 5px; }
	.attach_controls iframe { display: block; margin-bottom: 5px; }
	
.attach_button { font-weight: bold;  }
#help_msg {	margin-top: 8px; }
#attach_wrap {
	background: #eef3f8;
	padding: 6px;
	margin-top: 8px;
}
	#attach_wrap h4 {
		font-size: 1em;
		font-weight: bold;
	}
	
	#attach_wrap li {
		margin: 5px 6px;
		float: left;
	}
		
		#attach_wrap .desc.info {
			margin-left: 24px;
		}
		
.ipsButton_secondary {
	height: 22px;
	line-height: 22px;
	font-size: 12px;
	color: #7c7c7c;
	padding: 0 10px;
	background: #f6f6f6;
	background: -moz-linear-gradient(top, #f6f6f6 0%, #e5e5e5 100%); /* firefox */
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f6f6f6), color-stop(100%,#e5e5e5)); /* webkit */
	border: 1px solid #dbdbdb;
	-moz-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-webkit-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	color: #616161;
	display: inline-block;
	white-space: nowrap;
}
	.ipsButton_secondary:hover {
		color: #4c4c4c;
		border-color: #9a9a9a;
	}
	</style>
	
	<script type='text/javascript' src='{$this->settings['board_url']}/cache/lang_cache/{$this->lang->lang_id}/ipb.lang.js'></script>
	<script type='text/javascript'>
		var backup = ipb.vars['base_url'];
		ipb.vars['base_url']	= ipb.vars['front_url'];
		ipb.vars['upload_url']	= "{$this->settings['upload_url']}";
	</script>
	<if test="$backup = $this->settings['base_url']">
		<if test="$this->settings['base_url'] = $this->settings['board_url'] . '/index.php?'"></if>
	</if>
</if>
<if test="$this->lang->words['attach_button'] = $this->lang->words['nexus_attach_button']"></if>
<fieldset class='attachments'>
	{parse template="uploadForm" group="post" params="$data['post_key'], 'custom_pages', $data['stats'], 0"}
</fieldset>
<if test="inAcp2:|:IN_ACP">
	<script type='text/javascript'>
		//ipb.vars['base_url']	= backup;
	</script>
	<if test="$this->settings['base_url'] = $backup"></if>
</if>]]></template_content>
      <template_name>attachments</template_name>
      <template_data>$data=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<foreach loop="$hiddenFields as $k => $v">
	<input type='hidden' name='{$k}' value='{$v}' />
</foreach>
<ul class='payment_fields'>
	<li class='field'>
		<label for='x_card_num'>{$this->lang->words['checkout_card_number']}</label>
		<input type='text' name='x_card_num' id='x_card_num' class='input_text' />
		<br />
		<foreach loop="cardImages2:array( 'Visa', 'Mastercard', 'American Express', 'Discover', 'JCB', "Diners Club" ) as $t">
			<img src='{$this->settings['img_url']}/nexus/cards/{parse expression="str_replace( array( ' ', '/' ), '', strtolower($t) )"}.png' alt='{$t}' title='{$t}' />
		</foreach>
	</li>
	<li class='field'>
		<label for='x_exp_date'>{$this->lang->words['checkout_card_expire']}</label>
		<input type='text' name='x_exp_date' id='x_exp_date' class='input_text' size='6' /> (MM/YY)
	</li>
	<li class='field'>
		<label for='x_card_code'>{$this->lang->words['checkout_card_cvv2']}</label>
		<input type='text' name='x_card_code' id='x_card_code' size='3' class='input_text' /> <img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' />
		<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>
	</li>
</ul>
<script type='text/javascript'>
$('x_exp_date').defaultize( "MM/YY" );
</script>]]></template_content>
      <template_name>authNetDpm</template_name>
      <template_data>$hiddenFields</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<div id='cart'>
	<a href='{parse url="app=nexus&amp;module=payments&amp;do=view" base="public" template="storecart" seotitle="storecart"}' class='input_submit checkout'>
		<if test="count( $cart['items'] )">
			<span class='count'>{parse expression="count( $cart['items'] )"}</span>
		</if>
		<if test="$cart['total']">
			{parse currency="$cart['total']"}
		<else />
			{$this->lang->words['store_cart_short']}
		</if>
	</a>
</div>
<!--<if test="items:|:!empty( $cart['items'] )">
	<ul id='mini_cart' class='ipsPad'>
		<foreach loop="items:$cart['items'] as $item">
			<li class='item'>
				<span class='item_detail'>{$item['name']}<if test="moreThanOne:|:$item['qty'] > 1"> x{$item['qty']}</if></span>
				<span class='item_price'>{parse currency="$item['line_price']"}</span>
			</li>
		</foreach>
		<if test="discount:|:$cart['discount']">
			<li class='total subtotal'>
				<span class='item_detail'>{$this->lang->words['store_subtotal']}</span>
				<span class='item_price'>{parse currency="$cart['subtotal']"}</span>
			</li>
			<li class='discount'>
				<span class='item_detail'>{$cart['discount']}% {$this->lang->words['store_bundle_discount']}</span>
				<span class='item_price'>{parse currency="$cart['difference']"}</span>
			</li>
		</if>
		<li class='total final'>
			<span class='item_detail'>{$this->lang->words['store_total']}</span>
			<span class='item_price'>{parse currency="$cart['total']"}</span>
		</li>
	</ul>
	<br />
	<p class='right'>
		<a href='{parse url="app=nexus&amp;module=payments&amp;do=view" base="public" template="storecart" seotitle="storecart"}' class='input_submit checkout'>{$this->lang->words['cart_view']}</a> 
	</p>
	<br /><br />
<else />
	<p class='no_messages' style='text-align: center'>
		<em>{$this->lang->words['store_cart_empty']}</em>
	</p>
</if>-->]]></template_content>
      <template_name>cart_sidebar</template_name>
      <template_data>$cart=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="!$this->request['cat'] || ( $this->request['cat'] && count($curGroup['children'][ $this->request['cat'] ]['children']) )">
	<if test="!$this->request['featured'] && !$this->request['popular'] && !$this->request['latest']">
		<h3 class='inline_header'>{$this->lang->words['store_categories']}</h3>	
		<div class='master_list alternate'>
			<foreach loop="children:$curGroup['children'] as $groupID => $data">
				<div class='row touch-row'>
					<if test="noParent:|:$data['data']['pg_parent'] == 0">
							<img src='{$this->settings['img_url']}/folder.png' />
					</if> <a class='title' href='{parse url="app=nexus&amp;module=payments&amp;cat={$groupID}" base="public" template="storecat" seotitle="{$data['data']['pg_seo_name']}"}'>{$data['data']['pg_name']}</a>
					<if test="hasChildren:|:$data['children'] and in_array( $data['data']['pg_id'], $hierarchy )">
						<ul style='padding: 6px;'>
							{parse template="cat_menu_item" group="nexus_payments" params="$data, $hierarchy"}
						</ul>
					</if>
				</div>
			</foreach>
		</div>
		<if test="$this->settings['nexus_gift_vouchers']">
			<h3 class='inline_header'>{$this->lang->words['gift_vouchers']}</h3>
			<div class='master_list alternate'>
				<div class='row touch-row'>
					<img src='{$this->settings['img_url']}/nexus/gifts.png' /> <a class='title' href='{parse url="app=nexus&amp;module=payments&amp;do=vouchers" base="public" template="gift_vouchers" seotitle="gift_vouchers"}'>{$this->lang->words['gv_buy']}</a></li>
				</div>
				<div class='row touch-row'>
					<img src='{$this->settings['img_url']}/nexus/gifts.png' /> <a class='title' href='{parse url="app=nexus&amp;module=payments&amp;do=redeem" base="public" template="redeem" seotitle="redeem"}'>{$this->lang->words['gv_redeem']}</a></li>
				</div>
			</div>
		</if>
	</if>
</if>]]></template_content>
      <template_name>cat_menu_item</template_name>
      <template_data>$curGroup, $hierarchy</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<php>
	// Adjust author name as needed
	if( !$r['author']['member_id'] ){
		$r['author']['members_display_name']	= $r['author']['comment_author_name'];
	}
</php>
<div class='row'>
	<p class='review_info'>
		<foreach loop="range( 1, 5 ) as $i">
			<if test="$r['comment']['review_rating'] >= $i">
{parse replacement="rate_on"}
			<else />
				{parse replacement="rate_off"}
			</if>
		</foreach>
		by {$r['author']['members_display_name']}
		<span class='desc'>{parse date="$r['comment']['comment_date']" format="short"}</span>
	</p>
	<div class='line_spacing'>
		{$r['comment']['comment_text']}
	</div>
	<if test="$r['comment']['review_votes']">
		<br />
		<em class='desc'>{parse expression="sprintf( $this->lang->words['review_number_useful'], $r['comment']['review_useful'], $r['comment']['review_votes'] )"}</em>
	</if>
</div>]]></template_content>
      <template_name>comment</template_name>
      <template_data>$r, $parent, $settings</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="!empty( $comments )">
	<div class='master_list'>
		<if test="comments_top:|:$pages">
			<div class='controls'>
				<div class='buttons'>
					{$pages}
				</div>
			</div>
		</if>
		<foreach loop="comments:$comments as $id => $r">
			{parse template="comment" group="nexus_payments" params="$r, $parent, $settings"}
		</foreach>
		<if test="comments_bottom:|:$pages">
			<div class='controls'>
				<div class='buttons'>
					{$pages}
				</div>
			</div>
		</if>
	</div>
<else />
	<div class='master_list'>
		<div class='row no_messages'>
			{$this->lang->words['no_reviews']}
		</div>
	</div>
</if>]]></template_content>
      <template_name>commentsList</template_name>
      <template_data><![CDATA[$comments, $settings, $pages, $parent, $preReply='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<input id='pay_submit' type='<if test="$onclick">button<else />submit</if>' value='{$this->lang->words['checkout_confirm']}' class='button full_width' <if test="$onclick">onclick='{$onclick}'</if> />]]></template_content>
      <template_name>confirmButton</template_name>
      <template_data><![CDATA[$invoice, $onclick='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript'>
	nexus.checkout.initCreditCard();
</script>
<if test="cardOnFile:|:$cardOnFile">
	<ul class='ipsForm_vertical'>
		<li class='ipsField'>
			<input type='checkbox' name='cardonfile' id='cardonfile' checked='checked' /> <label for='cardonfile'><strong>{$this->lang->words['cc_onfile']} ({$cardOnFile})</strong></label>
		</li>
	</ul>
	<div id='full_options' style='display: none'>
<else />
	<div id='full_options'>
</if>
	<ul class='ipsForm_vertical'>
		<li class='ipsField'>
			<p class='ipsField_content'>
				<if test="acceptedTypes:|:!$showTypeList and $showLogos">
					<foreach loop="cardImages2:$acceptedTypes as $t">
						<img src='{$this->settings['img_url']}/nexus/cards/{parse expression="str_replace( array( ' ', '/' ), '', strtolower($t) )"}.png' alt='{$t}' title='{$t}' />
					</foreach>
					<br />
				</if>
				<input type='text' style='font-size: 16px;' name='card_number' id='card_number' class='input_text' placeholder='{$this->lang->words['checkout_card_number']}' pattern='[0-9]+' />
			</p>
		</li>
	</ul>
	<ul class='ipsForm_horizontal'>
		<if test="showTypeList:|:$showTypeList">
			<li class='ipsField'>
				<label for='card_type' class='ipsField_title'>{$this->lang->words['checkout_card_type']}</label>
				<p class='ipsField_content'>
					<select name='card_type' id='card_type' class='input_select full_width'>
						<foreach loop="acceptedTypes:$acceptedTypes as $t">
							<if test="cardType:|:substr( $t, 0, 1 ) != '_'">
								<option value='{$t}'>{$t}</option>
							</if>
						</foreach>
					</select>
				</p>
			</li>
		</if>
		<if test="isUkCard:|:$isUkCard">
			<li class='ipsField'>
				<label for='issue_number' class='ipsField_title'>{$this->lang->words['checkout_card_issueno']}</label>
				<p class='ipsField_content'>
					<input type='text' name='issue_number' id='issue_number' size='3' class='input_text no_width' />
				</p>
				<!--<span class='desc'>{$this->lang->words['checkout_ukcards_blurb']}</span>-->
			</li>
			<li class='ipsField'>
				<label for='start_month' class='ipsField_title'>{$this->lang->words['checkout_card_start']}</label>
				<p class='ipsField_content'>
					<select name='start_month' id='start_month' class='input_select'>
						<option value='00'></option>
						<option value='01'>01</option>
						<option value='02'>02</option>
						<option value='03'>03</option>
						<option value='04'>04</option>
						<option value='05'>05</option>
						<option value='06'>06</option>
						<option value='07'>07</option>
						<option value='08'>08</option>
						<option value='09'>09</option>
						<option value='10'>10</option>
						<option value='11'>11</option>
						<option value='12'>12</option>
					</select> / 
					<select name='start_year' id='start_year' class='input_select'>
						<option value='0000'></option>
						<foreach loop="yearsStart:range( date('Y')-4, date('Y') ) as $y">
							<option value='$y'>$y</option>
						</foreach>
					</select>
				</p>
				<!--<span class='desc'>{$this->lang->words['checkout_ukcards_blurb']}</span>-->
			</li>
		</if>
		<li class='ipsField'>
			<label for='exp_month' class='ipsField_title'>{$this->lang->words['checkout_card_expire']}</label>
			<p class='ipsField_content'>
				<select name='exp_month' id='exp_month' class='input_select'>
					<option value='01'>01</option>
					<option value='02'>02</option>
					<option value='03'>03</option>
					<option value='04'>04</option>
					<option value='05'>05</option>
					<option value='06'>06</option>
					<option value='07'>07</option>
					<option value='08'>08</option>
					<option value='09'>09</option>
					<option value='10'>10</option>
					<option value='11'>11</option>
					<option value='12'>12</option>
				</select> / 
				<select name='exp_year' id='exp_year' class='input_select'>
					<foreach loop="yearsExp:range( date('Y'), date('Y')+10 ) as $y">
						<option value='$y'>$y</option>
					</foreach>
				</select>
			</p>
		</li>
		<li class='ipsField'>
			<label for='code' class='ipsField_title'>{$this->lang->words['checkout_card_cvv2']}<br /><a href='#' class='desc' id='whats_this_cvv'>What's this?</a></label>
			<p class='ipsField_content'>
				<img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' /> <input type='text' name='code' id='code' size='3' class='input_text no_width' />
			</p>
			<!--<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>-->
		</li>
		<li class='ipsField' id='about_cvv' style='display: none'>
			<span class='desc'>
				{$this->lang->words['checkout_cvv2_blurb']}
			</span>
		</li>
	</ul>
</div>
<if test="recurring:|:$recurring">
	<if test="cardOnFile2:|:$cardOnFile">
		<ul id='renew_options' style='display:none' class='ipsForm_horizontal'>
	<else />
		<ul id='renew_options' class='ipsForm_horizontal'>
	</if>	
		<li class='ipsField'>
			<label for='recurring'><input type='checkbox' name='recurring' id='recurring' /> {$this->lang->words[ $recurr_message ]}</label>
		</li>
	</ul>
</if>
<span class='error' id='error_message_holder'></span>]]></template_content>
      <template_name>creditCardPayments</template_name>
      <template_data><![CDATA[$transid, $methodid, $recurring, $acceptedTypes=array(), $showTypeList=FALSE, $isUkCard=FALSE, $showLogos=TRUE, $cardOnFile=NULL, $recurr_message='cc_ac', $giveFieldElementsNameTags=TRUE, $showCodeFieldForRecurringPayments=TRUE]]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse striping="donations" classes="row1,row2 altrow"}
<div class='general_box clearfix'>
	<h3><img src='{$this->settings['img_url']}/nexus/donate.png' alt='' /> {$this->lang->words['donations']}</h3>
	<div class='_sbcollapsable'>
		<ul class='hfeed block_list'>
			<foreach loop="goals:$goals as $goal">
				<li class='{parse striping="donations"}'>
					<strong>{$goal['d_name']}</strong>
					<p>{$goal['d_desc']}</p>
					
					<if test="goal:|:$goal['d_goal']">
						<div style='width: 90%; padding: 5px'>
							<table>
								<tr>
									<if test="gotSomething:|:$goal['percent'] > 0">
										<td width='{$goal['percent']}%' style='background-color:#225985' nowrap='nowrap'></td>
									</if>
									<if test="gotEverything:|:$goal['left'] > 0">
										<td width='{$goal['left']}%' style='background-color:#d8dde8' nowrap='nowrap'></td>
									</if>
								</tr>
							</table>
							<p class='desc' style='padding: 2px'>{parse expression="sprintf( $this->lang->words['donations_progress'], "{parse currency="$goal['d_current']"}", "{parse currency="$goal['d_goal']"}" )"}</p>
						</div>
					</if>
					
					<br />
					<if test="goalCheck:|:!$goal['d_goal'] or $goal['d_current'] < $goal['d_goal']">
						<form action='{parse url="app=nexus&amp;module=payments&amp;section=donate" base="public"}' method='post'>
							<input type='hidden' name='goal' value='{$goal['d_id']}' />
							{$this->lang->words['donations_donate_enter']} <input name='amount' size='5' /> <input type='submit' class='input_submit' value='{$this->lang->words['donations_donate']}' />
						</form>
					</if>
				</li>
			</foreach>
		</ul>
	</div>
</div>]]></template_content>
      <template_name>donationsSidebar</template_name>
      <template_data>$goals</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
</script>
<h2>{$this->lang->words['store_checkout']}</h2>
{parse template="orderProgress" group="nexus_payments" params="2, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<h3>{$this->lang->words['personal_info']}</h3>
<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=details" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='id' value='{$invoice->id}' />
	<input type='hidden' name='taxable' value='{$taxable}' />
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	
	<div class='master_list'>
			<ul class='ipsForm_vertical'>
				<foreach loop="fields:$fields as $f">
					<if test="isText:|:$f['f_type'] == 'text'">
						<li class='ipsField clearfix'>
							<label for='{$f['f_column']}' class='ipsField_title'>
								<if test="isAddress1:|:$f['f_column'] == 'cm_address_1'">
									{$this->lang->words['cm_address']}
								<else />
									<if test="isAddress2:|:$f['f_column'] == 'cm_address_2'">
										&nbsp;
									<else />
										{$f['f_name']}
									</if>
								</if>
								<if test="loopPurchaseRequired:|:$f['f_purchase_require']">
									&nbsp;<span class='ipsForm_required'>*</span>
								</if>
							</label>
							<p class='ipsField_content'>
								<input type='text' id='{$f['f_column']}' name='{$f['f_column']}' maxlength='255' value='{$member[ $f['f_column'] ]}' class='input_text' />
								<if test="textError:|:in_array( $f['f_column'], $errors )">
									<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
								</if>
							</p>
						</li>
					</if>
					<if test="isDropdown:|:$f['f_type'] == 'dropdown'">
						<li class='ipsField ipsField_select clearfix'>
							<label for='{$f['f_column']}' class='ipsField_title'>
								{$f['f_name']}
								<if test="fieldIsRequired:|:$f['f_purchase_require']">
									&nbsp;<span class='ipsForm_required'>*</span>
								</if>
							</label>
							<div class='ipsField_content'>
								<select name='{$f['f_column']}' id='{$f['f_column']}' <if test="isCountry:|:$f['f_column'] == 'cm_country'">onchange='states()'</if>>
									<foreach loop="options:explode( "\n", $f['f_extra'] ) as $k => $v">
										{parse variable="selected" default="" oncondition="$v == $member[ $f['f_column'] ] or $k == $member[ $f['f_column'] ]" value=" selected='selected'"}
										<option value='<if test="isCountrySelect:|:$f['f_column'] == 'cm_country'">{$v}<else />{$k}</if>'{parse variable="selected"}><if test="isCountryWords:|:$f['f_column'] == 'cm_country'">{$this->lang->words['nc_'.$v]}<else />{$v}</if></option>
									</foreach>
								</select>
								<if test="dropdownError:|:in_array( $f['f_column'], $errors )">
									<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
								</if>
							</div>
						</li>
					</if>
					<if test="isSpecial:|:$f['f_type'] == 'special'">
						<li class='ipsField clearfix'>
							<label for='cm_state' class='ipsField_title'>
								{$this->lang->words['cm_state']}
								<if test="purchaseRequiresState:|:$f['f_purchase_require']">
									<span class='ipsForm_required'>&nbsp;*</span><span id='id='state-required'></span>
								<else />
									<span class='ipsForm_required' id='state-required' style='display:none'>&nbsp;*</span>
								</if>
							</label>
							<div class='ipsField_content'>
								<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$member['cm_state']}' />
								<foreach loop="statesCountries:$states as $country => $_states">
									<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
										<foreach loop="states:$_states as $s">
											{parse variable="selected" default="" oncondition="$s[0] == $member['cm_state']" value=" selected='selected'"}
											<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
										</foreach>
									</select>
								</foreach>
								<if test="specialError:|:in_array( $f['f_column'], $errors )">
									<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
								</if>
							</div>
						</li>
					</if>
				</foreach>
			</ul>
			<p class='padding'>
				<input type='submit' value='{$this->lang->words['checkout_continue']}' class='button full_width' />
			</p>
	</div>
</form>
<script type='text/javascript'>
	function states()
	{
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'inline';
			
			_display = c + '-states';
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'none';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
	
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
</script>]]></template_content>
      <template_name>enterDetails</template_name>
      <template_data>$errors, $fields, $states, $member, $taxable, $invoice, $maxStep</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse template="orderProgress" group="nexus_payments" params="4, 4, $invoice->getOrderProgress(), $invoice->id"}
<div class='ipsPad row2 altrow'>
	<div class='block_inner pad' style='text-align:center'>
		{$button}
	</div>
</div>]]></template_content>
      <template_name>extraStep</template_name>
      <template_data>$invoice, $button</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['gv_buy']}</h2>
<form action="{parse url="app=nexus&amp;module=payments&amp;do=do_vouchers" base="public"}" method="post">
	<ul class='ipsForm ipsForm_vertical'>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['gv_amount']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				<foreach loop="$options as $o">
					<label for='amount_{$o}' <if test="$o == '*'">onclick="$('gv_other').style.display=''"<else />onclick="$('gv_other').style.display='none'"</if>>
						<if test="$o == '*'">
							<input id='amount_{$o}' type='radio' name='amount' value='$o' style='margin-bottom: 6px' <if test="( isset( $this->request['amount'] ) and $this->request['amount'] == $o ) or count( $options ) == 1">checked='checked'</if> /> {$this->lang->words['gv_other']}
						<else />
							<input id='amount_{$o}' type='radio' name='amount' value='$o' style='margin-bottom: 6px' <if test="( isset( $this->request['amount'] ) and $this->request['amount'] == $o ) or count( $options ) == 1">checked='checked'</if> /> {parse currency="$o"}
						</if>
						<br />
					</label>
				</foreach>
				<div id='gv_other' <if test="count( $options ) > 1 or !in_array( '*', $options )">style='display:none'</if>>
					<input class='input_text no_width' name='other_amount' size=='3' value='{$this->request['other_amount']}' /> {$this->settings['nexus_currency']}
				</div>
				<if test="isset( $errors['amount'] )">
					<span class='error'>{$errors['amount']}</span>
				</if>
			</div>
		</li>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['gv_method']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				<label for='method_email' onclick="$('gv_recipient_email' ).style.display=''"><input id='method_email' type='radio' name='method' value='email' style='margin-bottom: 6px' <if test="isset( $this->request['method'] ) and $this->request['method'] == 'email'">checked='checked'</if> /> {$this->lang->words['gv_email']}</label><br />
				<label for='method_print' onclick="$('gv_recipient_email' ).style.display='none'"><input id='method_print' type='radio' name='method' value='print' style='margin-bottom: 6px' <if test="isset( $this->request['method'] ) and $this->request['method'] == 'print'">checked='checked'</if> /> {$this->lang->words['gv_print']}</label><br />
				<if test="isset( $errors['method'] )">
					<span class='error'>{$errors['method']}</span>
				</if>
			</div>
		</li>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['gv_recipient_name']}</label>
			<div class='ipsField_content'>
				<input class='input_text' name='recipient_name' value='{$this->request['recipient_name']}' />
			</div>
		</li>
		<li class='ipsField' id='gv_recipient_email' <if test="!isset( $this->request['method'] ) or $this->request['method'] != 'email'">style='display:none'</if>>
			<label class='ipsField_title'>{$this->lang->words['gv_recipient_email']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				<input class='input_text' name='gv_recipient_email' value='{$this->request['gv_recipient_email']}' />
				<if test="isset( $errors['gv_recipient_email'] )">
					<br />
					<span class='error'>{$errors['gv_recipient_email']}</span>
				</if>
			</div>
		</li>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['gv_sender']}</label>
			<div class='ipsField_content'>
				<input class='input_text' name='sender' value='<if test="isset( $this->request['sender'] )">{$this->request['sender']}<else />{$this->memberData['members_display_name']}</if>' />
			</div>
		</li>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['gv_message']}</label>
			<div class='ipsField_content'>
				{parse editor="message" content="$messageContent" options="array()"}
			</div>
		</li>
	</ul>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['gv_buy']}' class='button full_width' />
	</fieldset>
</form>]]></template_content>
      <template_name>giftVouchers</template_name>
      <template_data><![CDATA[$options, $errors=array(), $messageContent='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<input type='hidden' name='serverToUse' value='{$serverToUse['server_id']}' />
	<li class='ipsField'>
		<label for='domain_option' class='ipsField_title'>{$this->lang->words['hosting_domain']}</label>	
		<if test="subDomains:|:!empty( $subDomainOptions )">
			<label for='domain_option_subdomain' style='padding: 7px'><input name='domain_option' id='domain_option_subdomain' type='radio' class='input_radio' value='subdomain' onchange='changeOption()' /> {$this->lang->words['hosting_domain_subdomain']}</label><br />
		</if>
		<if test="purchaseDomain:|:!empty( $tldOptions )">
			<label for='domain_option_buy' style='padding: 5px'><input name='domain_option' id='domain_option_buy' type='radio' class='input_radio' value='buy' onchange='changeOption()' /> {$this->lang->words['hosting_domain_buy']}</label><br />
		</if>
		<if test="ownDomain:|:$serverToUse['server_nameservers']">
			<label for='domain_option_own' style='padding: 5px'><input name='domain_option' id='domain_option_own' type='radio' class='input_radio' value='own' onchange='changeOption()' /> {$this->lang->words['hosting_domain_own']}</label><br />
		</if>
	</li>
	<li class='ipsField' id='options_subdomain' style='display:none'>
		http:// <input name='suburl' id='url' type='text' class='input_text no_width' /> 
		<if test="justOne:|:count( $subDomainOptions ) == 1">
			<foreach loop="subDomainsOptions:$subDomainOptions as $v">
				<input type='hidden' name='domain' value='{$v}' />
				.{$v}
			</foreach>
		<else />
			. <select name='domain' id='domain' class='input_select no_width'>
				<foreach loop="subDomainOptions2:$subDomainOptions as $v">
					<option value='{$v}'>{$v}</option>
				</foreach>
			</select>
		</if>
		
	</li>
	<li class='ipsField' id='options_own' style='display:none'>
		http:// <input name='url' id='url' type='text' class='input_text no_width' />
		<p class='message' style='margin-top:10px'>
			{$this->lang->words['hosting_nameservers']}<br />
			{parse expression="str_replace("\n", '<br />', $serverToUse['server_nameservers'])"}
		</p>
	</li>
	<li class='ipsField' id='options_buy' style='display:none'>
		http:// <input name='sld' id='sld' type='text' class='input_text no_width' />
		<select name='tld'>
			<foreach loop="$tldOptions as $o">
				<option value='{$o[0]}'>{$o[1]}</option>
			</foreach>
		</select>
	</li>
	
<script type='text/javascript'>	
	function changeOption( id )
	{
		if ( $('options_subdomain') !== null )
		{			
			$('options_subdomain').style.display = 'none';
		}
		
		if ( $('options_own') !== null )
		{
			$('options_own').style.display = 'none';
		}
		
		if ( $('options_buy') !== null )
		{
			$('options_buy').style.display = 'none';
		}
		
		if( $('domain_option_subdomain') !== null && $('domain_option_subdomain').checked )
		{
			$('options_subdomain').style.display = '';
		}
		else if ( $('domain_option_own') !== null && $('domain_option_own').checked )
		{
			$('options_own').style.display = '';
		}
		else if ( $('domain_option_buy') !== null && $('domain_option_buy').checked )
		{
			$('options_buy').style.display = '';
		}
	}
</script>]]></template_content>
      <template_name>hostingForm</template_name>
      <template_data>$subDomainOptions, $serverToUse, $tldOptions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.mobile.nexus.js'></script>
<script type='text/javascript'>
	nexus.guestCheckout.init();
</script>
<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
</script>
{parse template="orderProgress" group="nexus_payments" params="1, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<h2>{parse template="secure_badge" group="nexus_payments" params=""}{$this->lang->words['store_checkout']}</h2>
<if test="empty($errors)">
	<div class='master_list' id='choose_path'>
		<div class='row'>
			<span>{$this->lang->words['mobile_register_q']}</span>
			<br /><br /><br />
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=login&amp;id={$invoice->id}&amp;secure_key={$this->member->form_hash}" base="public"}' id='checkout_login' class='button full_width'>{$this->lang->words['mobile_register_old']}</a>
			<br /><br />
			<a href='#' id='checkout_register' class='button full_width'>{$this->lang->words['mobile_register_new']}</a>
			<br /><br />
		</div>
	</div>
</if>
<div class='master_list' id='checkout_register_form' <if test="empty($errors)">style='display: none'</if>>
	<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=register" base="{$this->settings['nexus_https']}"}' method='post'>
		<input type='hidden' name='id' value='{$invoice->id}' />
		<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
		<div class='row center'>
			<span class='required'><strong>* Required fields</strong></span>
		</div>
		<ul class='ipsForm_vertical'>
			<if test="username:|:$this->settings['nexus_checkreg_usernames']">
				<li class='ipsField'>
					<label for='username' class='ipsField_title'>{$this->lang->words['reg_choose_user']}<span class='required'>*</span></label>
					<p class='ipsField_content'>
						<input type='text' id='username' name='username' value='{$member['username']}' class='input_text email' />
						<if test="errorsUsername:|:$errors['username']"><span class='error'>{$errors['username']}</span></if>
						<br /><span class='desctext'>{$this->lang->words['char_cant_use']}</em></span>
					</p>
				</li>
				<if test="displayname:|:$this->settings['auth_allow_dnames']">
					<li class='ipsField'>
						<label for='displayname' class='ipsField_title'>{$this->lang->words['reg_choose_dname']}<span class='required'>*</span></label>
						<p class='ipsField_content'>
							<input type='text' id='displayname' name='displayname' value='{$member['displayname']}' class='input_text email' />
							<if test="errorsDisplayname:|:$errors['displayname']"><span class='error'>{$errors['displayname']}</span></if>
							<br /><span class='desctext'>{parse expression="sprintf( $this->lang->words['dname_desc'], $this->settings['max_user_name_length'])"}</em></span>
						</p>
					</li>
				</if>
			</if>
			<li class='ipsField'>
				<label for='email' class='ipsField_title'>{$this->lang->words['cm_email']}<span class='required'>*</span></label>
				<p class='ipsField_content'>
					<input type='text' id='email' name='email' value='{$member['email']}' class='input_text email' />
					<if test="errorsEmail:|:$errors['email']"><span class='error'>{$errors['email']}</span></if>
				</p>
			</li>
			<li class='ipsField'>
				<label for='password1' class='ipsField_title'>{$this->lang->words['cm_password']}<span class='required'>*</span></label>
				<p class='ipsField_content'>
					<input type='password' id='password1' name='password1' class='input_text password' value='{$member['password1']}' />
					<if test="errorsPassword1:|:$errors['password1']"><span class='error'>{$errors['password1']}</span></if>
				</p>
			</li>
			<li class='ipsField'>
				<label for='password2' class='ipsField_title'>{$this->lang->words['cm_password_confirm']}<span class='required'>*</span></label>
				<p class='ipsField_content'>
					<input type='password' id='password2' name='password2' class='input_text password' value='{$member['password2']}' />
					<if test="errorsPassword2:|:$errors['password2']"><span class='error'>{$errors['password2']}</span></if>
				</p>
				<br />
			</li>
		</ul>
		<h3>{$this->lang->words['personal_info']}</h3>
		<ul class='ipsForm_vertical'>
			<foreach loop="fields:$fields as $f">
				<if test="isText:|:$f['f_type'] == 'text'">
					<li class='ipsField'>
						<if test="isAddress2:|:$f['f_column'] != 'cm_address_2'">
							<label for='{$f['f_column']}' class='ipsField_title'><if test="isAddress1:|:$f['f_column'] == 'cm_address_1'">{$this->lang->words['cm_address']}<else /><if test="isAddress2:|:$f['f_column'] == 'cm_address_2'">&nbsp;<else />{$f['f_name']}</if></if><if test="$f['f_purchase_require']"><span class='required'>*</span></if></label>
						</if>
						<p class='ipsField_content'>
							<input type='text' id='{$f['f_column']}' name='{$f['f_column']}' maxlength='255' value='{$member[ $f['f_column'] ]}' class='input_text' />
							<if test="errorsText:|:$errors[ $f['f_column'] ]"><span class='error'>{$errors[ $f['f_column'] ]}</span></if>
						</p>
					</li>
				</if>
				<if test="isDropdown:|:$f['f_type'] == 'dropdown'">
					<li class='ipsField'>
						<label for='{$f['f_column']}' class='ipsField_title'>{$f['f_name']}<if test="$f['f_purchase_require']"><span class='required'>*</span></if></label>
						<p class='ipsField_content'>
							<select name='{$f['f_column']}' id='{$f['f_column']}' <if test="isCountry:|:$f['f_column'] == 'cm_country'">onchange='states()'</if>>
							<foreach loop="options:explode( "\n", $f['f_extra'] ) as $k => $v">
								{parse variable="selected" default="" oncondition="$v == $member[ $f['f_column'] ] or $k == $member[ $f['f_column'] ]" value=" selected='selected'"}
								<option value='<if test="isCountrySelect:|:$f['f_column'] == 'cm_country'">{$v}<else />{$k}</if>'{parse variable="selected"}><if test="isCountryWords:|:$f['f_column'] == 'cm_country'">{$this->lang->words['nc_'.$v]}<else />{$v}</if></option>
							</foreach>
							</select>
							<if test="errorsCountry:|:$errors[ $f['f_column'] ]"><span class='error'>{$errors[ $f['f_column'] ]}</span></if>
						</p>
					</li>
				</if>
				<if test="isSpecial:|:$f['f_type'] == 'special'">
					<li class='ipsField'>
						<label for='cm_state' class='ipsField_title'>{$this->lang->words['cm_state']}<if test="$f['f_purchase_require']"><span class='required'>*</span></if></label>
						<p class='ipsField_content'>
							<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$member['cm_state']}' />
							<foreach loop="statesCountries:$states as $country => $_states">
								<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
									<foreach loop="states:$_states as $s">
										{parse variable="selected" default="" oncondition="$s[0] == $member['cm_state']" value=" selected='selected'"}
										<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
									</foreach>
								</select>
							</foreach>
							<if test="errorsSpecial:|:$errors[ $f['f_column'] ]"><span class='error'>{$errors[ $f['f_column'] ]}</span></if>
						</p>
					</li>
				</if>
			</foreach>
		</ul>
		<if test="customProfileFields:|:!empty($customProfileFields)">
			<h3>{$this->lang->words['checkout_cpf']}</h3>
			<ul class='ipsForm_vertical'>
				<foreach loop="pfields:$customProfileFields as $_field">
					<li class='ipsField {$_field['type']}'>
						<label for='cprofile_{$_field['id']}' class='ipsField_title'>{$_field['name']}</label>
						<p class='ipsField_content'>
							{$_field['field']}
							<if test="hasDesc:|:$_field['desc'] != ''"><span class='desc'>{$_field['desc']}</span></if>
							<if test="errorsPfields:|:$errors['field_'.$_field['id']]"><span class='error'>{$errors['field_'.$_field['id']]}</span></if>
						</p>
					</li>
				</foreach>
			</ul>
		</if>
		
		<if test="spamCheck:|:$captchaHTML or !empty($question)">
			<h3>{$this->lang->words['checkout_captcha']}</h3>
			<ul class='ipsForm_vertical'>
				<if test="qAndA:|:!empty($question)">
					<li class='ipsField'>
						<label for='zip' class='ipsField_title'>{$question['qa_question']}<span class='required'>*</span></label>
						<p class='ipsField_content'>
							<input type='text' name='qa_answer' value='' class='input_text' />
							<input type='hidden' name='qanda_id' value='{$question['qa_id']}' />
							<if test="errorsQAndA:|:$errors['qanda']"><span class='error'>{$errors['qanda']}</span></if>
						</p>
					</li>
				</if>
				<if test="captcha:|:$captchaHTML">
					<li class='ipsField'>
						{$captchaHTML}
						<if test="errorsCaptcha:|:$errors['captcha']"><span class='error'>{$errors['captcha']}</span></if>
					</li>
				</if>
			</ul>
		</if>
		<div class='row center cart_total'>
			{$this->lang->words['store_total']}: {parse currency="$invoice->total"}
		</div>
		<div class='controls'>
			<div class='buttons'>
				<input type='submit' value='{$this->lang->words['checkout_continue']}' class='button full_width' />
			</div>
		</div>
	</form>
</div>
<script type='text/javascript'>
	function states()
	{
		var s = $('text-states').value.toLowerCase();
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			_display = c + '-states';
			$( c + '-states' ).select('option').each ( function ( elem ) {
				if ( elem.value.toLowerCase() == s || elem.innerHTML.toLowerCase() == s )
				{
					elem.selected = true;
				}
			} );
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
	
</script>]]></template_content>
      <template_name>loginOrRegister</template_name>
      <template_data>$errors, $fields, $states, $member, $invoice, $customProfileFields, $time_select, $captchaHTML, $question, $maxStep</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<div class='category_block block_wrap'>
	{parse template="subTabLoop" group="modcp" params=""}
	<if test="empty( $results )">
		<div class='no_messages'>{$this->lang->words['ur_none']}</div>
	<else />
		<table class='ipb_table'>
			<foreach loop="$results as $r">
				<tr>
					<td>
						<a href="{parse url="app=nexus&mpduke=payments&section=store&do=item&id={$r['p_id']}" base="public" template="showitem" seotitle="{$r['p_so_name']}"}" class='topic_title'>{$r['p_name']}</a><br />
						<foreach loop="range( 1, 5 ) as $i">
							<if test="$r['review_rating'] >= $i">
								{parse replacement="rate_on"}
							<else />
								{parse replacement="rate_off"}
							</if>
						</foreach> {$this->lang->words['by']} {parse template="userHoverCard" group="global" params="$r"}
						<br />
						<br />
						{$r['review_text']}
						<br />
					</td>
					<td style='min-width: 150px'>
						<ul class='ipsList_inline right'>
							<li>
								<a href='{parse url="app=core&module=modcp&fromapp=nexus&tab=unapprovedreviews&amp;do=approve&amp;id={$r['review_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' class='ipsButton_secondary ipsType_smaller'>{$this->lang->words['modcp_approvelink']}</a>
							</li>
							<li>
								<a href='{parse url="app=core&module=modcp&fromapp=nexus&tab=unapprovedreviews&amp;do=delete&amp;id={$r['review_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' class='ipsButton_secondary ipsType_smaller important'>{$this->lang->words['modcp_deletelink']}</a>
							</li>
						</ul>
					</td>
				</tr>
			</foreach>
		</table>
	</if>
	</table>
</div>]]></template_content>
      <template_name>moderatorPanel</template_name>
      <template_data>$results</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<php>
	$this->templateVars['step_count'] = 1;
</php>
<div class='ipsSteps clearfix'  style='display: none'>
	<ul>
		<foreach loop="step:$steps as $idx => $text">
			<li class="<if test="isCurrent:|:$idx == ( $this->request['step'] ? $this->request['step'] : $curStep )">ipsSteps_active<else /><if test="isDone:|:$idx < $maxStep">ipsSteps_done</if></if>" <if test="isClickable:|:$curStep != 4 and $idx != 0 and $idx <= $maxStep">onclick='window.location = "{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoiceId}&amp;step={$idx}" base="{$this->settings['nexus_https']}"}";' style='cursor:pointer'</if>>
				<strong class='ipsSteps_title'>{parse expression="sprintf($this->lang->words['public_step'], $this->templateVars['step_count'])"}</strong>
				<span class='ipsSteps_desc'>{$text}</span>
				<span class='ipsSteps_arrow'>&nbsp;</span>
				<!--Don't delete: {parse expression="$this->templateVars['step_count']++"}-->
			</li>
		</foreach>
	</ul>
</div>]]></template_content>
      <template_name>orderProgress</template_name>
      <template_data>$curStep, $maxStep, $steps, $invoiceId</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['checkout_thanks']}</h3>
<div class='master_list'>
	<div class='row'>
		<strong>{$this->lang->words['checkout_pending_1']}</strong><br />
		{$this->lang->words['checkout_pending_2']} {parse expression="sprintf( $this->lang->words['checkout_review'], "<a href='{parse url="app=nexus&amp;module=clients" base="public"}' title='{$this->lang->words['goto_client_area']}'>{$this->lang->words['client_area_']}</a>")"}
		<br /><br />
		{$this->lang->words['checkout_thanks_2']}
	</div>
	<if test="instructions2:|:!empty( $instructions )">
		<div class='row'>{$instructions}</div>
	</if>
</div>]]></template_content>
      <template_name>payment_onhold</template_name>
      <template_data>$invoice, $instructions, $showSteps=TRUE, $allowCancel=FALSE</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['gv_redeem']}</h2>
<if test="hasError:|:$error">
	<p class='message error'>{$error}</p>
</if>
<form action="{parse url="app=nexus&amp;module=payments&amp;do=do_redeem" base="public"}" method="post">
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<ul class='ipsForm ipsForm_vertical'>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['gv_redeem_code']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				<input class='input_text' name='code' value='{$this->request['code']}' />
			</div>
		</li>
	</ul>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['gv_redeem']}' class='button full_width' />
	</fieldset>
</form>]]></template_content>
      <template_name>redeem</template_name>
      <template_data>$error</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="haserror:|:$error">
	<p class='message error'>{$error}</p>
</if>
<div class='master_list'>
	<form action="{parse url="app=core&amp;module=global&amp;section=register&amp;agree_tos=1" base="public"}" method="post" name="REG" id='register'>
		<input type='hidden' name='nexus_pass' value='1' />
		<div class='row post line_spacing'>
			{$this->lang->words['nexusreg_blurb_1']}
			<if test="forceBuy:|:!$this->settings['nexus_reg_force']"><br /><em class='desc'>{$this->lang->words['nexusreg_blurb_2']}</em></if>
		</div>
		<div class='row post line_spacing'>
			<foreach loop="packages:$packages as $packageID => $package">
				<label for='package-{$packageID}'>
					<input id='package-{$packageID}' type='checkbox' name='cm_package[]' value='{$packageID}' {$package['checked']} /> &nbsp;&nbsp;{$package['p_name']} - {$this->lang->formatMoney( $package['p_base_price'], FALSE )}  <if test="renewalTerms:|:$package['renewal']">({$this->lang->words['renewal_prefix']} {$package['renewal']})</if><br />
					<span class='desc' style='padding-left:50px'>{$package['blurb']}</span>
				</label>
				<br />
			</foreach>
		</div>
		<div class='submit'>
			<input type='submit' class='button' id='register_submit' value='{$this->lang->words['register']}' />
		</div>
	</form>
</div>]]></template_content>
      <template_name>regForm32</template_name>
      <template_data><![CDATA[$packages, $error='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h3>{parse expression="sprintf( $this->lang->words['review_product'], $package['p_name'] )"}</h3>
<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=save_review" base="public"}' method='post'>
	<input type='hidden' name='id' value='{$package['p_id']}' />
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<ul class='ipsForm ipsForm_vertical'>
		<li class='ipsField ipsField_select'>
			<label class='ipsField_title'>{$this->lang->words['review_rating']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				<select name='rating'>
					<option value='0'>{$this->lang->words['review_select']}</option>
					<foreach loop="range( 1, 5 ) as $r">
						<option value='{$r}' <if test="$this->request['rating'] == $r">selected='selected'</if>>{parse expression="sprintf( $this->lang->words['rating_outof'], $r, 5 )"}</option>
					</foreach>
				</select><br />
				<span class='error'>{$errors['rating']}</span>
			</div>
		</li>
		<li class='ipsField'>
			<label class='ipsField_title'>{$this->lang->words['review_review']} <span class='ipsForm_required'>*</span></label>
			<div class='ipsField_content'>
				{$editor}<br />
				<span class='error'>{$errors['review']}</span>
			</div>
		</li>
	</ul>
	<fieldset class='submit'>
		<input type='submit' class='button full_width' value='{$this->lang->words['review_save']}' />
	</fieldset>
</form>]]></template_content>
      <template_name>reviewForm</template_name>
      <template_data>$package, $editor, $errors</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="$this->settings['nexus_https'] == 'https'"><span class='right https'>{$this->lang->words['checkout_secure']} &nbsp;<img src='{$this->settings['img_url']}/nexus/https.png' alt='' /></span></if>]]></template_content>
      <template_name>secure_badge</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.nexus.checkout.js'></script>
<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.mobile.nexus.js'></script>
<script type='text/javascript'>
	ipb.lang['offline_payment'] = "{$this->lang->words['checkout_offline_pay']}";
	ipb.lang['checkout_nomethod'] = "{$this->lang->words['checkout_nomethod']}";
	ipb.lang['checkout_accept_terms'] = "{$this->lang->words['checkout_accept_terms']}";
	
	nexus.checkout.totalMethods = parseInt( {parse expression="count( $methods )"} );
	<if test="count($methods) === 1">
		<foreach loop="methodJs:$methods as $method">
			nexus.checkout.firstMethod = parseInt({$method['m_id']});
		</foreach>
	</if>
	nexus.checkout.init("{parse url="app=nexus&module=ajax&section=store" base="{$this->settings['nexus_https']}"}&invoice={$invoice->id}&transid={$transaction['t_id']}&secure_key={$this->member->form_hash}");
</script>
<h2>{parse template="secure_badge" group="nexus_payments" params=""}{$this->lang->words['store_checkout']}</h2>
{parse template="orderProgress" group="nexus_payments" params="2, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
	
	<h3>{$this->lang->words['checkout_confirm']}</h3>
	<div class='master_list cart_review'>
		<foreach loop="items:$items as $item">
			<div class='row'>
				<span class='price right'>
					{parse currency="$item['line']"}
				</span>
				<h4>
					<span class='desc'>{$item['quantity']} x </span>{$item['itemName']}
				</h4>
			</div>
		</foreach>
		<if test="discount:|:$discount">
			<div class='row subtotal'>
				<span class='price right'>- {parse currency="$difference"}</span>
				<h4>{$discount}% {$this->lang->words['store_bundle_discount']}</h4>
			</div>
		</if>
		<div class='row subtotal'>
			<span class='price right'>{parse currency="$subtotal"}</span>
			<h4>{$this->lang->words['store_subtotal']}</h4>
		</div>
		<if test="tax:|:$tax">
			<div class='row subtotal'>
				<span class='price right'>{parse currency="$tax"}</span>
				<h4>{$this->lang->words['store_tax']}</h4>
			</div>
		</if>
		<if test="shipping:|:$shipping">
			<div class='row subtotal'>
				<span class='price right'>{parse currency="$shipping"}</span>
				<h4>{$this->lang->words['store_shipping']}</h4>
			</div>
		</if>
		<div class='row subtotal total'>
			<span class='price right'>{parse currency="$invoice->total"}</span>
			<h4>{$this->lang->words['store_total']}</h4>
		</div>
	</div>
	<if test="showCoupons:|:$showCoupons">
		<h3>{$this->lang->words['checkout_coupon_mini']}</h3>
		<div class='master_list'>
			<div class='row'>
				<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=coupon&amp;id={$invoice->id}" base="{$this->settings['nexus_https']}"}' method='post'>
					<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
					<p class='padding'>
						<span id='use_coupon'>
							<img src='{$this->settings['img_url']}/nexus/coupon.png' alt='{$this->lang->words['icon']}' id='coupon_img' /><input type='text' size='20' name='code' id='coupon_code' class='input_text' style='width: 60%;' placeholder='{$this->lang->words['checkout_coupon_code_mini']}' /> <input type='submit' class='button secondary' value='{$this->lang->words['checkout_coupon_apply']}' style='width: 30%;' />
						</span>
					</p>
				</form>
			</div>
		</div>
	</if>
<form action='{parse url="app=nexus&amp;module=payments&amp;section=receive&amp;do=validate" base="{$this->settings['nexus_https']}"}' method='post' id='do_pay'>
	<input type='hidden' name='invoice' value='{$invoice->id}' />
	<input type='hidden' name='transid' id='transid' value='0' />
	<input type='hidden' name='hidden_field' id='hidden_field' value='' />
	<h3>{$this->lang->words['checkout_cp_pay']}</h3>
	<if test="error:|:$error">
		<div class='message error padding'>
			{$error}
		</div>
	</if>
	<div class='master_list'>
		<if test="hasCredit:|:$this->memberData['cm_credits']">
			<div class='row center'>
				<a class='button secondary' href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=credit&amp;id={$invoice->id}&amp;secure_key={$this->member->form_hash}" base="public"}'>{parse expression="sprintf( $this->lang->words['store_credit_mobile'], "{parse currency="$this->memberData['cm_credits']"}")"}</a>
			</div>
		</if>				
		<div class='row' id='payment_toggle_wrap'>
			<p id='method_dropdown' class='padding'>
				<select name='method_id' class='input_select full_width' id='payment_toggle' style='font-size: 16px;'>
					<option value='--'>{$this->lang->words['checkout_type_select']}</option>
					<foreach loop="methods:$methods as $method">
						<option value='{$method['m_id']}'>{$method['m_name']}</option>
					</foreach>
				</select>
			</p>
		</div>
		<div id='methods'></div>
	</div>
	
	<if test="$this->settings['nexus_tac']">
		<div class='ipsForm_vertical'>
			<div class='ipsField'>
				<div class='tac padding' id='tac'>
					<if test="tacCheckbox:|:$this->settings['nexus_tac'] == 'checkbox'">
						<label for='tac-checkbox'><input type='checkbox' id='tac-checkbox' /> {parse expression="sprintf( $this->lang->words['checkout_terms_checkbox'], "{$this->settings['nexus_tac_link']}" )"}</label>
					</if>
					<if test="tacButton:|:$this->settings['nexus_tac'] == 'button'">
						<span class='desc'>{parse expression="sprintf( $this->lang->words['checkout_terms_button'], "{$this->settings['nexus_tac_link']}" )"}</span>
					</if>
				</div>
			</div>
		</div>
	</if>
	
	<div class='controls padding'>
		<div class='buttons' id='confirm'>
			<input id='pay_submit' type='submit' value='{$this->lang->words['checkout_confirm']}' class='button full_width' />
		</div>
	</div>
</form>]]></template_content>
      <template_name>selectMethod</template_name>
      <template_data>$invoice, $items, $subtotal, $tax, $shipping, $discount, $difference, $methods, $error, $showCoupons, $maxStep, $transaction, $previousTransactions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['store_checkout']}</h2>
{parse template="orderProgress" group="nexus_payments" params="2, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=shipping" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='id' value='{$invoice->id}' />
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<h3>{$this->lang->words['shipping_address']}</h3>
	<if test="in_array( 'address_verify', $errors )">
		<p class='message error'>{$this->lang->words['shipping_api_address_fail']}</p>
	</if>
	<div class='master_list'>
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField clearfix'>
				<label for='cm_first_name' class='ipsField_title'>
					{$this->lang->words['cm_first_name']}
					&nbsp;<span class='ipsForm_required'>*</span>
				</label>
				<p class='ipsField_content'>
					<input type='text' id='cm_first_name' name='cm_first_name' maxlength='255' value='{$shipAddress['cm_first_name']}' class='input_text' />
					<if test="in_array( 'cm_first_name', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</p>
			</li>
			<li class='ipsField clearfix'>
				<label for='cm_first_name' class='ipsField_title'>
					{$this->lang->words['cm_last_name']}
					&nbsp;<span class='ipsForm_required'>*</span>
				</label>
				<p class='ipsField_content'>
					<input type='text' id='cm_last_name' name='cm_last_name' maxlength='255' value='{$shipAddress['cm_last_name']}' class='input_text' />
					<if test="in_array( 'cm_last_name', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</p>
			</li>
			<li class='ipsField clearfix'>
				<label for='cm_address_1' class='ipsField_title'>
					{$this->lang->words['cm_address']}
					&nbsp;<span class='ipsForm_required'>*</span>
				</label>
				<p class='ipsField_content'>
					<input type='text' id='cm_address_1' name='cm_address_1' maxlength='255' value='{$shipAddress['cm_address_1']}' class='input_text' /><br />
					<input type='text' id='cm_address_2' name='cm_address_2' maxlength='255' value='{$shipAddress['cm_address_2']}' class='input_text' />
					<if test="in_array( 'cm_address_1', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</p>
			</li>
			<li class='ipsField clearfix'>
				<label for='cm_city' class='ipsField_title'>
					{$this->lang->words['cm_city']}
					&nbsp;<span class='ipsForm_required'>*</span>
				</label>
				<p class='ipsField_content'>
					<input type='text' id='cm_city' name='cm_city' maxlength='255' value='{$shipAddress['cm_city']}' class='input_text' />
					<if test="in_array( 'cm_city', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</p>
			</li>
			<li class='ipsField ipsField_select'>
				<label for='cm_state'  class='ipsField_title'>{$this->lang->words['cm_state']}</label>
				<div class='ipsField_content'>
					<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$shipAddress['cm_state']}' />
					<foreach loop="statesSelect:$states as $country => $_states">
						<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
							<foreach loop="states:$_states as $s">
								{parse variable="selected" default="" oncondition="$s[0] == $shipAddress['cm_state']" value=" selected='selected'"}
								<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
							</foreach>
						</select>
					</foreach>
					<if test="in_array( 'cm_state', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</div>
			</li>
			<li class='ipsField clearfix'>
				<label for='cm_zip' class='ipsField_title'>
					{$this->lang->words['cm_zip']}
					&nbsp;<span class='ipsForm_required'>*</span>
				</label>
				<p class='ipsField_content'>
					<input type='text' id='cm_zip' name='cm_zip' maxlength='255' value='{$shipAddress['cm_zip']}' class='input_text' />
					<if test="in_array( 'cm_zip', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</p>
			</li>
			<li class='ipsField ipsField_select'>
				<label for='cm_country' class='ipsField_title'>{$this->lang->words['cm_country']}</label>
				<div class='ipsField_content'>
					<select name='cm_country' id='cm_country' onchange='states()'>
						<foreach loop="$countries as $k => $v">
							<option value='{$k}' <if test="$k == $shipAddress['cm_country']">selected='selected'</if>>{$v}</option>
						</foreach>
					</select>
					<if test="in_array( 'cm_country', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</div>
			</li>
			<li class='ipsField clearfix'>
				<label for='cm_phone' class='ipsField_title'>
					{$this->lang->words['cm_phone']}
					&nbsp;<span class='ipsForm_required'>*</span>
				</label>
				<p class='ipsField_content'>
					<input type='text' id='cm_phone' name='cm_phone' maxlength='255' value='{$shipAddress['cm_phone']}' class='input_text' />
					<if test="in_array( 'cm_phone', $errors )">
						<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
					</if>
				</p>
			</li>
		</ul>
	</div>
	<h3>{$this->lang->words['checkout_ship_select']}</h3>
	<div class='master_list'>
		<div class='row'>
			<p class='line_spacing '>
				{$this->lang->words['checkout_ship_blurb_1']}
				{$this->lang->words['checkout_ship_blurb_2']}
			</p>
		</div>	
		<ul>
			<foreach loop="groups:$data['groupedItems'] as $groupID => $_items">
				<li class='row'>
					<strong>{parse expression="implode(', ', array_map( create_function( '$v', 'return $v["itemName"];' ), $_items ) )"}</strong><br />
					<select name='shipping[$groupID]'>
					<foreach loop="methods:$data['shipping'] as $id => $_methods">
						<if test="group:|:$id == $groupID">
							<foreach loop="options:$_methods as $k => $v">
								{parse variable="selected" default="" oncondition="$data['selected'][ $groupID ] == $k" value="selected='selected'"}
								<option value='{$k}' {parse variable="selected"}>{$v}</option>
							</foreach>
						</if>
					</foreach>
					</select>
				</li>
			</foreach>
		</ul>
		<div class='controls'>
			<div class='buttons'>
				<input type='submit' value='{$this->lang->words['checkout_continue']}' class='button' />
			</div>
		</div>
	</div>
</form>
<script type='text/javascript'>
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
</script>]]></template_content>
      <template_name>selectShipping</template_name>
      <template_data>$invoice, $shipAddress, $states, $countries, $data, $maxStep, $member, $errors</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h2>
	<a href='{parse url="app=nexus" base="public"}'>{$this->lang->words['store']}</a>
	<if test="hasCredit:|:$this->memberData['cm_credits']">
		<span style='font-size: 0.8em; margin-left: 110px'>{parse expression="sprintf( $this->lang->words['store_credit_short'], "{parse currency="$this->memberData['cm_credits']"}")"}</span>
	</if>
</h2>
{parse template="cart_sidebar" group="nexus_payments" params="$cart"}
{parse template="cat_menu_item" group="nexus_payments" params="$packageGroups[0], $hierarchy"}
<if test="($this->request['cat'] && !( $this->request['cat'] && count($curGroup['children'][ $this->request['cat'] ]['children']) )) || $this->request['featured'] || $this->request['popular'] || $this->request['latest']">
	<h3>{$title}</h3>	
	<div class='master_list product_list'>
		<if test="empty( $packages )">
			<p class='no_messages'>
				{$this->lang->words['store_empty']}
			</p>
		<else />
			<foreach loop="packages:$packages as $packageID => $package">
				<div class='row touch-row'>
					<if test="thumbnail:|:$package['thumbnail']">
						<div class='icon'>
							<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id=$packageID" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'><img src='{$package['thumbnail']}' {parse resize_image="{$package['thumbnail']}" maxwidth="60" maxheight="60"} /></a>
						</div>
					</if>
					<div class='rowContent'>
						<h4 class='product_title'>
							<a class='title' href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id=$packageID" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>{IPSText::truncate( $package['p_name'], 25 )}</a>
						</h4>
						<if test="description:|:$package['p_desc']">
							{IPSText::truncate( $package['blurb'], 40 )}
						</if>
						
						<span class='price'>{$this->lang->formatMoney( $package['p_base_price'], FALSE )}</span>
						<if test="renewalTerms:|:$package['renewal']">
							<span class='subtext'>{$this->lang->words['store_renewal']} {$package['renewal']}</span>
						</if>
					</div>
				</div>
			</foreach>
		</if>
	</div>
<else />
	<h3 class='inline_header'>{$this->lang->words['store']}</h3>	
	<div class='master_list alternate'>
		<if test="$featured">
			<div class='row touch-row'>
				<a class='title' href='
				{parse url="app=nexus&amp;module=payments&amp;section=store&amp;featured=1&amp;view=list" base="public" template="store-featured" seotitle="featured"}' title='{$this->lang->words['store__featured']}'>{$this->lang->words['store_featured']}</a>
			</div>
		</if>
		<div class='row touch-row'>
			<a class='title' href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;popular=1&amp;view=list" base="public" template="store-popular" seotitle="popular"}' title='{$this->lang->words['store__popular']}'>{$this->lang->words['store_popular']}</a> 
		</div>
		<div class='row touch-row'>
			<a class='title' href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;latest=1&amp;view=list" base="public" template="store-latest" seotitle="latest"}' title='{$this->lang->words['store__latest']}'>{$this->lang->words['store_latest']}</a> 
		</div>
	</div>
</if>]]></template_content>
      <template_name>showStore</template_name>
      <template_data>$packages, $packageGroups, $hierarchy, $cart, $title, $featured, $pagination, $cat</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>storeGridView</template_name>
      <template_data>$package</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<!--no data in this master skin-->]]></template_content>
      <template_name>storeListView</template_name>
      <template_data>$package</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="thumbnail:|:$r['thumbnail']">
	<span class='icon'>
		<img class='left' src='{$r['thumbnail']}' {parse resize_image="{$r['thumbnail']}" maxwidth="100"}/>
	</span>
</if>
<div class='result_info'>
	<h3><a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$r['p_id']}" base="public" template="storeitem" seotitle="{$r['p_seo_name']}"}'>{$r['p_name']}</a></h3>
	<p>{$r['blurb']}</p>
</p>
</div>]]></template_content>
      <template_name>storeSearch</template_name>
      <template_data>$r</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['checkout_thanks']}</h3>
<div class='master_list'>
	<div class='row'>
		{$this->lang->words['checkout_approved']}
	</div>
	<if test="instructions2:|:!empty( $instructions )">
		<div class='row'>{$instructions}</div>
	</if>
</div>
<div class='master_list product_list'>
	<foreach loop="purchases:$invoice->getPurchases() as $i">
		{parse template="purchaseRow" group="nexus_clients" params="$i, array(), array()"}
	</foreach>
</div>]]></template_content>
      <template_name>thanks</template_name>
      <template_data>$invoice, $instructions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<p class='message'>
	{$this->lang->words['cart_added']}{$added['p_name']}
	<a href='{parse url="app=nexus&amp;module=payments&amp;section=store" base="public" template="app=nexus" seotitle="nexus"}' class='right'>{$this->lang->words['cart_continue']} {$this->lang->words['_rarr']}</a>
</p>
<h3>{$this->lang->words['store_upsell']}</h3>	
<div class='master_list product_list'>
	<foreach loop="packages:$packages as $packageID => $package">
		<div class='row touch-row'>
			<if test="thumbnail:|:$package['thumbnail']">
				<div class='icon'>
					<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id=$packageID" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'><img src='{$package['thumbnail']}' {parse resize_image="{$package['thumbnail']}" maxwidth="60" maxheight="60"} /></a>
				</div>
			</if>
			<div class='rowContent'>
				<h4 class='product_title'>
					<a class='title' href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id=$packageID" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>{IPSText::truncate( $package['p_name'], 25 )}</a>
				</h4>
				<if test="description:|:$package['p_desc']">
					{IPSText::truncate( $package['blurb'], 40 )}
				</if>
				
				<span class='price'>{$this->lang->formatMoney( $package['p_base_price'], FALSE )}</span>
				<if test="renewalTerms:|:$package['renewal']">
					<span class='subtext'>{$this->lang->words['store_renewal']} {$package['renewal']}</span>
				</if>
			</div>
		</div>
	</foreach>
</div>]]></template_content>
      <template_name>upsell</template_name>
      <template_data>$added, $packages, $cart</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['store_cart']}</h2>
<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=update_cart" base="public"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	
	<div class='master_list product_list cart_view'>
		<if test="items:|:count( $cart['items'] )">
			<foreach loop="cartitems:$cart['items'] as $id => $i">
				<if test="isset( $i['_cfields'] )">
					<foreach loop="cfields:$i['_cfields'] as $k => $v">
						
						<div class='row'>
							<if test="image:|:$i['packageData']['thumbnail']">
								<div class='icon'>
									<img src="{$i['packageData']['thumbnail']}" {parse resize_image="{$i['packageData']['thumbnail']}" maxwidth="60" maxheight="60"} />
								</div>
							</if>
							<div class='rowContent'>
								<h4 class='product_title'>{$i['name']}</h4>
								<span class='price'>
									{$i['line_prices'][$k]}
									<if test="count($i['_qty'][$k]) > 1">
										 <span class='desc'>({$i['unit_prices'][$k]} {$this->lang->words['store_each']})</span>
									</if>
								</span>
								<p class='options line_spacing'>{$v}</p>
								
								<input type='hidden' name='_qty[{$k}]' value='{parse expression="count($i['_qty'][$k])"}' />
								{$this->lang->words['cart_qty']}:
								<input type='number' min='0' max='2000' class='input_text no_width' value='{parse expression="count($i['_qty'][$k])"}' name='qty[{$k}]' size='5' />
								<input type='submit' class='button secondary' value='{$this->lang->words['cart_update_short']}' />
								&nbsp;&nbsp; <a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=remove&amp;id={parse expression="implode(',',$i['_qty'][$k])"}&amp;k={$this->member->form_hash}" base="public"}' class='cancel'>{$this->lang->words['cart_remove']}</a>
							</div>
						</div>							
							
					</foreach>
				<else />
					<div class='row'>
						<if test="image:|:$i['packageData']['thumbnail']">
							<div class='icon'>
								<img src="{$i['packageData']['thumbnail']}" {parse resize_image="{$i['packageData']['thumbnail']}" maxwidth="60" maxheight="60"} />
							</div>
						</if>
						<div class='rowContent'>
							<h4 class='product_title'>{$i['name']}</h4>
							<span class='price'>
								{parse currency="$i['line_price']"}
								<if test="$i['qty'] > 1">
									 <span class='desc'>({$i['unit_price']} {$this->lang->words['store_each']})</span>
								</if>
							</span>
							
							<input type='hidden' name='_qty[{$i['k']}]' value='{$i['qty']}' />
							{$this->lang->words['cart_qty']}:
							<input type='number' min='0' max='2000' class='input_text no_width' value='{$i['qty']}' name='qty[{$i['k']}]' size='5' />
							<input type='submit' class='button secondary' value='{$this->lang->words['cart_update_short']}' />
							&nbsp;&nbsp; <a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=remove&amp;id={parse expression="implode(',',$i['ids'])"}&amp;k={$this->member->form_hash}" base="public"}' class='cancel' >{$this->lang->words['cart_remove']}</a>
						</div>
					</div>
				</if>
			</foreach>
		<else />
			<div class='row no_messages'>
				<em>{$this->lang->words['store_cart_empty']}</em>
			</div>
		</if>
		<div class='row center cart_total'>
			<if test="discount:|:$cart['discount']">
				<span class='desc'>{$cart['discount']}% {$this->lang->words['store_bundle_discount']}: {parse currency="-$cart['difference']"}</span>
			</if>
			<if test="$this->settings['nexus_show_tax']">
				<span class='desc'>{$this->lang->words['store_subtotal']}: {parse currency="$cart['subtotal']"}</span><br />
				<span class='desc'>{$this->lang->words['store_tax']}: {parse currency="$cart['tax']"}</span><br />
				{$this->lang->words['store_total']}: {parse currency="$cart['total']"}
			<else />
				{$this->lang->words['store_subtotal']}: {parse currency="$cart['subtotal']"}
			</if>
		</div>
		<div class='controls'>
			<div class='buttons'>
				<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=checkout&amp;k={$this->member->form_hash}" base="{$this->settings['nexus_https']}"}' class='button'>{$this->lang->words['store_checkout']}</a>
			</div>
		</div>
	</div>
</form>]]></template_content>
      <template_name>viewCart</template_name>
      <template_data>$cart</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.mobile.nexus.js'></script>
<script type='text/javascript'>
	ipb.lang['add_to_cart'] = "{$this->lang->words['store_add']}";
	ipb.lang['out_of_stock'] = "{$this->lang->words['store_nostock']}";
	
	nexus.viewItem.packageID = {$package['p_id']};
	nexus.viewItem.init();
</script>
<h2>{$this->lang->words['store']}</h2>
{parse template="cart_sidebar" group="nexus_payments" params="$cart"}
<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=add" base="public"}' method='post' enctype='multipart/form-data'>
	<input type='hidden' name='id' value='{$package['p_id']}' />
	<input type='hidden' name='k' value='{$this->member->form_hash}' />
	<input type='hidden' name='ref' value='item' />
	<div class='ipsFilterPane' id='add_configure_pane' style='display: none'>
		<a href='#' class='ipsFilterPane_close'><span>&times;</span></a>
		<div>
			<h4>Configure Product</h4>
			<div class='ipsFilterPane_inner ipsFilterPane_withbuttonrow'>
				<div class='ipsFilterPane_fixedcontent'>		
					<ul class='ipsForm_vertical'>
						<if test="!empty($customfields)">
							<foreach loop="fields:$customfields as $f">
								<li class='ipsField'>
									<script type='text/javascript'>
										nexus.viewItem.productOptions.push( {$f->id} );
									</script>
									<label for='f_{$f->id}' class='ipsField_title'>{$f->name} <if test="isRequired:|:$f->required"><span class='required'>{$this->lang->words['store_required']}</span></if></label>
									{$f->edit( TRUE, 'nexus.viewItem.optionCheck()' )}
								</li>
							</foreach>
						</if>
						{$extra}
						<if test="!empty($associate)">
							<li class='ipsField'>
								<label for='assoc' class='ipsField_title'>{$this->lang->words['store_associate']}</label>
								<select name='assoc' id='assoc' class='input_select'>
									<foreach loop="associates:$associate as $a">
										<option value="{$a['bought']}.{$a['id']}">{$a['name']}<if test="hasSticky:|:$a['cf']"> ({$a['cf']})</if></option>
									</foreach>
								</select>
							</li>
						</if>
					</ul>
					<br />
				</div>
				<div class='ipsFilterPane_buttonrow clearfix'>
					<div class='padding clearfix'>
						<span class='price left' id='secondary_price'>{$this->lang->formatMoney( $package['p_base_price'], FALSE )}</span>
						<input type="submit" value="{$this->lang->words['store_add']}" id='add_to_cart' class="button left" />
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class='master_list product_view'>
		<div class='row'>
			<h4 class='product_title'>{$package['p_name']}</h4>
			<if test="$package['p_reviewable']">
				<div class='rating'>
					<foreach loop="range( 1, 5 ) as $r">
						<if test="$rating['avg'] >= $r">
							{parse replacement="rate_on"}
						<else />
							{parse replacement="rate_off"}
						</if>
					</foreach>
					<span class='desc'>({$rating['count']})</span>
				</div>
			</if>
			<span class='price'>
				<if test="$package['_original_price'] != $package['p_base_price']">
					<strike>{$this->lang->formatMoney( $package['_original_price'], FALSE )}</strike>
				</if>
				<span id='main_price'>{$this->lang->formatMoney( $package['p_base_price'], FALSE )}</span>
			</span>
			<if test="renewalTerms:|:!empty( $renewOptions )">
				&nbsp;
				<div class='renew desc'>
					{$this->lang->words['store_renewal']}
					<span id='renew-terms'>
						<if test="count( $renewOptions ) == 1">
							{$package['renewal']}
						<else />
							<select name='renewals'>
								<foreach loop="$renewOptions as $k => $v">
									<option value='{$k}'>{$v}</option>
								</foreach>
							</select>
						</if>
					</span>
				</div>
			</if>
			<if test="image:|:!empty($images)">
				<if test="count( $images ) === 1">
					<p class='product_image'>
						<img src='{$this->settings['upload_url']}/{$images[0]['image_location']}' alt='' />
					</p>
				<else />
					<p class='product_image'>
						<span id='main_image'>
							<foreach loop="$images as $idx => $image">
								<if test="$image['image_primary']">
									<img src='{$this->settings['upload_url']}/{$image['image_location']}' alt='' />
								</if>
							</foreach>
						</span>
					</p>
					
					<div id='product_gallery'>
						<foreach loop="$images as $idx => $image">
							<span data-imageid='{$image['image_id']}' data-location='{$image['image_location']}' class='thumb <if test="$image['image_primary']">active</if>' id='thumb_{$image['image_id']}'>
								<img src="{$this->settings['upload_url']}/{$image['image_location']}" />
							</span>
						</foreach>
					</div>
				</if>
				<br />
			</if>
		
			<br />
			<if test="$package['p_stock']">
				<script type='text/javascript'>
					nexus.viewItem.inStock = true;
				</script>
				<if test="empty($customfields) && empty($associate) && !$extra">
					<input type="submit" value="{$this->lang->words['store_add']}" class="button full_width" />
				<else />
					<input type="submit" value="{$this->lang->words['store_configure']}" id='add_configure' class='button full_width' />
				</if>
			<else />
				<script type='text/javascript'>
					nexus.viewItem.inStock = false;
				</script>
				<if test="empty($customfields) && empty($associate) && !$extra">
					<input type="submit" value="{$this->lang->words['store_nostock']}" disabled='disabled' class="button disabled full_width" />
				<else />
					<input type="submit" value="{$this->lang->words['store_nostock']}" disabled='disabled' id='add_configure' class='button disabled full_width' />
				</if>
			</if>
			<br /><br />
		</div>
	</div>
	<div class='ipsExpanderList' id='product_info_list'>
		<if test="description:|:$package['p_desc']">
			<h2 class='ipsExpanderList_trigger' data-pane='info'><span></span>{$this->lang->words['store_product_info']}</h2>
			<div class='ipsExpanderList_pane' id='expander_pane_info'>
				<div class='master_list'>
					<div class='row line_spacing info'>
						{$package['p_desc']}
					</div>
				</div>
			</div>
		</if>
		<if test="$package['p_reviewable'] and $reviews">
			<h2 class='ipsExpanderList_trigger' data-pane='reviews'><span></span>{$this->lang->words['review_reviews']} &nbsp;&nbsp;<span class='ipsBadge ipsBadge_light right'>&nbsp;{$rating['count']}&nbsp;</span></h2>
			<div class='ipsExpanderList_pane' id='expander_pane_reviews'>
				{$reviews}
			</div>
		</div>
		<script type='text/javascript'>
			$('product_info_list').expandify( { defaultTrigger: 'info' } );
		</script>
	</if>
</form>]]></template_content>
      <template_name>viewItem</template_name>
      <template_data>$package, $customfields, $associate, $extra, $cart, $shareLinks, $images, $reviews, $rating, $bought, $renewOptions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_nexus_support">
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<php>
	$parent = $p['ps_parent'];
	$dashes = 0;
	while ( $parent != 0 )
	{
		$dashes ++;
		$parent = $packages[ $parent ]['ps_parent'];
	}
	
	if ( $dashes )
	{
		$p['ps_name'] = str_repeat( '- ', $dashes ) . $p['ps_name'];
	}
</php>
<option value='{$p['ps_id']}'<if test="$p['disabled']"> disabled='disabled'<else /><if test="$p['ps_id'] == $selected"> selected='selected'</if></if>>{$p['ps_name']}</option>
<if test="hasChildren:|:is_array( $parentMap[ $p['ps_id'] ] )">
	<foreach loop="children:$parentMap[ $p['ps_id'] ] as $child">
		{parse template="_packageSelect" group="nexus_support" params="$packages[ $child ], $selected, $parentMap, $packages"}
	</foreach>
</if>]]></template_content>
      <template_name>_packageSelect</template_name>
      <template_data>$p, $selected, $parentMap, $packages</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<if test="inAcp:|:IN_ACP">
	<style type='text/css'>		
.swfupload {
	position: absolute;
	z-index: 1;
}
	
#attachments { }
	#attachments li {
		background-color: #e4ebf2;
		border: 1px solid #d5dde5;
		padding: 6px 20px 6px 42px;
		margin-bottom: 10px;
		position: relative;
	}
	
		#attachments li p.info {
			color: #69727b;
			font-size: 0.8em;
			width: 300px;
		}
	
		#attachments li .links, #attachments li.error .links, #attachments.traditional .progress_bar {
			display: none;
		}
			
			#attachments li.complete .links {
				font-size: 0.9em;
				margin-right: 15px;
				right: 0px;
				top: 12px;
				display: block;
				position: absolute;
			}
			
		#attachments li .progress_bar {
			margin-right: 15px;
			width: 200px;
			right: 0px;
			top: 15px;
			position: absolute;
		}
	
		#attachments li.complete, #attachments li.in_progress, #attachments li.error {
			background-repeat: no-repeat;
			background-position: 12px 12px;
		}
	
		#attachments li.in_progress {
			background-image: url({$this->settings['public_dir']}style_images/master/loading.gif);
		}
	
		#attachments li.error {
			background-image: url({$this->settings['public_dir']}style_images/master/exclamation.png);
			background-color: #e8caca;
			border: 1px solid #ddafaf;
		}
		
			#attachments li.error .info {
				color: #8f2d2d;
			}
	
		#attachments li.complete {
			background-image: url({$this->settings['public_dir']}style_images/master/accept.png);
		}
		
		#attachments li .thumb_img {
			left: 6px;
			top: 6px;
			width: 30px;
			height: 30px;
			overflow: hidden;
			position: absolute;
		}
/*div.post_form fieldset.attachments span.desc {
	margin: 0 0 0 15px;
	display: inline;
	clear: none;
}*/
.attach_controls {
	background: url( {$this->settings['public_dir']}style_images/master/icon_attach.png ) no-repeat 3px;
	padding-left: 35px;
	min-height: 82px;
}
	.attach_controls .ipsType_subtitle { margin-bottom: 5px; }
	.attach_controls iframe { display: block; margin-bottom: 5px; }
	
.attach_button { font-weight: bold;  }
#help_msg {	margin-top: 8px; }
#attach_wrap {
	background: #eef3f8;
	padding: 6px;
	margin-top: 8px;
}
	#attach_wrap h4 {
		font-size: 1em;
		font-weight: bold;
	}
	
	#attach_wrap li {
		margin: 5px 6px;
		float: left;
	}
		
		#attach_wrap .desc.info {
			margin-left: 24px;
		}
		
.ipsButton_secondary {
	height: 22px;
	line-height: 22px;
	font-size: 12px;
	color: #7c7c7c;
	padding: 0 10px;
	background: #f6f6f6;
	background: -moz-linear-gradient(top, #f6f6f6 0%, #e5e5e5 100%); /* firefox */
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f6f6f6), color-stop(100%,#e5e5e5)); /* webkit */
	border: 1px solid #dbdbdb;
	-moz-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-webkit-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	color: #616161;
	display: inline-block;
	white-space: nowrap;
}
	.ipsButton_secondary:hover {
		color: #4c4c4c;
		border-color: #9a9a9a;
	}
	</style>
	
	<script type='text/javascript' src='{$this->settings['board_url']}/cache/lang_cache/{$this->lang->lang_id}/ipb.lang.js'></script>
	<script type='text/javascript'>
		var backup = ipb.vars['base_url'];
		ipb.vars['base_url']	= ipb.vars['front_url'];
		ipb.vars['upload_url']	= "{$this->settings['upload_url']}";
	</script>
	<if test="$backup = $this->settings['base_url']">
		<if test="$this->settings['base_url'] = $this->settings['board_url'] . '/index.php?'"></if>
	</if>
<else />
	<if test="nexusHttps:|:$this->settings['nexus_https'] == 'https'">
		<script type='text/javascript'>
			ipb.vars['base_url'] = ipb.vars['base_url'].replace( 'http://', 'https://' );
		</script>
	</if>
</if>
<if test="$this->lang->words['attach_button'] = $this->lang->words['nexus_attach_button']"></if>
<fieldset class='attachments'>
	{parse template="uploadForm" group="post" params="$data['post_key'], 'support', $data['stats'], 0"}
</fieldset>
<if test="inAcp2:|:IN_ACP">
	<script type='text/javascript'>
		//ipb.vars['base_url']	= backup;
	</script>
	<if test="$this->settings['base_url'] = $backup"></if>
</if>]]></template_content>
      <template_name>attachments</template_name>
      <template_data>$data=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['support_requests']}</h2>
<div class='master_list'>
	<if test="requests:|:count( $requests )">
		<foreach loop="requests:$requests as $request">
			<div class='row touch-row <if test="$request['_isUnread']">unread</if>'>
				<a class='title' href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="{$this->settings['nexus_https']}"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a>
				<br />
				<span class='ipsBadge ipsBadge_default'>{$request['r_status_text']}</span>&nbsp;&nbsp;<span class='desc'>{$request['r_department_text']} &middot; {parse date="$request['r_last_reply']" format="joined"}</span>
			</div>
		</foreach>
	<else />
		<div class='row no_messages'>
			{$this->lang->words['support_empty']}
		</div>
	</if>
	<div class='controls'>
		<div class='buttons'>
			<a class='button' href='{parse url="app=nexus&amp;module=support&amp;section=new" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['new_request']}</a>
			<if test="pagination:|:count( $requests )">
				{$pagination}
			</if>
		</div>
	</div>
</div>]]></template_content>
      <template_name>customerList</template_name>
      <template_data>$requests,$pagination</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<li class='ipsField'>
	<label class='ipsField_title'>{$field->name} <if test="$field->required"><span class='ipsForm_required'>*</span></if></label>
	<div class='ipsField_content'>
		{$field->edit( TRUE )}
	</div>
</li>]]></template_content>
      <template_name>customField</template_name>
      <template_data>$field</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=support&amp;section=guests" base="{$this->settings['nexus_https']}"}' method='post'>
	<div class='ipsPad'>
		<div class='topic_buttons'>
			<ul>
				<li><a href='{parse url="app=nexus&amp;module=support&amp;section=new" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['new_request']}</a>
			</ul>
		</div>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['support_requests']}</h1>
		<br />
		
		<if test="error:|:$error">
			<p class='message error'>{$error}</p>
		</if>
		<br />
		
		<p>{$this->lang->words['support_g_blurb']}</p>
		<br /><br />
		
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField'>
				<label for='email' class='ipsField_title'>{$this->lang->words['support_g_email']}</label>
				<p class='ipsField_content'>
					<input name='email' class='input_text' size='40' id='email' value='{$this->request['email']}' />
				</p>
			</li>
			<li class='ipsField'>
				<label for='key' class='ipsField_title'>{$this->lang->words['support_g_key']}</label>
				<p class='ipsField_content'>
					<input name='key' class='input_text' size='5' id='key' value='{$this->request['key']}' />
				</p>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['support_retrieve']}' />
	</fieldset>
</form>]]></template_content>
      <template_name>guestAccess</template_name>
      <template_data>$error</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<h2>{$this->lang->words['new_support_request']}</h2>
<form action='{parse url="app=nexus&amp;module=support&amp;section=new&amp;do=submit" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='post_key' value='{$postkey}' />
	
	<div class='master_list'>
		<if test="errors:|:!empty($errors)">
			<p class='message error'>
				<foreach loop="errors:$errors as $e">
					{$this->lang->words[ $e ]}<br />
				</foreach>
			</p>
		</if>
        <if test="hostingProblemsCheck:|:!empty($hostingProblems)">
            <p class='message'>
				{$this->lang->words['hosting_problems']}<br />
                <foreach loop="hostingProblems:$hostingProblems as $s">
                    {$s}<br />
                </foreach>
            </p>
        </if>
		
		<ul class='ipsForm_vertical'>
			<if test="guest:|:!$this->memberData['member_id']">
				<li class='ipsField'>
					<label for='email' class='ipsField_title'>{$this->lang->words['support_g_email']}</label>
					<input name='email' class='input_text' size='40' id='email' value='{$this->request['email']}' />
				</li>
			</if>
			<li class='ipsField'>
				<label for='title' class='ipsField_title'>{$this->lang->words['support_title']}</label>
				<input name='title' class='input_text' size='40' id='title' value='{$this->request['title']}' />
			</li>
			<li class='ipsField'>
				<label for='department' class='ipsField_title'>{$this->lang->words['support_department']}</label>
				<select name='department' class='full_width' id='department' onchange='departmentChange();'>
					<option value='0'>{$this->lang->words['select_box_select']}</option>
					<foreach loop="departments:$availableDepartments as $department">
						<option value='{$department['dpt_id']}'<if test="departmentSelected:|:$this->request['department'] == $department['dpt_id']"> selected='selected'</if>>{$department['dpt_name']}</option>
					</foreach>
				</select>
			</li>
			<if test="severity:|:!$this->memberData['cm_no_sev']">
				<if test="justOne:|:count($severities)==1">
					<foreach loop="severitiesOne:$severities as $s">
						<input type='hidden' name='severity' value='{$s['sev_id']}' />
					</foreach>
				<else />
					<li class='ipsField ipsField_select'>
						<label for='severity' class='ipsField_title'>{$this->lang->words['support_severity']}</label>
						<div class='ipsField_content'>
							<if test="sev2:|:count($severities)==2">
								<foreach loop="severitiesTwo:$severities as $s">
									<if test="sevDefault:|:!$s['sev_default']">
										<input type='checkbox' name='severity' value='{$s['sev_id']}'<if test="sevChecked:|:$this->request['severity'] == $s['sev_id']"> checked='checked'</if> /> {$s['sev_name']}
									</if>
								</foreach>
							<else />
								<select name='severity' class='full_width'>
									<foreach loop="severities:$severities as $s">
										<option value='{$s['sev_id']}' <if test="sevSelected:|:( !$this->request['severity'] and $s['sev_default'] ) or ( $this->request['severity'] == $s['sev_id'] )">selected='selected'</if> >{$s['sev_name']}</option>
									</foreach>
								</select>
							</if>
							<if test="sevBlurb:|:$this->settings['nexus_severity_blurb']">
								<br /><span class='desc'>{$this->settings['nexus_severity_blurb']}</span>
							</if>
						</div>
					<li>
				</if>
			</if>
			<span id='package-select' style='display:none'>{$itnitialPackageSelect}</span>
			<span id='ppi-message' style='display:none'></span>
			<li class='ipsField' id='main-field'>
				<label class='ipsField_title'>{$this->lang->words['support_message']}</label>
				<div class='ipsField_content'>
					{$editor}
				</div>
			</li>
			<div id='custom-fields'></div>
			<if test="captcha:|:$captchaHTML">
				<div class='ipsField ipsField_captcha'>
					{$captchaHTML}
				</div>
			</if>
		</ul>
		
		<div class='controls'>
			<div class='buttons'>
				<input type='submit' class='button' value='{$this->lang->words['support_submit']}' />
			</div>
		</div>
	</div>
</form>
<script type='text/javascript'>
	var ppiLang = "{$this->lang->words['support_ppi_message']}";
	
	function departmentChange()
	{
		new Ajax.Request( ipb.vars['base_url'] + "app=nexus&module=ajax&section=support&do=get-package-options&department=" + $('department').value + "&secure_key={$this->member->form_hash}&selected={$this->request['package']}",
			{
				parameters: {
					cfields: '{$cfields}'
				},
				onSuccess: function( t )
				{
					if ( t.responseJSON['ppi']  )
					{
						\$('package-select').style.display = 'none';
						\$('custom-fields').innerHTML = '';
						\$('main-field').style.display = 'none';
						\$('ppi-message').style.display = '';
						
						\$('ppi-message').innerHTML = "<p class='message'>" + ppiLang.replace( '{PPI_AMOUNT}', t.responseJSON['ppi'] ) + "</p>";
					}
					else
					{
						\$('main-field').style.display = '';
						\$('ppi-message').style.display = 'none';
						
						if ( t.responseJSON['packageSelect'] )
						{								
							\$('package-select').innerHTML = t.responseJSON['packageSelect'];
							if ( t.responseText )
							{
								\$('package-select').style.display = '';
							}
						}
						else
						{
							\$('package-select').style.display = 'none';
						}
						
						\$('custom-fields').innerHTML = t.responseJSON['customFields'];
					}
				}
			});
	}
	
	<if test="departmentChange:|:$this->request['department']">
		departmentChange();
	</if>
	
</script>]]></template_content>
      <template_name>newRequest</template_name>
      <template_data><![CDATA[$availableDepartments, $severities, $editor, $attachments, $postkey, $captchaHTML, $errors, $hostingProblems, $cfields='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<li class='ipsField ipsField_select'>
	<label for='package' class='ipsField_title'>{$this->lang->words['support_package']}</label>
	<div class='ipsField_content'>
		<select name='package'>
			<option value='0'>{$this->lang->words['select_box_select']}</option>
			<if test="hasChildren:|:is_array( $parentMap[0] )">
				<foreach loop="children:$parentMap[0] as $id">
					{parse template="_packageSelect" group="nexus_support" params="$packages[ $id ], $selected, $parentMap, $packages"}
				</foreach>
			</if>
		</select>
	</div>
</li>]]></template_content>
      <template_name>packageSelect</template_name>
      <template_data>$packages, $selected, $parentMap</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<h2>{$request['r_title']}</h2>
<div class='master_list'>
	<foreach loop="messages:$messages as $message">
		<div class='topic_reply'>
			<h2 class='secondary no_photo'>
				<if test="member:|:$message['reply_member']['member_id']">{$message['reply_member']['members_display_name']}<else />{$message['reply_email']}</if>
				<span class='subtext'>{$message['reply_date']}</span>
			</h2>
			<div class='post line_spacing'>
				{$message['reply_post']}
			</div>
		</div>
	</foreach>
</div>
<if test="$pagination">
	<div class='controls'>
		{$pagination}
	</div>
</if>
<br />
<if test="reply:|:!$statuses['statuses'][ $request['r_status'] ]['status_is_locked']">
	<h3>{$this->lang->words['support_reply']}</h3>
	<div class='ipsExpanderList_pane' id='expander_pane_reply'>
		<if test="replyErrors:|:!empty($errors)">
			<p class='message error'>
				<foreach loop="errors:$errors as $e">
					{$this->lang->words[ $e ]}<br />
				</foreach>
			</p>
		</if>
		<div class='post_form'>
			<form action='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}&amp;do=submit" base="{$this->settings['nexus_https']}"}' method='post'>
				<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
				<input type='hidden' name='post_key' value='{$postkey}' />
				<input type="hidden" name="fast_reply_used" value="1" />
				<input type="hidden" name="enableemo" value="yes" />
				<input type="hidden" name="enablesig" value="yes" />
				{$editor}
				<div class='controls'>
					<div class='buttons'>
						<input type='submit' class='button' id='submit_post' value='{$this->lang->words['support_reply']}' />
					</div>
				</div>
			</form>
		</div>
	</div>
</if>]]></template_content>
      <template_name>requestView</template_name>
      <template_data>$request, $messages, $pagination, $editor, $attachments, $postkey, $statuses, $setableStatuses, $setableSeverities, $errors</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<div class='general_box clearfix'>
	<h3><img src='{$this->settings['img_url']}/nexus/support.png' alt='' /> {$this->lang->words['support_staff_title']}</h3>
	<div class='_sbcollapsable'>
		<ul class='hfeed block_list'>
			<li>
				<a href='{$this->settings['_admin_link']}?app=nexus&amp;module=tickets&amp;section=list' target='_blank'>{$count} {$this->lang->words['support_staff_text']}</a>
			</li>
		</ul>
	</div>
</div>]]></template_content>
      <template_name>sidebar</template_name>
      <template_data>$count</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>mobile</template_master_key>
    </template>
  </templategroup>
</templates>
