<?xml version="1.0" encoding="utf-8"?>
<templates application="nexus" templategroups="a:1:{s:11:&quot;skin_nexus_&quot;;s:8:&quot;contains&quot;;}">
  <templategroup group="skin_nexus_clients">
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=save" base="public"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'><if test="noContacts:|:empty($current)">{$this->lang->words['altcontacts_add']}<else />{$this->lang->words['altcontacts_edit_title']}</if></h1>
		<br />
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField'>
				<label class='ipsField_title' for='name'>{$this->lang->words['altcontacts_enter_name']} <span class='ipsForm_required'>*</span></label>
				<p class='ipsField_content'><input name='name' class='input_text' id='name' size='40' value='{$current['members_display_name']}' /></p>
				<p class='desc'>
					{$this->lang->words['altcontacts_add_blurb']}<br />
					{parse expression="sprintf( $this->lang->words['altcontacts_create'], "<a href='{parse url="app=core&amp;module=global&amp;section=register" base="public"}'>{$this->lang->words['altcontacts_create_link']}</a>" )"}
				</p>
			</li>
			<if test="noPurchases:|:!empty($purchases)">
				<li class='ipsField ipsField_select'>
					<label class='ipsField_title' for='name'>{$this->lang->words['altcontacts_purchases']}</label>
					<div class='ipsField_content'>
						<select name='purchases[]' multiple='multiple' style='width: 80%; height: 200px'>
							<foreach loop="purchases:$purchases as $p">
								<option value='{$p['ps_id']}' <if test="purchaseIsSelected:|:in_array( $p['ps_id'], explode( ',', $current['purchases'] ) )">selected='selected'</if>>{$p['ps_name']}</option>
							</foreach>
						</select>
					</div>
				</li>
			</if>
			<li class='ipsField ipsField_checkbox'>
				<input type='checkbox' name='billing' id='billing' value='1' <if test="billingOn:|:$current['billing']">checked='checked'</if> />
				<p class='ipsField_content'>
					<label for='billing'>{$this->lang->words['altcontacts_billing']}</label>
				<p>
			</li>
			<li class='ipsField ipsField_checkbox'>
				<input type='checkbox' name='support' id='support' value='1' <if test="supportOn:|:$current['support']">checked='checked'</if> />
				<p class='ipsField_content'>
					<label for='support'>{$this->lang->words['altcontacts_support']}</label>
				<p>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['altcontacts_save']}' />
	</fieldset>
</form>
<script type="text/javascript">
	ipb.nexus.setUpAltContacts();
</script>]]></template_content>
      <template_name>altContactForm</template_name>
      <template_data>$purchases, $current</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	
	<h1 class='ipsType_pagetitle'>{$this->lang->words['altcontacts']}</h1>
	<a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=add" base="public"}' class='ipsButton right'>{$this->lang->words['altcontacts_add']}</a>
	<br />
	
	<p class='ipsType_pagedesc clear'>{$this->lang->words['altcontacts_blurb']}</p>
	<br /><br />
	
	<table class='ipb_table'>
		<tr class='header'>
			<th style='width: 50px'>&nbsp;</th>
			<th>{$this->lang->words['altcontacts_name']}</th>
			<th>{$this->lang->words['altcontacts_purchases']}</th>
			<th style='width: 70px'>{$this->lang->words['altcontacts__billing']}</th>
			<th style='width: 70px'>{$this->lang->words['altcontacts__support']}</th>
			<th style='width: 90px'></th>
		</tr>
		<if test="altContacts:|:count( $contacts )">
			{parse striping="altcontacts" classes="row1,row2"}
			<foreach loop="contacts:$contacts as $c">
				<tr class='{parse striping="altcontacts"}'>
					<td class='short'><img src='{$c['pp_mini_photo']}' class='ipsUserPhoto ipsUserPhoto_mini' /></td>
					<td>{$c['members_display_name']}</td>
					<td>{$c['purchases']}</td>
					<td><if test="billingOn:|:$c['billing']"><img src='{$this->settings['img_url']}/tick.png' /><else /><img src='{$this->settings['img_url']}/cross.png' /></if></td>
					<td><if test="supportOn:|:$c['support']"><img src='{$this->settings['img_url']}/tick.png' /><else /><img src='{$this->settings['img_url']}/cross.png' /></if></td>
					<td><a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=edit&amp;id={$c['member_id']}&amp;k={$this->member->form_hash}" base="public"}'>{$this->lang->words['altcontacts_edit']}</a> &middot; <a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts&amp;do=delete&amp;id={$c['member_id']}&amp;k={$this->member->form_hash}" base="public"}' class='cancel'>{$this->lang->words['altcontacts_remove']}</a></td>
				</tr>
			</foreach>
		<else />
			<tr>
				<td colspan='6' class='no_messages'>
					{$this->lang->words['altcontacts_none']}
				</td>
			</tr>
		</if>
	</table>
</div>]]></template_content>
      <template_name>alternateContacts</template_name>
      <template_data>$contacts, $purchases</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['purchase_associate']}</h1>
	<ul id='package_list' class='nexus_block_list'>
		<foreach loop="options:$options as $p">
			<li class='clear clearfix row2'>
				<div class='product_info left' style='width: 300px'>
					<if test="image:|:$p['img']"><img src='{$p['img']}' {parse resize_image="{$p['img']}" maxwidth="40" maxheight="40"} class='left' /></if>
					<div <if test="imageMargin:|:$p['img']">style='margin-left: 55px'</if>>
						<h3>
							<a href='{parse url="app=nexus&module=clients&section=purchases&do=do_assoc&id={$purchase['ps_id']}&assoc={$p['ps_id']}&secure_key={$this->member->form_hash}" base="public"}'>{$p['ps_name']}</a>
							<if test="cancelled:|:$p['ps_cancelled']">
								<span class='negative desc'>({$this->lang->words['invoices_canc']})</span>
							<else />
								<if test="expired:|:!$p['ps_active']">
									<span class='zero desc'>({$this->lang->words['invoices_expd']})</span>
								</if>
							</if>
						</h3>
						<if test="lkey:|:$p['lkey_key']">
							<div style='padding:5px'><img src='{$this->settings['img_url']}/nexus/lkey.png' alt='{$this->lang->words['nexus_lkey']}' title='{$this->lang->words['nexus_lkey']}' /> <span class='desc'>{$p['lkey_key']}</span></div>
						</if>
					</div>
				</div>
				<p class='ship_info left' style='width: 150px'>
					<span class='desc'>{$this->lang->words['purchased']}</span><br />
					<strong class='package_date'>{parse date="$p['ps_start']" format="joined"}</strong>
				</p>
				<if test="expiryDate:|:$p['ps_expire']">
					<p class='ship_info left'>
						<span class='desc'>{$this->lang->words['expires']}</span><br />
						<strong class='package_date'>{parse date="$p['ps_expire']" format="joined" relative="false"}</strong>
					</p>
				</if>
			
			</li>
		</foreach>
	</ul>
</div>]]></template_content>
      <template_name>associate</template_name>
      <template_data>$purchase, $options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=hosting&amp;do=do_bandwidth" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='id' value='{$account['ps_id']}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['haccount_buy_bandwidth']}</h1>
		<br />
		<div class='ipsPad_double'>
			<select name='option'>
				<foreach loop="options:$options as $k => $v">
					<option value='{$k}'>{$v}</option>
				</foreach>
			</select>
		</div>
	</div>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['haccount_buy_bandwidth']}' class='input_submit' />
	</fieldset>
</form>]]></template_content>
      <template_name>buyBandwidth</template_name>
      <template_data>$options, $account</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['cancel_title'], $purchase['ps_name'] )"}</h1>
	<br />
	<p class='message error'>
		{$this->lang->words['cancel_blurb']}
		<if test="hasGroupedChildren:|:$hasGroupedChildren">
			<br />
			{$this->lang->words['cancel_g_blurb']}
		</if>
	</p>
</div>
<fieldset class='submit'>
	<a class='input_submit' href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=do_cancel&amp;id={$purchase['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['purchase_cancel_confirm']}</a>&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
</fieldset>]]></template_content>
      <template_name>cancel</template_name>
      <template_data>$purchase, $hasGroupedChildren</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<if test="$editable">
	<if test="$field->type == 'text'">
		<input id='f_{$name}' name='field{$name}' value='{$field->currentValue}' class='input_text' size='30' />
	</if>
	<if test="$field->type == 'dropdown'">
		<select id='f_{$name}' name='field{$name}' class='input_select' <if test="$extra">onchange='{$extra}'</if>>
			<if test="!$field->data[ $field->prefix . 'required' ]">
				<option></option>
			</if>
			<foreach loop="$field->data['options'] as $k => $v">
				<option value='{$k}' <if test="$v == $field->currentValue">selected='selected'</if>>{$v}</option>
			</foreach>
		</select>
	</if>
	<if test="$field->type == 'user'">
		<table id='f_{$name}'>
			<tr>
				<td class='field_title'><strong class='title'><label for='f_{$name}[un]'>{$this->lang->words['cfields_username']}</label></strong></td>
				<td class='field_field'><input id='f_{$name}[un]' name='field{$name}[un]' value='{$field->currentValue['un']}' class='input_text' size='30' /></td>
			</tr>
			<tr>
				<td class='field_title'><strong class='title'><label for='f_{$name}[pw]'>{$this->lang->words['cfields_password']}</label></strong></td>
				<td class='field_field'><input id='f_{$name}[pw]' name='field{$name}[pw]' value='{$field->currentValue['pw']}' class='input_text' size='30' /></td>
			</tr>
		</table>
	</if>
	<if test="$field->type == 'ftp'">
		<table id='f_{$name}'>
			<tr>
				<td class='field_title'><strong class='title'><label for='field{$name}[server]'>{$this->lang->words['cfields_ftp_server']}</label></strong></td>
				<td class='field_field'><input id='field{$name}[server]' name='field{$name}[server]' value='{$field->currentValue['server']}' class='input_text' /></td>
			</tr>
			<tr>
				<td class='field_title'><strong class='title'><label for='field{$name}[un]'>{$this->lang->words['cfields_ftp_username']}</label></strong></td>
				<td class='field_field'><input id='field{$name}[un]' name='field{$name}[un]' value='{$field->currentValue['un']}' class='input_text' /></td>
			</tr>
			<tr>
				<td class='field_title'><strong class='title'><label for='field{$name}[pw]'>{$this->lang->words['cfields_ftp_password']}</label></strong></td>
				<td class='field_field'><input id='field{$name}[pw]' name='field{$name}[pw]' value='{$field->currentValue['pw']}' class='input_text' /></td>
			</tr>
			<tr>
				<td class='field_title'><strong class='title'><label for='field{$name}[path]'>{$this->lang->words['cfields_ftp_path']}</label></strong></td>
				<td class='field_field'><input id='field{$name}[path]' name='field{$name}[path]' value='{$field->currentValue['path']}' class='input_text' /></td>
			</tr>
			<tr>
				<td class='field_title'><strong class='title'><label for='field{$name}[protocol]'>{$this->lang->words['cfields_ftp_protocol']}</label></strong></td>
				<td class='field_field'>
					<select name='field{$field->data[ $field->prefix . 'id' ]}[protocol]'>
						<foreach loop="array( 'ftp' => $this->lang->words['cfields_ftp_ftp'], 'sftp' => $this->lang->words['cfields_ftp_sftp'] ) as $k => $v">
							<option value='{$k}' <if test="$k == $field->currentValue['protocol']">selected='selected'</if>>{$v}</option>
						</foreach>
					</select>
				</td>
			</tr>
			<tr>
				<td class='field_title'><strong class='title'><label for='field{$name}[port]'>{$this->lang->words['cfields_ftp_port']}</label></strong></td>
				<td class='field_field'><input id='field{$name}[port]' name='field{$name}[port]' value='{$field->currentValue['port']}' class='input_text' /></td>
			</tr>
		</table>
	</if>
<else />
	<if test="(string)$field">
		{$field}
	<else />
		<em>{$this->lang->words['cf_no_info']}</em>
	</if>
</if>]]></template_content>
      <template_name>cfield</template_name>
      <template_data>$field, $extra, $name, $editable</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=hosting&amp;do=do_password" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='id' value='{$account['ps_id']}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['haccount_change_password']}</h1>
		<br />
		<ul class='ipsForm ipsForm_horizontal'>
			<li class='ipsField'>
				<label for='option' class='ipsField_title'>{$this->lang->words['haccount_password']}</label>
				<p class='ipsField_content'>
					<input name='password' id='password' value='{$account['account_password']}' type='text' class='input_text' size='40' maxlength='255' />
				</p>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['personal_info_save']}' class='input_submit' />
	</fieldset>
</form>]]></template_content>
      <template_name>changeHostingPassword</template_name>
      <template_data>$account</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsBox'>
	<div class='ipsLayout ipsLayout_withleft <if test="hasRightBar:|:$rightBar">ipsLayout_withright ipsPostForm</if> ipsLayout_smallleft ipsVerticalTabbed clearfix'>
		<div class='ipsVerticalTabbed_tabs ipsLayout_left'>
			<ul>
				<if test="loggedIn:|:$this->memberData['member_id']">
					<li <if test="splashActive:|:$this->request['section'] == 'splash'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients" base="public"}'>{$this->lang->words['overview']}</a></li>
					<li <if test="purchasesActive:|:$this->request['section'] == 'purchases' or $this->request['section'] == 'hosting'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases" base="public"}'>{$this->lang->words['purchases']}</a></li>
					<li <if test="invoicesActive:|:$this->request['section'] == 'invoices'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices" base="public"}'>{$this->lang->words['invoices']}</a></li>
				</if>
				<if test="supportOn:|:!empty( $this->caches['support_departments'] )">
					<li <if test="supportActive:|:$this->request['module'] == 'support'">class='active'</if>><a href='{parse url="app=nexus&amp;module=support" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['support']}</a></li>
					<if test="loggedInAlt:|:$this->memberData['member_id']">
						<li <if test="altActive:|:$this->request['section'] == 'altcontacts'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=altcontacts" base="public"}'>{$this->lang->words['altcontacts']}</a></li>
					</if>
				</if>
				<if test="hasCredit:|:$this->memberData['member_id'] and ( $this->memberData['cm_credits'] or $this->settings['nexus_min_topup'] or $this->settings['nexus_payout'] )">
					<li <if test="payoutsActive:|:$this->request['section'] == 'payouts'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=payouts" base="public"}'>{$this->lang->words['credit']}</a></li>
				</if>
				<if test="donationsOn:|:!empty( $this->caches['donation_goals'] )">
					<li <if test="donationsActive:|:$this->request['section'] == 'donations'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=donations" base="public"}'>{$this->lang->words['donations']}</a></li>
				</if>
				<if test="referralsOn:|:$this->memberData['member_id'] and $this->settings['cm_ref_on']">
					<li <if test="referralsActive:|:$this->request['section'] == 'referrals'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=referrals" base="public"}'>{$this->lang->words['referrals']}</a></li>
				</if>
				<if test="billingInfoOn:|:$this->memberData['member_id'] and !$this->settings['nexus_hide_info']">
					<li <if test="billingActive:|:$this->request['section'] == 'info'">class='active'</if>><a href='{parse url="app=nexus&amp;module=clients&amp;section=info" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['personal_info']}</a></li>
				</if>
			</ul>
		</div>
		<if test="hasRightBar2:|:$rightBar">
			<div class='ipsLayout_right ipsPostForm_sidebar'>
				{$rightBar}
			</div>
		</if>
		<div class='ipsVerticalTabbed_content ipsLayout_content ipsBox_container'>
			{$content}
		</div>
	</div>
</div>]]></template_content>
      <template_name>clientarea</template_name>
      <template_data><![CDATA[$content, $rightBar='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['credit']}</h1>
	<br />
	
	<div style='text-align:center'>
		<div class='clearfix'>
			<div class='message <if test="creditIsLessThanZero:|:$this->memberData['cm_credits'] < 0">error<else /><if test="creditIsZero:|:!$this->memberData['cm_credits']">unspecific</if></if>' style='<if test="heightAdjust1:|:!empty( $pendingPayouts )">display:inline; float: left; width: 75%; height: {parse expression="( ( 71 * count( $pendingPayouts ) ) + ( 32 * ( count( $pendingPayouts ) - 1 ) ) )"}px; </if>'>
				<if test="heightAdjust12:|:count( $pendingPayouts ) > 1">
					<div style='height: {parse expression="30 * count( $pendingPayouts )"}px'>&nbsp;</div>
				</if>
				{$this->lang->words['credit_balance']}<br />
				<p class='ipsType_pagetitle'>{parse currency="$this->memberData['cm_credits']"}</p>
			</div>
			<if test="hasPendingPayouts:|:!empty( $pendingPayouts )">
				<div style='float: left; width: 20%; margin-left: 5px'>
					<foreach loop="pendingPayouts:$pendingPayouts as $po">
						<div class='message unspecific' style='clear:none'>
							{$this->lang->words['credit_payouts_pending']}
							<p class='ipsType_pagetitle'>{parse currency="$po['po_amount']"}</p>
							<a href='{parse url="app=nexus&amp;module=clients&amp;section=payouts&amp;do=cancel_payout&amp;id={$po['po_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' data-confirmaction="true">{$this->lang->words['credit_payouts_cancel']}</a>
						</div>
					</foreach>
				</div>
			</if>
		</div>
		<p class='ipsType_pagedesc'>{$this->lang->words['credit_blurb']}</p>
	</div>
	
	<br  />
	<br />
</div>
<if test="hasCredit:|:$this->settings['nexus_payout'] and !empty( $gateways )">
	<div style='<if test="otherPane2:|:$this->settings['nexus_min_topup']">width:49.5%; float:left</if>'>
		<if test="$this->memberData['cm_credits'] < $this->settings['nexus_payout_min']">
			<div class='ipsPad'>
				<h2 class='ipsType_sectiontitle'>{$this->lang->words['credit_payout']}</h2>
				<br />
				<p class='message unspecific'>{parse expression="sprintf( $this->lang->words['credit_payout_min'], "{parse currency="$this->settings['nexus_payout_min']"}")"}</p>
			</div>
		<else />
			<form action='{parse url="app=nexus&amp;module=clients&amp;section=payouts&amp;do=payout" base="public"}' method='post'>
				<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
				<div class='ipsPad' style='min-height: 265px'>
					<h2 class='ipsType_sectiontitle'>{$this->lang->words['credit_payout']}</h2>
					<br />
					<p class='ipsType_textblock' style='min-height:70px'>{$this->lang->words['credit_payout_blurb']}</p>
					<ul class='ipsForm ipsForm_horizontal'>
						<li class='ipsField'>
							<label class='ipsField_title'>{$this->lang->words['credit_payout_amount']}</label>
							<div class='ipsField_content'>
								<input name='payout_amount' class='input_text' value="{$this->request['payout_amount']}" /><br />
								<if test="payoutsMinimum:|:$this->settings['nexus_payout_min']">
									<span class='desc'>{parse expression="sprintf( $this->lang->words['credit_payout_amount_minimum'], "{parse currency="$this->settings['nexus_payout_min']"}")"}</span>
									<br />
								</if>
								<if test="payoutsAmountError:|:isset( $errors['payout_amount'] )">
									<span class='error'>{$errors['payout_amount']}</span>
								</if>
							</div>
						</li>
						<if test="availableGateways:|:count( $gateways ) > 1">
							<li class='ipsField ipsField_select'>
								<label class='ipsField_title'>{$this->lang->words['credit_payout_gateway']}</label>
								<div class='ipsField_content'>
									<select name='gateway' onchange='selectMethod()' id='po_gateway'>
										<foreach loop="gateways:$gateways as $gateway">
											<option value='{$gateway['g_id']}' <if test="gwselected:|:$this->request['gateway'] == $gateway['g_id']">selected='selected'</if>>{$gateway['g_name']}</option>
										</foreach>
									</select>
								</div>
							</li>
						<else />
							<php>sort($gateways);</php>
							<input type='hidden' name='gateway' value="{$gateways[0]['g_id']}" id='po_gateway' />
						</if>
						<div id='payoutExtra'>
						
						</div>
					</ul>
					<br />
				</div>
				<fieldset class='submit'>
					<input type='submit' class='input_submit' value='{$this->lang->words['credit_payout']}' />
				</fieldset>
			</form>
		</if>
	</div>
</if>
<if test="topupsEnabled:|:$this->settings['nexus_min_topup'] && ( $this->memberData['cm_credits'] < $this->settings['nexus_max_credit'] || $this->settings['nexus_max_credit'] == 0 )">
	<div style='<if test="otherPane1:|:$this->settings['nexus_payout'] and !empty( $gateways )">width:49.5%; float:right</if>'>
		<form action='{parse url="app=nexus&amp;module=clients&amp;section=payouts&amp;do=topup" base="public"}' method='post'>
			<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
			<div class='ipsPad' style='min-height: 265px'>
				<h2 class='ipsType_sectiontitle'>{$this->lang->words['credit_topup']}</h2>
				<br />
				<p class='ipsType_textblock' style='min-height:70px'>{$this->lang->words['credit_topup_blurb']}</p>
				<ul class='ipsForm ipsForm_horizontal'>
					<li class='ipsField'>
						<label class='ipsField_title'>{$this->lang->words['credit_topup_amount']}</label>
						<div class='ipsField_content'>
							<input name='topup_amount' class='input_text' value="{$this->request['topup_amount']}" /><br />
							<if test="topupsMinimum:|:$this->settings['nexus_min_topup'] != -1">
								<span class='desc'>{parse expression="sprintf( $this->lang->words['credit_topup_amount_minimum'], "{parse currency="$this->settings['nexus_min_topup']"}")"}</span>
								<br />
							</if>
							<if test="topupsMaximum:|:$maxCredit >= $this->settings['nexus_min_topup'] && $this->settings['nexus_max_credit']">
								<span class='desc'>{parse expression="sprintf( $this->lang->words['credit_topup_amount_maximum'], "{parse currency="$maxCredit"}")"}</span>
								<br />
							</if>
							<if test="topupsError:|:isset( $errors['topup'] )">
								<span class='error'>{$errors['topup']}</span>
							</if>
						</div>
					</li>
				</ul>
				<br />
			</div>
			<fieldset class='submit'>
				<input type='submit' class='input_submit' value='{$this->lang->words['credit_topup']}' />
			</fieldset>
		</form>
	</div>
</if>
<script type='text/javascript'>
	function selectMethod()
	{	
		new Ajax.Request( ipb.vars['base_url'] + "app=nexus&module=ajax&section=clients&do=payout&secure_key="+ipb.vars['secure_hash'],
		{
			method: 'post',
			parameters: {
				'gateway': $('po_gateway').value,
			},
			onSuccess: function(t)
			{
				$('payoutExtra').innerHTML = t.responseJSON['html'];
			}
		});
	}
	
	selectMethod();
</script>]]></template_content>
      <template_name>credit</template_name>
      <template_data>$errors, $gateways, $pendingPayouts, $maxCredit</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['donations']}</h1>
	<br />
	<if test="errorMessage:|:$this->request['error']">
		<p class='message error'>
			{parse expression="sprintf( $this->lang->words['donations_error'], "{$this->settings['nexus_currency']}" )"}
		</p>
	</if>
	<ul class='nexus_block_list'>
		<foreach loop="goals:$goals as $goal">
			<li class='clear clearfix row2'>
				<strong>{$goal['d_name']}</strong>
				<p>{$goal['d_desc']}</p>
				
				<if test="goal:|:$goal['d_goal']">
					<div style='width: 90%; padding: 5px'>
						<table>
							<tr>
								<if test="gotSomething:|:$goal['percent'] > 0">
									<td width='{$goal['percent']}%' style='background-color:#225985' nowrap='nowrap'></td>
								</if>
								<if test="gotEverything:|:$goal['left'] > 0">
									<td width='{$goal['left']}%' style='background-color:#d8dde8' nowrap='nowrap'></td>
								</if>
							</tr>
						</table>
						<p class='desc' style='padding: 2px'>{parse expression="sprintf( $this->lang->words['donations_progress'], "{parse currency="$goal['d_current']"}", "{parse currency="$goal['d_goal']"}" )"}</p>
					</div>
				</if>
				
				<br />
				<if test="goalCheck:|:!$goal['d_goal'] or $goal['d_current'] < $goal['d_goal']">
					<form action='{parse url="app=nexus&amp;module=payments&amp;section=donate" base="public"}' method='post'>
						<input type='hidden' name='goal' value='{$goal['d_id']}' />
						{$this->lang->words['donations_donate_enter']} <input name='amount' size='5' /> <input type='submit' class='input_submit' value='{$this->lang->words['donations_donate']}' />
					</form>
				</if>
		</foreach>
	</ul>
</div>]]></template_content>
      <template_name>donations</template_name>
      <template_data>$goals</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['donations_thanks']}</h1>
	<br />
	<p>{$this->lang->words['donations_received']}</p>
	<if test="hasGoal:|:$goal['d_goal']">
		<br />
		<div style='width: 30%; padding: 5px'>
			<table>
				<tr>
					<td width='{$goal['percent']}%' style='background-color:#225985' nowrap='nowrap'></td>
					<td width='{$goal['left']}%' style='background-color:#d8dde8' nowrap='nowrap'></td>
				</tr>
			</table>
			<p class='desc' style='padding: 2px'>{parse expression="sprintf( $this->lang->words['donations_progress'], "{parse currency="$goal['d_current']"}", "{parse currency="$goal['d_goal']"}" )"}</p>
		</div>
	</if>
</div>]]></template_content>
      <template_name>donations_thanks</template_name>
      <template_data>$goal</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['cancel_title'], $purchase['ps_name'] )"}</h1>
	<br />
	<p class='message error'>{$this->lang->words['gr_cancel_blurb']}</p>
</div>
<fieldset class='submit'>
	<a class='input_submit' href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=do_gr_cancel&amp;id={$purchase['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['purchase_cancel_confirm']}</a>&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
</fieldset>]]></template_content>
      <template_name>grcancel</template_name>
      <template_data>$purchase</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['ca_welcome'], $name )"}</h1>
	<br />
	<p class='ipsType_pagedesc'>{$ca_home}</p>
	<br />
	<if test="pendingInvoices:|:!empty($invoices)">
		<div class='maintitle'>{$this->lang->words['status_pend']}</div>
		<table class='ipb_table' style='margin-bottom:25px'>
			<foreach loop="invoices:$invoices as $invoice">
				<tr>
					<td class='short' style='width: 50px'><span class='desc'>#{$invoice['i_id']}</span></td>
					<td>
						<a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice['i_id']}" base="public"}'><strong>{$invoice['i_title']}</strong></a><br />
						<span class='desc'>{parse date="$invoice['i_date']" format="long"}</span>
					</td>
					<td style='text-align: right; min-width: 100px'>
						<if test="invoiceIsPayable:|:$invoice['i_status'] == 'pend' or $invoice['i_status'] == 'expired'">
							<if test="paymentHeld:|:$invoice['t_id']">
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=receive&amp;do=check&amp;id={$invoice['t_id']}&amp;ac=1" base="{$this->settings['nexus_https']}"}'>{$this->lang->words[ 'invoice_list_' . $invoice['t_status'] ]}</a>
							<else />
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}' class='input_submit'>{$this->lang->words['invoices_pay']}</a>
							</if>
						</if>
					</td>
					<td style='text-align: right; width: 10%; font-size: 16px;'>
						{parse currency="$invoice['i_total']"}
					</td>
				</tr>
			</foreach>
		</table>
	</if>
	<if test="openSupportRequests:|:!empty($requests)">
		<div class='maintitle'>{$this->lang->words['sr_open']}</div>
		<table class='ipb_table topic_list' style='margin-bottom:25px'>
			<tr class='header'>
				<th>&nbsp;</th>
				<th>{$this->lang->words['support_title']}</th>
				<th>{$this->lang->words['support_last_reply']}</th>
				<th>{$this->lang->words['support_status']}</th>
			</tr>
			<foreach loop="requests:$requests as $request">
				<tr class='__topic <if test="isUnread:|:$request['_isUnread']">unread</if>'>
					<td class='col_f_icon altrow short'><if test="isUnread2:|:$request['_isUnread']"><img src='{$this->settings['img_url']}/t_new.png' /></if></td>
					<td>
						<if test="isOpen:|:!$request['r_status_open'] && !$request['r_status_locked']">
							<strong><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="public"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a></strong>
						<else />
							<a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="public"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a>
						</if>
						<br />
						<span class='desc'>{$request['r_department_text']}</span>
					</td>
					<td class='desc'>{parse date="$request['r_last_reply']" format="joined"}</td>
					<td>
						{$request['r_status_text']}
					</td>
				</tr>
			</foreach>
		</table>
	</if>
	<if test="networkStatus:|:$this->settings['network_status']">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=status" template="network-status" seotitle="network-status" base="public"}' title='{$this->lang->words['view_network_status']}'>{$this->lang->words['view_network_status']}</a>
	</if>								
</div>]]></template_content>
      <template_name>home</template_name>
      <template_data>$name, $invoices, $requests, $ca_home</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsBox_container ipsSideMenu'>
	<ul>
		<li class='<if test="pendActive:|:$this->request['status'] == 'pend' or !$this->request['status']">active</if>' id='t_pend'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=pend" base="public"}'>{$this->lang->words['invoices_pend']}</a></li>
		<li class='<if test="paidActive:|:$this->request['status'] == 'paid'">active</if>' id='t_paid'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=paid" base="public"}'>{$this->lang->words['invoices_paid']}</a></li>
		<li class='<if test="expdActive:|:$this->request['status'] == 'expd'">active</if>' id='t_expd'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=expd" base="public"}'>{$this->lang->words['invoices_expd']}</a></li>
		<li class='<if test="cancActive:|:$this->request['status'] == 'canc'">active</if>' id='t_canc'><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;status=canc" base="public"}'>{$this->lang->words['invoices_canc']}</a></li>
	</ul>
</div>]]></template_content>
      <template_name>invoiceFilters</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$this->lang->words['hosting_net_status']}</h1>
<div class='ipsBox'>
	<div class='ipsBox_container ipsPad'>
		<if test="serversOffline:|:!empty( $offline )">
			<div class='message error'>{$this->lang->words['hosting_problems']}</div>
			<br />
			<ul>
			<foreach loop="$offline as $server">
				<li>{$server['server_hostname']}</li>
			</foreach>
			</ul>
			<br />
		<else />
			<div class='message'>{$this->lang->words['hosting_no_problems']}</div>
		</if>		
		{$message}
	</div>
</div>]]></template_content>
      <template_name>networkStatus</template_name>
      <template_data>$offline, $message</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<foreach loop="settings:$settings as $k => $data">
	<li class='ipsField'>
		<label class='ipsField_title'>{$data['title']}</label>
		<div class='ipsField_content'>
			<if test="isTextInput:|:$data['type'] == 'formInput'">
				<input name='data[{$k}]' id='f_{$k}' class='input_text' size='30' />
			<else />
				<if test="isTextArea:|:$data['type'] == 'formTextarea'">
					<textarea name='data[{$k}]' class='input_text' rows='4' cols='30'></textarea>
				</if>
			</if>
			<if test="hasDesc:|:$data['desc']">
				<br /><span class='desc'>{$data['desc']}</span>
			</if>
		</div>
	</li>
</foreach>]]></template_content>
      <template_name>payoutInfo</template_name>
      <template_data>$settings, $gateway</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[{parse js_module="nexus"}
{parse js_module="nexus.checkout"}
<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
</script>
<form action='{parse url="app=nexus&amp;module=clients&amp;section=info&amp;do=save" base="{$this->settings['nexus_https']}"}' method='post' onsubmit='return nexusCheckout.<if test="gotStripeData:|:$stripeData">stripeButtonClick( {$stripeData}, 0, true )<else />submitCardForm()</if>;' id='do_pay'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	
	<div class='ipsPad'>
	
		<h1 class='ipsType_pagetitle'>{$this->lang->words['personal_info']}</h1>
		<br />
	
		<div style='width: 50%' class='left'>
			<ul class='ipsForm ipsForm_vertical'>
				<foreach loop="fields:$fields as $f">
					<if test="isText:|:$f['f_type'] == 'text' and $f['f_column'] != 'cm_address_2'">
						<li class='ipsField'>
							<if test="isAddress:|:$f['f_column'] == 'cm_address_1'">
								<label for='{$f['f_column']}' class='ipsField_title'>{$this->lang->words['cm_address']}</label>
								<div class='ipsField_content'>
									<input type='text' class='input_text' id='{$f['f_column']}' size='40' maxlength='255' value='{$member[ $f['f_column'] ]}' name='{$f['f_column']}' /><br />
									<input type='text' class='input_text' id='cm_address_2' size='40' maxlength='255' value='{$member['cm_address_2']}' name='cm_address_2' style='margin-top: 4px' />
								</div>
							<else />
								<label for='{$f['f_column']}' class='ipsField_title'>{$f['f_name']}</label>
								<p class='ipsField_content'>
									<input type='text' class='input_text' id='{$f['f_column']}' size='40' maxlength='255' value='{$member[ $f['f_column'] ]}' name='{$f['f_column']}' />
								</p>
							</if>
						</li>
					</if>
					<if test="isDropdown:|:$f['f_type'] == 'dropdown'">
						<li class='ipsField ipsField_select'>
							<label for='{$f['f_column']}' class='ipsField_title'>{$f['f_name']}</label>
							<div class='ipsField_content'>
								<select name='{$f['f_column']}' id='{$f['f_column']}' <if test="isCountry:|:$f['f_column'] == 'cm_country'">onchange='states()'</if>>
									<foreach loop="options:explode( "\n", $f['f_extra'] ) as $k => $v">
										{parse variable="selected" default="" oncondition="$v == $member[ $f['f_column'] ] or $k == $member[ $f['f_column'] ]" value=" selected='selected'"}
										<option value='<if test="isCountrySelect:|:$f['f_column'] == 'cm_country'">{$v}<else />{$k}</if>'{parse variable="selected"}><if test="isCountryWords:|:$f['f_column'] == 'cm_country'">{$this->lang->words['nc_'.$v]}<else />{$v}</if></option>
									</foreach>
								</select>
							</div>
						</li>
					</if>
					<if test="isSpecial:|:$f['f_type'] == 'special'">
						<li class='ipsField ipsField_select'>
							<label for='cm_state'  class='ipsField_title'>{$this->lang->words['cm_state']}</label>
							<div class='ipsField_content'>
								<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$member['cm_state']}' />
								<foreach loop="statesSelect:$states as $country => $_states">
									<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
										<foreach loop="states:$_states as $s">
											{parse variable="selected" default="" oncondition="$s[0] == $member['cm_state']" value=" selected='selected'"}
											<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
										</foreach>
									</select>
								</foreach>
							</div>
						</li>
					</if>
				</foreach>
			</ul>
		</div>
		
		<div style='width: 50%' class='right'>
			<if test="cardMethods:|:!empty( $cardMethods )">
			
				<input type='hidden' name='hidden_field' value='' id='hidden_field' />
			
				<if test="cardOnFile:|:$card">
					<p class='ipsType_pagedesc'>{parse expression="sprintf( $this->lang->words['cc_clientarea'], $card, "<a href='{parse url="app=nexus&amp;module=clients&amp;section=info&amp;do=removecard&amp;secure_key={$this->member->form_hash}" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['cc_delete']}</a>" )"}</p>
				<else />
					<p class='ipsType_pagedesc'>{$this->lang->words['cc_blurb']}</p>
				</if>
				<br />
				
				<ul class='ipsForm ipsForm_vertical'>
					<li class='ipsField'>
						<label class='ipsField_title'>{$this->lang->words['checkout_card_number']}</label>
						<p class='ipsField_content'>
							<input type='text' class='input_text' id='card_number' size='40' maxlength='255' value='{$card}' <if test="showFieldNameCredit:|:$showFieldNames">name='card_number'</if> />
						</p>
					</li>
					<li class='ipsField ipsField_select'>
						<label class='ipsField_title'>{$this->lang->words['checkout_card_expire']}</label>
						<div class='ipsField_content'>
							<select <if test="showFieldNameExpireMonth:|:$showFieldNames">name='exp_month'</if> id='exp_month' class='input_select'>
								<option value='00'></option>
								<option value='01'>01</option>
								<option value='02'>02</option>
								<option value='03'>03</option>
								<option value='04'>04</option>
								<option value='05'>05</option>
								<option value='06'>06</option>
								<option value='07'>07</option>
								<option value='08'>08</option>
								<option value='09'>09</option>
								<option value='10'>10</option>
								<option value='11'>11</option>
								<option value='12'>12</option>
							</select>
							<select <if test="showFieldNameExpireYear:|:$showFieldNames">name='exp_year'</if> id='exp_year' class='input_select'>
								<option value='0'></option>
								<foreach loop="years:range( date('Y'), date('Y')+10 ) as $y">
									<option value='$y'>$y</option>
								</foreach>
							</select>
						</div>
					</li>
					<li class='ipsField'>
						<label class='ipsField_title'>{$this->lang->words['checkout_card_cvv2']}</label>
						<p class='ipsField_content'>
							<input type='text' class='input_text' id='code' size='6' maxlength='4' value='' <if test="showFieldNameCardCode:|:$showFieldNames">name='card_code'</if> />  <img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' /><br />
							<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>
						</p>
					</li>
					<if test="oneMethod:|:count( $cardMethods ) == 1">
						<input type='hidden' name='card_method' value='{$cardMethods[0][0]}' />
					<else />
						<li class='ipsField ipsField_select'>
							<label class='ipsField_title'>{$this->lang->words['checkout_card_type']}</label>
							<div class='ipsField_content'>
								<select name='card_method' id='cc_method' class='input_select' onchange='nexusCheckout.changeCardMethod()'>
									<foreach loop="cardMethods:$cardMethods as $m">
										<option value='{$m[0]}' id='card_method_{$m[0]}' data-extra='{$m[2]}'>{$m[1]}</option>
									</foreach>
								</select>
							</div>
						</li>
					</if>
				</ul>
				
				<br />
				<span class='error' id='error_message_holder'></span>
				
			</if>
		</div>
		
		<br class='clear' />
		
	</div>
	
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['personal_info_save']}' class='input_submit' id='submit_button' />
	</fieldset>
</form>
<script type='text/javascript'>
	ipb.lang['info_card_newexpire'] = "{$this->lang->words['info_card_newexpire']}";
	function states()
	{
		var s = $('text-states').value.toLowerCase();		
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			_display = c + '-states';
			$( c + '-states' ).select('option').each ( function ( elem ) {
				if ( elem.value.toLowerCase() == s || elem.innerHTML.toLowerCase() == s )
				{
					elem.selected = true;
				}
			} );
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
	
	<if test="oneMethod:|:count( $cardMethods ) == 1 and $cardMethods[0][2]">
		Stripe.setPublishableKey( '{$cardMethods[0][2]}' );
	<else />
		nexusCheckout.changeCardMethod();
	</if>
</script>]]></template_content>
      <template_name>personalInfo</template_name>
      <template_data>$fields, $member, $states, $card, $cardMethods, $showFieldNames, $stripeData</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<meta charset="{$this->settings['gb_char_set']}" />
<style media='screen, print' type='text/css'>
	body {
		font-family: Helvetica, sans-serif;
	}
</style>
<style media='print' type='text/css'>
	body {
     -webkit-transform: rotate(-90deg); -moz-transform:rotate(-90deg);
     filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
	}
</style>
<div style='width: 30%; float: left'>
	<div style='font-size: 4em'>
		{parse currency="$data['amount']"}
	</div>
	<div style='margin-top: 50px;'>
		<if test="message:|:$data['message']">
			<if test="recipientName:|:$data['recipient_name']">
				{$data['recipient_name']},<br /><br />
			</if>
			{$data['message']}<br /><br /><br />
			<if test="sender:|:$data['sender']">
				{$data['sender']}
			</if>
		</if>
	</div>
	<div style='margin-top: 50px;'>
		<strong>{$this->lang->words['gv_redeem_code']}:<br />{$purchase['ps_id']}{$data['code']}</strong>
	</div>
</div>
<div style='width: 70%; float: left; background-color: #F7FBFC'>
	<div style='height: 55%; margin-top: 25%; text-align: center; font-size: 2.5em'>
		{parse expression="sprintf( $this->lang->words['gv_title'], $this->settings['board_name'] )"}
	</div>
	<div style='height: 20%; margin-left: 20px; text-align: right'>
		{parse expression="sprintf( $this->lang->words['gv_redeem_url'], $this->registry->output->buildSeoUrl( 'app=nexus&amp;module=payments&amp;do=redeem', 'public', 'redeem', 'redeem' ) )"}
		<br style='clear: both' />
	</div>
</div>
<br style='clear: both' />]]></template_content>
      <template_name>printGiftVoucher</template_name>
      <template_data>$purchase, $data</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset={$this->settings['gb_char_set']}" />
		<title>{parse expression="sprintf( $this->lang->words['invoice_number'], $invoice['i_id'] )"}: {$invoice['i_title']}</title>
		
		<style type="text/css">
		body {
		  font-family:Tahoma;
		}
		
		#page {
		  width:1000px;
		  margin:0 auto;
		  padding:15px;
		
		}
		
		table {
		  width:100%;
		}
		
		td {
		padding:5px;
		}
		</style>
		
		<script type='text/javascript'>
			javascript:window.print()
		</script>
		
	</head>
	
	<body>
		<div id="page">
		
			<div>
				<div style='float:left'>
					<h1>[#{$invoice['i_id']}] {$invoice['i_title']}</h1>
					<if test="hasPo:|:$invoice['i_po']">
						{$this->lang->words['invoice_po']}: {$invoice['i_po']}
						<br /><br />
					</if>
				</div>
				
				<div style='float:right; text-align: right'>
					{$header}
					<br /><br /><br />
					{parse date="$invoice['i_date']" format="LONG", relative="false"}<br />
					<strong>{parse expression="strtoupper( $this->lang->words[ 'invoices_' . $invoice['i_status'] ] )"}</strong>
				</div>
				
				<br style='clear:both' />
				
				</div>
		
			<p>
				{$member['cm_first_name']} {$member['cm_last_name']}<br />
				{$member['cm_address_1']}<br />
				<if test="addressLine2:|:$member['cm_address_2']">{$member['cm_address_2']}<br /></if>
				{$member['cm_city']}<br />
				<if test="state:|:$member['cm_state']">{$member['cm_state']}<br /></if>
				{$member['cm_zip']}<br />
				{$member['cm_country']}<br />
			</p>
			
			<hr />
			
			<div id='content'>
			    <table>
					<tr>
						<td style='font-weight:bold'>{$this->lang->words['item_name']}</td>
						<td style='font-weight:bold'>{$this->lang->words['item_cfields']}</td>
						<td style='font-weight:bold'>{$this->lang->words['cart_unit']}</td>
						<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
						<td style='font-weight:bold; text-align: right'>{$this->lang->words['line_price']}</td>
					</tr>
					<foreach loop="items:$invoice['items'] as $item">
						<tr>
							<td>
								{$item['itemName']}
							</td>
							<td>{$item['cfields']}</td>
							<td>
								{$item['cost']}
							</td>
							<td>
								{$item['quantity']}
							</td>
							<td style='text-align: right'>
								{$item['line']}
							</td>
						</tr>
					</foreach>
				</table>
				<hr />
				<div style='text-align:right; padding:5px; line-height: 25px'>
				  	<strong>{$this->lang->words['store_subtotal']}: </strong>{$invoice['subtotal']}<br />
				  	<if test="tax:|:$invoice['tax']">
				  		<strong>{$this->lang->words['store_tax']}: </strong>{parse currency="$invoice['tax']"}<br />
				  	</if>
				  	<strong>{$this->lang->words['store_total']}: </strong>{$invoice['i_total']}<br />
				  </div>
				<hr />
				<if test="notes:|:$invoice['i_notes']">
					<p style='text-align: center'>{$invoice['i_notes']}</p>
					<hr />
				</if>
				<if test="footer:|:$footer">
					<p style='text-align: center'>{$footer}</p>
					<hr />
				</if>
		  </div>
		</div>
	</body>
</html>]]></template_content>
      <template_name>printInvoice</template_name>
      <template_data>$invoice, $member, $header, $footer</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<php>
		$parent = $purchase['ps_parent'];
		$padding = 0;
		$minwidth = 300;
		while ( $parent != 0 )
		{
			$padding += 50;
			$minwidth -= 50;
			$parent = $purchases[ $parent ]['ps_parent'];
		}
	</php>
	<li class='clear clearfix row2' style='margin-left:{$padding}px; margin-bottom: 5px'>
		<div class='product_info left' style='width: {$minwidth}px'>
			<if test="imageMargin:|:$purchase['img']"><img src='{$purchase['img']}' {parse resize_image="{$purchase['img']}" maxwidth="40" maxheight="40"} style='max-height: 40px' class='left' /></if>
			<div <if test="imageShow:|:$purchase['img']">style='margin-left: 55px'</if>>
				<h3>
					<if test="link:|:$purchase['ps_item_uri']">
						<a href='{parse url="{$purchase['ps_item_uri']}" base="public"}'>{$purchase['ps_name']}</a>
					<else />
						<if test="hideLink:|:$purchase['hide_link']">
							{$purchase['ps_name']}
						<else />
							<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}'>{$purchase['ps_name']}</a>
						</if>
					</if>
					<if test="cancelled:|:$purchase['ps_cancelled']">
						<span class='negative desc'>({$this->lang->words['invoices_canc']})</span>
					<else />
						<if test="expired:|:!$purchase['ps_active']">
							<span class='zero desc'>({$this->lang->words['invoices_expd']})</span>
						</if>
					</if>
				</h3>
				<if test="lkey:|:$purchase['lkey_key']">
					<div style='padding:5px'><img src='{$this->settings['img_url']}/nexus/lkey.png' alt='{$this->lang->words['nexus_lkey']}' title='{$this->lang->words['nexus_lkey']}' /> <span class='desc'>{$purchase['lkey_key']}</span></div>
				</if>
			</div>
		</div>
		<p class='ship_info left' style='padding-right: 40px'>
			<span class='desc'>{$this->lang->words['purchased']}</span><br />
			<strong class='package_date'>{parse date="$purchase['ps_start']" format="joined"}</strong>
		</p>
		<if test="expiryDate:|:$purchase['ps_expire']">
			<p class='ship_info left' style='padding-right: 40px'>
				<span class='desc'>{$this->lang->words['expires']}</span><br />
				<strong class='package_date'>{parse date="$purchase['ps_expire']" format="joined" relative="false"}</strong>
			</p>
		</if>
		<if test="renewalTerms:|:$purchase['ps_renewals'] and !$purchase['ps_grouped_renewals']">
			<p class='ship_info left'>
				<span class='desc'>{$this->lang->words['purchase_renewals']}</span><br />
				<strong class='package_date'>{$purchase['renewal']}</strong>
			</p>
		</if>
	
	</li>
	
	<if test="hasChildren:|:is_array( $parentMap[ $purchase['ps_id'] ] )">
		<foreach loop="children:$parentMap[ $purchase['ps_id'] ] as $child">
			{parse template="purchaseRow" group="nexus_clients" params="$purchases[ $child ], $parentMap, $purchases"}
		</foreach>
	</if>]]></template_content>
      <template_name>purchaseRow</template_name>
      <template_data>$purchase, $parentMap, $purchases</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=do_reactivate&amp;id={$purchase['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' method='post'>
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['reactivate_title'], $purchase['ps_name'] )"}</h1>
		<br />
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField ipsField_select'>
				<label class='ipsField_title'>{$this->lang->words['reactivate_terms']}</label>
				<div class='ipsField_content'>
					<select name='renewals'>
						<foreach loop="renewOptions:$renewOptions as $k => $v">
							<option value='{$k}'>{$v}</option>
						</foreach>
					</select>
				</div>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['purchase_reactivate']}' />&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
	</fieldset>
</form>]]></template_content>
      <template_name>reactivate</template_name>
      <template_data>$purchase, $renewOptions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=greactivate&amp;secure_key={$this->member->form_hash}" base="public"}' method='post'>
	<input type='hidden' name='reactivate[{$purchase['ps_id']}]' value='1' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['reactivate_title'], $purchase['ps_name'] )"}</h1>
		<br />
		<p>{$this->lang->words['reactivate_siblings']}</p>
		<ul class='nexus_block_list' id='package_change'>
			<foreach loop="options:$siblings as $sibling">
				<li class='clear clearfix row2'>
					<span class='toggle'>
						<input type='checkbox' id='r_{$sibling['ps_id']}' name='reactivate[{$sibling['ps_id']}]' class='input_radio' />
					</span>
					<div style='margin-left: 55px'>
						<label for='r_{$sibling['ps_id']}'><h3>{$sibling['ps_name']}</h3></label>
					</div>
				</li>
			</foreach>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['reactivate_continue']}' />&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=view&amp;id={$purchase['ps_id']}" base="public"}' title='{$this->lang->words['go_back']}' class='cancel'>{$this->lang->words['go_back']}</a>
	</fieldset>
</form>]]></template_content>
      <template_name>reactivateWithSiblings</template_name>
      <template_data>$purchase, $siblings</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['referrals']}</h1>
	<br />
	<if test="hasBlurb:|:$blurb">
		<p class='message'>
			{$blurb}
			<if test="hasCommissionRules:|:$this->settings['nexus_com_rules'] or $this->settings['nexus_com_rules_alt']">
				<br />
				<a href='#' class='ipsButton_secondary' id='commission_popup_link'>{$this->lang->words['ref_blurb_more']}</a>
			</if>
		</p>
		<br />
	</if>
	<form action='{parse url="app=nexus&amp;module=clients&amp;section=referrals" base="public"}' method='post'>
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField'>
				<label class='ipsField_title'>{$this->lang->words['ref_url']}</label>
				<div class='ipsField_content'>
					<input name='ref_url' class='input_text' value='{$url}' />
					<input type='submit' class='input_submit' value='{$this->lang->words['_rarr']}' />
				</div>
			</li>
		</ul>
	</form>
	<br />
	<h3>{$this->lang->words['referrals_direct']}</h3>
	<textarea class='input_text refer_code' id='refer_code_html' readonly='readonly'>{parse url="app=nexus&amp;module=promotion&amp;section=referral&amp;id={$this->memberData['member_id']}&amp;direct={parse expression="urlencode( base64_encode( $url ) )"}" base="public"}</textarea>
	<h3>{$this->lang->words['referrals_html']} <span class='desc'>({$this->lang->words['referrals_html_blurb']})</span></h3>
	<textarea class='input_text refer_code' id='refer_code_html' readonly='readonly'><a href='{parse url="app=nexus&amp;module=promotion&amp;section=referral&amp;id={$this->memberData['member_id']}&amp;direct={parse expression="urlencode( base64_encode( $url ) )"}" base="public"}'>{$this->settings['board_name']}</a></textarea>
	<br /><br />
	<h3>{$this->lang->words['referrals_bbcode']} <span class='desc'>({$this->lang->words['referrals_bbcode_blurb']})</span></h3>
	<textarea class='input_text refer_code' id='refer_code_bbcode' readonly='readonly'>[url="{parse url="app=nexus&amp;module=promotion&amp;section=referral&amp;id={$this->memberData['member_id']}&amp;direct={parse expression="urlencode( base64_encode( $url ) )"}" base="public"}"]{$this->settings['board_name']}[/url]</textarea>
	<foreach loop="banners:$banners as $b">
		<h3>{$this->lang->words['referrals_preview']}</h3>
		<div id='refer_preview' class='row2'>
			<img src='{$b['rb_url']}' />
		</div>
		<br />
		
		<h3>{$this->lang->words['referrals_html']} <span class='desc'>({$this->lang->words['referrals_html_blurb']})</span></h3>
		<textarea class='input_text refer_code' id='refer_code_html' readonly='readonly'><a href='{parse url="app=nexus&amp;module=promotion&amp;section=referral&amp;id={$this->memberData['member_id']}&amp;direct={parse expression="urlencode( base64_encode( $url ) )"}" base="public"}'><img src='{$b['rb_url']}' /></a></textarea>
		<br /><br />
		
		<h3>{$this->lang->words['referrals_bbcode']} <span class='desc'>({$this->lang->words['referrals_bbcode_blurb']})</span></h3>
		<textarea class='input_text refer_code' id='refer_code_bbcode' readonly='readonly'>[url="{parse url="app=nexus&amp;module=promotion&amp;section=referral&amp;id={$this->memberData['member_id']}&amp;direct={parse expression="urlencode( base64_encode( $url ) )"}" base="public"}"][img]{$b['rb_url']}[/img][/url]</textarea>
	</foreach>
</div>
<div class='popupWrapper' id='commission_popup' style='display:none'>
	<div class='popupInner'>
		<h3>{$this->lang->words['commission']}</h3>
		<div class='ipsPad'>
			<if test="commRules:|:$this->settings['nexus_com_rules']">
				<table class='ipb_table'>
					<tr>
						<th>{$this->lang->words['commission_condition']}</th>
						<th>{$this->lang->words['commission']}</th>
					</tr>
					<foreach loop="rules:$rules as $r">
						<tr>
							<td>{$r['conditions']}</td>
							<td>
								{$r['rrule_commission']}%
								<if test="rulePackageLimit:|:$r['rrule_purchase_package_limit']">
									<span class='desc'>{$this->lang->words['ref_com_plimit']}</span>
								</if>
								<if test="ruleCommLimit:|:$r['rrule_commission_limit']">
									<span class='desc'>{parse expression="sprintf( $this->lang->words['ref_com_limit'], $this->lang->formatMoney( $r['rrule_commission_limit'], FALSE ) )"}</span>
								</if>
							</td>
						</tr>
					</foreach>
				</table>
			<else />
				{parse expression="IPSText::getTextClass('bbcode')->preDisplayParse( $this->settings['nexus_com_rules_alt'] )"}
			</if>
		</div>
	</div>
</div>

<script type='text/javascript'>
	function doPopUp( e, elem )
	{
		new ipb.Popup('commission-popup', { type: 'modal', stem: true, attach: { target: elem, position: 'auto' }, hideAtStart: false, w: '500px', initial: $('commission_popup').innerHTML } );
	}
	
	ipb.delegate.register('#commission_popup_link', doPopUp );
</script>]]></template_content>
      <template_name>referrals</template_name>
      <template_data>$banners, $blurb, $url, $rules</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;id={$purchase['ps_id']}&amp;do=do_renew" base="public"}' method='post'>
<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
<input type='hidden' id='renew_price' value='{$purchase['ps_renewal_price']}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['renew_title'], $purchase['ps_name'] )"}</h1>
		<br />
		<ul class='ipsForm ipsForm_vertical'>
			<if test="!empty( $inactiveChildren )">
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['renew_and_reactivate']}</label>
					<br /><br />
					<div class='ipsField_content'>
						<foreach loop="$inactiveChildren as $child">
							<label for='r[{$child['ps_id']}]'><input type='checkbox' id='r[{$child['ps_id']}]' name='r[{$child['ps_id']}]' class='reactivate_check' onchange='updatePrice()' data-fee='{$child['reactivate_fee']}' data-add='{$child['add_to_renew']}' checked='checked' /> {$child['ps_name']}</label>
							<br /><br />
						</foreach>
					</div>
				</li>
			</if>
			<if test="!empty( $options )">
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['renew_length']}</label>
					<div class='ipsField_content'>
						<select name='cycles' id='cycles' onchange='updatePrice()'>
							<foreach loop="renewOptions:$options as $k => $v">
								<option value='{$k}'>{$v}</option>
							</foreach>
						</select>
					</div>
				</li>
			</if>
		</ul>
	</div>
	<fieldset class='submit'>
		<span class='price' id='price'>{parse currency="0"}</span><br />
		<br />		
		<input type='submit' class='input_submit' value='{$this->lang->words['purchase_renew']}' id='submit' />
	</fieldset>
</form>
<script type='text/javascript'>
	
	function updatePrice()
	{
		price = parseFloat( $('renew_price').value );
		fees = 0;
		
		$$('.reactivate_check').each(function(e){
			if ( e.checked ){
				fees += parseFloat( e.readAttribute('data-fee') );
				price += parseFloat( e.readAttribute('data-add') );
			}
		});
		if ( $('cycles') !== null )
		{
			price *= parseInt( $('cycles').value );
		}
		
		price += parseFloat( fees );
		
		new Ajax.Request( ipb.vars['base_url'] + "app=nexus&module=ajax&section=clients&do=format_price&secure_key="+ipb.vars['secure_hash'],
		{
			method: 'post',
			parameters: {
				'price': price,
			},
			onSuccess: function(t)
			{
				$('price').innerHTML = t.responseJSON['price'];
			}
		});
				
		if ( !price )
		{
			$('submit').disabled = true;
			$('submit').style.cursor = 'not-allowed';
		}
		else
		{
			$('submit').disabled = false;
			$('submit').style.cursor = 'pointer';
		}
	}
	updatePrice();
	
</script>]]></template_content>
      <template_name>renewForm</template_name>
      <template_data>$purchase, $options, $inactiveChildren</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['your_purchases']}</h1>
	<br />
	<p class='ipsType_pagedesc'>
		{$this->lang->words['purchases_renew_blurb']}
	</p>
	<br />
	<ul class='nexus_block_list' id='package_change'>
		<foreach loop="options:$purchases as $p">
			<li class='clear clearfix row2'>
				<div style='margin-left: 55px'>
					<h3><a href='{parse url="app=nexus&module=clients&section=purchases&amp;do=renew&amp;id={$p['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$p['ps_name']}</a></h3>
					<p class='block_text'>
						{$p['ps_renewal_terms']}
					</p>
				</div>
			</li>
		</foreach>
	</ul>
	<br />
	{$pagination}
</div>]]></template_content>
      <template_name>renewPurchaseOptions</template_name>
      <template_data>$purchases, $pagination</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<div class='clearfix'>
		<div class='left'>
			<h1 class='ipsType_pagetitle'>{$this->lang->words['track_shipment']}</h1>
			<p class='ipsType_pagedesc clear'>
				{$this->lang->words['shipstatus_' . $order['o_status']]}
			</p>
		</div>
		<div class='right'>
			{$this->lang->words['ship_order_ordered']} {$this->lang->getDate( $order['o_date'], 'JOINED', true )}<br />
			<if test="orderComplete:|:$order['o_status'] == 'done'">
				{$this->lang->words['ship_order_shipped']} {$this->lang->getDate( $order['o_shipped_date'], 'JOINED', true )}<br />
				<if test="isDelivered:|:$trackingInfo['delivered']">
					{$this->lang->words['ship_order_delivered']} {$this->lang->getDate( $trackingInfo['delivered'], 'JOINED', true )}<br />
				<else />
					<if test="hasEta:|:$trackingInfo['eta']">
						{$this->lang->words['ship_order_eta']} {$this->lang->getDate( $trackingInfo['eta'], 'JOINED', true )}<br />
					</if>
				</if>
			</if>
		</div>
	</div>
	<br />
	<br />
	<h3 class='maintitle'>{$this->lang->words['shiporder_items']}</h3>
	<table class='ipb_table'>
		<tr class='header'>
			<th>{$this->lang->words['item']}</th>
			<th>{$this->lang->words['store_options']}</th>
			<th class='short'>{$this->lang->words['cart_qty']}</th>
		</tr>
		<foreach loop="items:$items as $item">
			<tr>
				<td>
					{$item['itemName']}
				</td>
				<td>
					{$item['cfields']}
				</td>
				<td class='short'>
					{$item['quantity']}
				</td>
			</tr>
		</foreach>
	</table>
	<br />
	<br />
	<h3 class='maintitle'>{$this->lang->words['shiporder_track']}</h3>
	<if test="trackingData:|:!empty( $trackingInfo['data'] )">
		<table class='ipb_table'>
			<tr class='header'>
				<th>{$this->lang->words['track_time']}</th>
				<th>{$this->lang->words['track_event']}</th>
				<th>{$this->lang->words['track_location']}</th>
				<th>{$this->lang->words['track_notes']}</th>
			</tr>
			<foreach loop="items:$trackingInfo['data'] as $event">
				<tr>
					<td>
						{$this->lang->getDate( $event['time'], 'LONG', true )}
					</td>
					<td>
						{$event['event']}
					</td>
					<td>
						{$event['location']}
					</td>
					<td>
						{$event['notes']}
					</td>
				</tr>
			</foreach>
		</table>
	<else />
		<div class='no_messages'>
			<if test="trackingUrl:|:$trackUrl">
				<a href='{$trackUrl}' target='_blank'>{$this->lang->words['shiporder_track_click']}</a>
			<else />
				{$this->lang->words['track_empty']}
			</if>
		</div>
	</if>
</div>]]></template_content>
      <template_name>shippingOrder</template_name>
      <template_data>$order, $items, $trackingInfo, $trackUrl</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['your_invoices']}</h1>
	<br />
	<if test="noInvoices:|:!empty( $invoices )">
		<table class='ipb_table'>
			<foreach loop="invoices:$invoices as $invoice">
				<tr>
					<td class='short' style='width: 50px'><span class='desc'>#{$invoice['i_id']}</span></td>
					<td>
						<a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice['i_id']}" base="public"}'><strong>{$invoice['i_title']}</strong></a><br />
						<span class='desc'>{parse date="$invoice['i_date']" format="long"}</span>
					</td>
					<td style='text-align: right; min-width: 100px'>
						<if test="payable:|:$invoice['i_status'] == 'pend'">
							<if test="paymentHeld:|:$invoice['t_id']">
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=receive&amp;do=check&amp;id={$invoice['t_id']}&amp;ac=1" base="{$this->settings['nexus_https']}"}'>{$this->lang->words[ 'invoice_list_' . $invoice['t_status'] ]}</a>
							<else />
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}' class='input_submit'>{$this->lang->words['invoices_pay']}</a>
							</if>
						</if>
					</td>
					<td style='text-align: right; width: 10%; font-size: 16px;'>
						{parse currency="$invoice['i_total']"}
					</td>
				</tr>
			</foreach>
		</table>
	<else />
		{$this->lang->words['invoices_none']}
	</if>
</div>]]></template_content>
      <template_name>showInvoices</template_name>
      <template_data>$invoices</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['your_purchases']}</h1>
	<br />
	<p class='ipsType_pagedesc'>
		{$this->lang->words['purchases_blurb']}
	</p>
	<br />
	<if test="havePurchases:|:count($purchases)">
		<ul id='package_list' class='nexus_block_list'>
			<foreach loop="children:$parentMap[0] as $item">
				{parse template="purchaseRow" group="nexus_clients" params="$purchases[ $item ], $parentMap, $purchases"}
			</foreach>
		</ul>
	<else />
		<div class='no_messages'>
			{$this->lang->words['nopurchases']}
		</div>
	</if>
</div>]]></template_content>
      <template_name>showPurchases</template_name>
      <template_data>$purchases, $parentMap</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['change_package']}</h1>
	<br />
	<p class='ipsType_pagedesc'>
		{$this->lang->words['change_package_blurb']}<br />
	</p>
	<br />
	<form action='{parse url="app=nexus&module=clients&section=purchases&amp;do=change&amp;id={$purchase['ps_id']}" base="public"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
		<ul class='nexus_block_list' id='package_change'>
			<foreach loop="options:$options as $option">
				<li class='clear clearfix row2'>
					<span class='toggle'>
						<input type='radio' name='select' value='{$option['p_id']}' class='input_radio' />
					</span>
					<div style='margin-left: 55px'>
						<h3>{$option['p_name']}</h3>
						<p class='block_text'>
							{$option['renewal_terms']}
						</p>
					</div>
				</li>
			</foreach>
		</ul>
		<br />
		<input type='submit' value='{$this->lang->words['change_save']}' class='input_submit' /> &nbsp;&nbsp;{$this->lang->words['or']}&nbsp; <a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases" base="public"}' title='{$this->lang->words['cancel']}' class='cancel'>{$this->lang->words['cancel']}</a>
	</form>
</div>]]></template_content>
      <template_name>showUpgradeOptions</template_name>
      <template_data>$purchase, $options</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<ul class='topic_buttons'>
		<if test="payable:|:$invoice['i_status'] == 'pend' or $invoice['i_status'] == 'expired'">
			<li>
				<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice['i_id']}" base="{$this->settings['nexus_https']}"}' class='input_submit'>{$this->lang->words['invoices_pay']}</a>
			</li>
			<li class='non_button'>
				<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=cancel&amp;id={$invoice['i_id']}&amp;secure_key={$this->member->form_hash}&amp;boink=ca" base="public"}' class='cancel'><img src='{$this->settings['img_url']}/nexus/cross.png' alt='{$this->lang->words['icon']}' /> &nbsp;{$this->lang->words['invoice_cancel']}</a>
			</li>
		</if>
		<li class='non_button'>
			 <a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=print&amp;id={$invoice['i_id']}" base="public"}' target='_blank'><img src='{$this->settings['img_url']}/nexus/print.png' alt='{$this->lang->words['icon']}' /> &nbsp;{$this->lang->words['print']}</a>
		</li>
	</ul>
	<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['invoice_number'], $invoice['i_id'] )"}</h1>
	<p class='ipsType_pagedesc'>{parse expression="sprintf( $this->lang->words['invoice_generated'], "{parse date="$invoice['i_date']" format="long"}" )"}</p>
	
	<br /><br />
	
	<table class='ipb_table'>
		<tr class='header'>
			<th>{$this->lang->words['item']}</th>
			<th>{$this->lang->words['store_options']}</th>
			<th class='short'>{$this->lang->words['cart_unit']}</th>
			<th class='short'>{$this->lang->words['cart_qty']}</th>
			<th style='text-align: right'>{$this->lang->words['cart_line']}</th>
		</tr>
		<foreach loop="items:$invoice['items'] as $item">
			<tr>
				<td>
					<if test="hasLink:|:$item['itemURI']">
						<a href='{parse url="{$item['itemURI']}" base="public"}'>{$item['itemName']}</a>
					<else />
						<if test="isRenewal:|:$item['act'] == 'renewal'">
							<a href='{parse url="app=nexus&module=clients&section=purchases&do=view&id={$item['itemID']}" base="public"}'>{$item['itemName']}</a>
						<else />
							{$item['itemName']}
						</if>
					</if>
				</td>
				<td>
					{$item['cfields']}
				</td>
				<td class='short'>
					{$item['cost']}
				</td>
				<td class='short'>
					{$item['quantity']}
				</td>
				<td style='text-align: right'>
					{$item['line']}
				</td>
			</tr>
		</foreach>
	</table>
	<table class='ipb_table right' style='width: 300px'>
		<tr style='font-weight: bold'>
			<td style='text-align: right'>{$this->lang->words['store_subtotal']}</td>
			<td style='text-align: right'>{$invoice['subtotal']}</td>
		</tr>
		<if test="discount:|:$invoice['i_discount']">
			<tr style='font-weight: bold'>
				<td style='text-align: right'>{$invoice['i_discount']}% {$this->lang->words['store_bundle_discount']}</td>
				<td style='text-align: right'>{$invoice['discount_amount']}</td>
			</tr>
		</if>
		<if test="tax:|:$invoice['tax']">
			<tr style='font-weight: bold'>
				<td style='text-align: right'>{$this->lang->words['store_tax']}</td>
				<td style='text-align: right'>{parse currency="$invoice['tax']"}</td>
			</tr>
		</if>
		<tr class='total'>
			<td style='text-align: right'>{$this->lang->words['store_total']}</td>
			<td style='text-align: right'><strong>{$invoice['i_total']}</strong></td>
		</tr>
	</table>
</div>]]></template_content>
      <template_name>viewInvoice</template_name>
      <template_data>$invoice</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=notes" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='id' value='{$invoice['i_id']}' />
	<h3 class='bar'>{$this->lang->words['invoice_notes']}</h3>
	<div class='ipsBox_container ipsPad'>
		<ul>
			<li class='field'>
				<label for='po'>{$this->lang->words['invoice_po']}</label>
				<input name='po' class='input_text' size='25' id='po' value='{$invoice['i_po']}' />
			</li>
			<li class='field'>
				<label for='notes'>{$this->lang->words['invoice_notes']}</label>
				<textarea name='notes' id='notes' rows='10' cols='25'>{$invoice['i_notes']}</textarea>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['invoice_notes_submit']}' />
	</fieldset>
</form>]]></template_content>
      <template_name>viewInvoiceRight</template_name>
      <template_data>$invoice</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<if test="image:|:$package['image']">
		<img src='{$package['image']}' class='left ipsPad' {parse resize_image="{$package['image']}" maxwidth="80" maxheight="80"} />
	</if>
	<h1 class='ipsType_pagetitle'>{$package['ps_name']}</h1>
	<if test="cancelled:|:$package['ps_cancelled']">
		<span class='ipsBadge ipsBadge_red'>{$this->lang->words['canceled']}</span>
	<else />
		<if test="expired:|:!$package['ps_active']">
			<span class='ipsBadge ipsBadge_grey'>{$this->lang->words['expired']}</span>
		</if>
	</if>
	
	<div class='ipsType_pagedesc'>
		{$this->lang->words['purchased']}: <strong>{parse date="$package['ps_start']" format="long"}</strong>
		<if test="expiryDate:|:$package['ps_expire']">
			<br />
			{$this->lang->words['expires']}: <strong>{parse date="$package['ps_expire']" format="long" relative="false"}</strong>
		</if>
		<if test="expiryDate:|:$package['ps_renewals']">
			<br />
			{$this->lang->words['purchase_renewals']}: <strong>{$this->registry->getAppClass('nexus')->formatRenewalTerms( array( 'unit' => $package['ps_renewal_unit'], 'term' => $package['ps_renewals'], 'price' => $package['ps_renewal_price'], 'gr' => $package['ps_grouped_renewals'], 'tax' => ( $this->settings['nexus_show_tax'] ? $package['ps_tax'] : 0 ) ) )}</strong>
		</if>
	</div>
	<br />
	
	<if test="pendingInvoices:|:$package['ps_invoice_pending'] and !$package['ps_grouped_renewals']">
		<br />
		<p class='message'>
			<if test="invoicePending:|:$package['ps_invoice_pending'] == 1">
				{$this->lang->words['purchase_invoice_pending']}<br /><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices" base="public"}'>{$this->lang->words['view_pending_invoices']}</a>
			<else />
				<a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$package['ps_invoice_pending']}" base="public"}'>{$this->lang->words['purchase_invoice_pending']}</a>
			</if>
		</p>
		<br />
	</if>
	{$content[ $package['ps_item_id'] ]['html']}
	{$content[ $package['ps_item_id'] ]['attachmentHtml']}
	<br /><br />
	<if test="extra:|:$extra">
		{$extra['mainBox']}
		<br /><br />
	</if>
	<if test="customFields:|:!empty($fields)">
		<h3>{$this->lang->words['store_package_info']}</h3>
		<br />
		<form action='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=update&amp;id={$package['ps_id']}" base="public"}' method='post'>
			<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
			<foreach loop="fields:$fields as $f">
				<strong>{$f->name}</strong>
				<br />
				{$f->edit()}
				<br /><br />
			</foreach>
			<if test="editable:|:$editable">
				<br /><br />
				<input type='submit' class='input_submit' value='{$this->lang->words['save_changes']}' />
			</if>
		</form>
	</if>
</div>]]></template_content>
      <template_name>viewPackage</template_name>
      <template_data>$content, $support, $package, $fields, $editable, $current, $downloads, $extra, $upgradeOptions, $assocOptions, $shipOrder=NULL</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<p class='message'>{$message}</p>
<div style='padding: 20px; text-align: center'>
	<a href='{$ad['ad_link']}'><img src='{$ad['ad_image']}' /></a>
</div>
<ul>
	<if test="adTerms:|:$ad['ad_terms']">
		<li>
			<label>{$this->lang->words['ad_terms']} </label>
			{$ad['terms']}
		</li>
	</if>
	<li>
		<label>{$this->lang->words['ad_clicks_sofar']} </label>
		{$ad['ad_clicks']}
	</li>
	<li>
		<label>{$this->lang->words['ad_impressions_sofar']} </label>
		{$ad['ad_impressions']}
	</li>
</ul>]]></template_content>
      <template_name>viewPackageAdvertisement</template_name>
      <template_data>$message, $ad</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<table class='ipb_table'>
	<tr>
		<td width='20%'><strong>{$this->lang->words['haccount_server']}</strong></td>
		<td>{$account->server->data['server_hostname']}</td>
		<td>{$ftp} &nbsp;&nbsp; {$cp}</td>
	</tr>
	<tr>
		<td width='20%'><strong>{$this->lang->words['haccount_domain']}</strong></td>
		<td><a href='http://{$account->data['account_domain']}' target='_blank'>{$account->data['account_domain']}</a></td>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td width='20%'><strong>{$this->lang->words['haccount_username']}</strong></td>
		<td>{$account->data['account_username']}</td>
		<td>&nbsp;</td>
	</tr>
	<tr>
		<td width='20%'><strong>{$this->lang->words['haccount_password']}</strong></td>
		<td>{$account->data['account_password']}</td>
		<td>{$changePass}</td>
	</tr>
	<foreach loop="info:$accountInformation as $rv">
		<tr>
			<td width='20%'><strong>{$r[0]}</strong></td>
			<td>{$r[1]}</td>
			<td>{$r[2]}</td>
		</tr>
	</foreach>
</table>]]></template_content>
      <template_name>viewPackageHosting</template_name>
      <template_data>$account, $accountInformation, $ftp, $cp, $changePass</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<h3>{$this->lang->words['nexus_lkey']}</h3>
<br />
{$lkey['lkey_key']}<br />]]></template_content>
      <template_name>viewPackageLkey</template_name>
      <template_data>$lkey</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_clients</template_group>
      <template_content><![CDATA[<div class='ipsBox_container ipsPad'>
	<if test="trackLink:|:$shipOrder['o_id']">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=track&amp;id={$shipOrder['o_id']}" base="public"}' class='ipsButton'>{$this->lang->words['track_shipment']}</a>
		<br /><br />
	</if>
	<if test="supportLink:|:$support and $package['ps_active']">
		<a href='{parse url="app=nexus&amp;module=support&amp;section=new&amp;&amp;department={$support}&amp;package={$package['ps_id']}" base="public"}' class='ipsButton'>{$this->lang->words['new_support_request']}</a>
		<br /><br />
	</if>
	<if test="renewLink:|:$package['renewable']">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=renew&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='ipsButton'>{$this->lang->words['purchase_renew']}</a>
		<br /><br />
	</if>
	<if test="upgradeLink:|:!empty($upgradeOptions)">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=change&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='ipsButton'>{$this->lang->words['change_package']}</a>
		<br /><br />
	</if>
	<if test="assocLink:|:!empty($assocOptions)">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=assoc&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='ipsButton'>{$this->lang->words['purchase_associate']}</a>
		<br /><br />
	</if>
	{$extra['buttons']}
	<if test="downloadsLink:|:count($downloads)">
		<if test="moreThanOne:|:count($downloads)>1 or strlen( $downloads[0]['file_name'] ) > 30">
			<a id='purchase_downloads' class='ipsButton ipbmenu'>{parse expression="sprintf( $this->lang->words['purchase_download'], "<img src='{$this->settings['img_url']}/nexus/dropdown.png' alt='{$this->lang->words['icon']}' />" )"}</a>
			<br /><br />
			<ul id='purchase_downloads_menucontent' class='boxShadow'>
				<foreach loop="downloads:$downloads as $d">
					<li class='row1'>
						<if test="hash:|:$d['hash']">
							<a href='{parse url="app=downloads&module=display&section=download&do=confirm_download&id={$d['file_id']}&hash={$d['hash']}" base="public"}'>{parse expression="sprintf( $this->lang->words['purchase_download_with_version'], "{$d['file_name']}", "{$d['file_version']}" )"}</a>
						<else />
							<a href='{parse url="app=downloads&module=display&section=download&do=confirm_download&id={$d['file_id']}" base="public"}'>{parse expression="sprintf( $this->lang->words['purchase_download_with_version'], "{$d['file_name']}", "{$d['file_version']}" )"}</a>
						</if>
					</li>
				</foreach>
			</ul>
			<script type='text/javascript'>
				if( $('purchase_downloads_menucontent') ){
					$('purchase_downloads_menucontent').hide();
				}
			</script>
		<else />
			<if test="hashForJustOne:|:$downloads[0]['hash']">
				<a href='{parse url="app=downloads&module=display&section=download&do=confirm_download&id={$downloads[0]['file_id']}&hash={$downloads[0]['hash']}" base="public"}' class='ipsButton'>{parse expression="sprintf( $this->lang->words['purchase_download_with_version'], "{$downloads[0]['file_name']}", "{$downloads[0]['file_version']}" )"}</a>
				<br /><br />
			<else />
				<a href='{parse url="app=downloads&module=display&section=download&do=confirm_download&id={$downloads[0]['file_id']}" base="public"}' class='ipsButton'>{parse expression="sprintf( $this->lang->words['purchase_download_with_version'], "{$downloads[0]['file_name']}", "{$downloads[0]['file_version']}" )"}</a>
				<br /><br />
			</if>
		</if>
	</if>
	<if test="reviewLink:|:$reviewable">
		<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;&amp;do=review_write&amp;id={$package['ps_item_id']}" base="public"}' class='ipsButton'>{parse expression="ucwords($this->lang->words['write_a_review'])"}</a>
		<br /><br />
	</if>
	<if test="cancelLink:|:$package['ps_active'] and !$package['ps_cancelled'] and ( $package['ps_renewals'] or $package['ps_grouped_renewals'] )">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=cancel&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='ipsButton'>{$this->lang->words['purchase_cancel']}</a>
		<br /><br />
	</if>
	<if test="reactivateLink:|:( $package['ps_cancelled'] or !$package['ps_renewals'] ) and $package['ps_can_reactivate'] == 1">
		<a href='{parse url="app=nexus&amp;module=clients&amp;section=purchases&amp;do=reactivate&amp;id={$package['ps_id']}&amp;secure_key={$this->member->form_hash}" base="public"}' class='ipsButton'>{$this->lang->words['purchase_reactivate']}</a>
		<br /><br />
	</if>
</div>]]></template_content>
      <template_name>viewPackageRight</template_name>
      <template_data>$content, $support, $package, $fields, $editable, $current, $downloads, $extra, $upgradeOptions, $assocOptions, $reviewable, $shipOrder=NULL</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_nexus_emails">
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_new_invoice']} <#AUTOPAY_REASON#><br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
{$this->lang->words['ne_info_only']} <#SHIP#>
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>autopay</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_new_invoice']}. {$this->lang->words['ne_autopay_fail']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<a href='<#LINK#>'>{$this->lang->words['ne_login_for_payment_urgent']}</a>. {$this->lang->words['ne_autopay_provider']} <a href='<#DETAILS_LINK#>'>{$this->lang->words['ne_autopay_details']}</a>.
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>autopay_fail</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[{parse expression="nl2br($this->lang->words['autoresolve_warning'])"}<br />]]></template_content>
      <template_name>autoresolve</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<strong><a href='{parse url="app=nexus&amp;module=clients&amp;section=invoices&amp;do=view&amp;id={$invoice->id}" base="public"}'>{parse expression="sprintf( $this->lang->words['invoice_number'], $invoice->id )"} - {$invoice->title}</a></strong><br />
<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['cart_desc']}</td>
		<td style='font-weight:bold'>&nbsp;</tdh>
		<td style='font-weight:bold'>{$this->lang->words['cart_unit']}</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_line']}</td>
	</tr>
	<foreach loop="items:$invoice->items as $k => $item">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>
				<if test="hasLink:|:$item['itemURI']">
					<a href='{parse url="{$item['itemURI']}" base="public"}'>{$item['itemName']}</a>
				<else />
					<if test="isRenewal:|:$item['act'] == 'renewal'">
						<a href='{parse url="app=nexus&module=clients&section=purchases&do=view&id={$item['itemID']}" base="public"}'>{$item['itemName']}</a>
					<else />
						{$item['itemName']}
					</if>
				</if>
			</td>
			<td>
				<if test="cfields:|:is_array( $item['cfields'] )">
					<foreach loop="cfields:$item['cfields'] as $id => $value">
						{$cfields[ $id ]['cf_name']}: {$invoice->getCustomFieldValue( $cfields[ $id ], $value )}<br />
					</foreach>
				</if>
			</td>
			<td class='short'>
				<if test="multiplePrices:|:is_array( $item['prices'] )">
					{parse expression="invoice::formatPrices( $item['prices'] )"}
				<else />
					{$this->lang->formatMoney( $item['cost'] )}
				</if>
			</td>
			<td class='short'>
				{$item['quantity']}
			</td>
			<td>
				{$this->lang->formatMoney( $invoice->getLinePrice( $k ) )}
			</td>
		</tr>
	</foreach>
	<if test="discountOrTax:|:$invoice->discount or $tax">
		<tr style='font-weight: bold'>
			<td style='text-align: right' colspan='4'>{$this->lang->words['store_subtotal']}</td>
			<td>{$this->lang->formatMoney( $subtotal )}</td>
		</tr>
		<if test="discount:|:$invoice->discount">
			<tr style='font-weight: bold'>
				<td style='text-align: right' colspan='4'>{$invoice->discount}% {$this->lang->words['store_bundle_discount']}</td>
				<td>{$this->lang->formatMoney( - ( $subtotal - $invoice->total - $tax ) )}</td>
			</tr>
		</if>
		<if test="tax:|:$tax">
			<tr style='font-weight: bold'>
				<td style='text-align: right' colspan='4'>{$this->lang->words['store_tax']}</td>
				<td>{$this->lang->formatMoney( $tax )}</td>
			</tr>
		</if>
	</if>
	<tr style='font-weight: bold'>
		<td style='text-align: right' colspan='4'>{$this->lang->words['store_total']}</td>
		<td><strong>{$this->lang->formatMoney( $invoice->total )}</strong></td>
	</tr>
</table>
<br />]]></template_content>
      <template_name>genericInvoiceTable</template_name>
      <template_data>$invoice, $cfields, $subtotal, $tax</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['purchase_id']}</td>
		<td style='font-weight:bold'>{$this->lang->words['purchase_name']}</td>
		<td style='font-weight:bold'>{$this->lang->words['purchase_expire']}</td>
		<td style='font-weight:bold'>{$this->lang->words['purchase_renewals']}</td>
	</tr>
	<foreach loop="purchases:$purchases as $purchase">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>{$purchase['ps_id']}</td>
			<td>{$purchase['ps_name']}</td>
			<td>{parse date="$purchase['ps_expire']" format="JOINED"}</td>
			<td>{$purchase['renewal']}</td>
		</tr>
	</foreach>
</table>
<br />]]></template_content>
      <template_name>genericPurchasesTable</template_name>
      <template_data>$purchases</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<div style='margin-top: 10px; font-size: 2em'>
	<#AMOUNT#> {$this->lang->words['gift_voucher']}
</div>
<br />
<br />
<if test="message:|:$data['message']">
	<div style="background: #ebf0f3; padding: 10px;">
		<#RECIPIENT#>
		<#MESSAGE#>
		<#SENDER#>
	</div>
	<br /><br />
</if>
<strong>
	{$this->lang->words['gv_redeem_code']}:<br />
	<#CODE#><br />
	<br />
	<a href='<#LINK#>'>{$this->lang->words['gv_redeem_now']}</a>
</strong>]]></template_content>
      <template_name>giftVoucher</template_name>
      <template_data>$purchase, $data</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_invoice_warn']}.<br />
<br />
<br />
<#PURCHASES_TABLE#>
<br />
{$this->lang->words['ne_invoice_warn_explain']}<br />
<#INVOICE_DATE#><br />
<br />
{$this->lang->words['ne_invoice_warn_check']}<br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>invoice_warn</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_new_invoice']}.<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<a href='<#LINK#>'>{$this->lang->words['ne_login_for_payment']}</a>
<br />
{$this->lang->words['ne_note_expiry_dates']}<br />
<br />]]></template_content>
      <template_name>new_invoice</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_failed']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}</a> {$this->lang->words['or']} <a href='<#LINK#>'>{$this->lang->words['ne_login_for_other_payment']}</a>.<br />
<br />]]></template_content>
      <template_name>payment_failed</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_held']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
{$this->lang->words['ne_additional_approved']}<br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>payment_held</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_received']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
<#SHIP#><br />
<br />]]></template_content>
      <template_name>payment_received</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_payment_refunded']}<br />
<br />
<br />
<#INVOICE_TABLE#>
<br />
<#TRANSACTION#><br />
<br />
{$this->lang->words['ne_refund_explain']}<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}</a> {$this->lang->words['or']} <a href='<#LINK#>'>{$this->lang->words['ne_login_for_other_payment']}</a>.<br />
<br />]]></template_content>
      <template_name>payment_refunded</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_order_thanks']}<br />
<br />
<#INSTRUCTIONS_HTML#>
<br />
<br />
<#INVOICE_TABLE#>
<br />
<a href='<#LINK#>'>{$this->lang->words['ne_login_for_payment']}</a>
<br />
{$this->lang->words['ne_additional_confirm']}<br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>payment_waiting</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_support_reply']}<br />
<br />
<div style="background: #ebf0f3; padding: 10px;">
	<#MESSAGE#>
</div>
<br />
<br />
<#REPLY_NOTIFY#>]]></template_content>
      <template_name>reply</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_ship_canc_notification']}<br />
<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['item']}</td>
		<td style='font-weight:bold'>&nbsp;</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
	</tr>
	<foreach loop="items:$items as $item">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>{$item['itemName']}</td>
			<td>
				<if test="cfields:|:is_array( $item['cfields'] )">
					<foreach loop="cfields:$item['cfields'] as $id => $value">
						{$cfields[ $id ]['cf_name']}: {$value}<br />
					</foreach>
				</if>
			</td>
			<td>{$item['quantity']}</td>
		</tr>
	</foreach>
</table>
<br />
<br />
<#SHIP_METHOD#><br />
{$address['first_name']} {$address['last_name']}<br />
{$address['address_1']}<br />
<if test="addressLine2:|:$address['address_2']">
	{$address['address_2']}<br />
</if>
{$address['city']}<br />
<if test="addressState:|:$address['state']">
	{$address['state']}<br />
</if>
{$address['zip']}<br />
<br />
<br />
<#TRACKING#><br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>shipping_canceled</template_name>
      <template_data>$items, $cfields, $address</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_ship_notification']}<br />
<br />
<table class='ipb_table' style="border-bottom: 1px solid #f3f3f3;">
	<tr style="border-bottom: 1px solid #f3f3f3;">
		<td style='font-weight:bold'>{$this->lang->words['item']}</td>
		<td style='font-weight:bold'>&nbsp;</td>
		<td style='font-weight:bold'>{$this->lang->words['cart_qty']}</td>
	</tr>
	<foreach loop="items:$items as $item">
		<tr style="border-bottom: 1px solid #f3f3f3;">
			<td>{$item['itemName']}</td>
			<td>
				<if test="cfields:|:is_array( $item['cfields'] )">
					<foreach loop="cfields:$item['cfields'] as $id => $value">
						{$cfields[ $id ]['cf_name']}: {$value}<br />
					</foreach>
				</if>
			</td>
			<td>{$item['quantity']}</td>
		</tr>
	</foreach>
</table>
<br />
<br />
<#SHIP_METHOD#><br />
{$address['first_name']} {$address['last_name']}<br />
{$address['address_1']}<br />
<if test="addressLine2:|:$address['address_2']">
	{$address['address_2']}<br />
</if>
{$address['city']}<br />
<if test="addressState:|:$address['state']">
	{$address['state']}<br />
</if>
{$address['zip']}<br />
<br />
<br />
<#TRACKING#><br />
<br />
<a href='<#SUPPORT_LINK#>'>{$this->lang->words['ne_contact']}.</a><br />
<br />]]></template_content>
      <template_name>shipping_notification</template_name>
      <template_data>$items, $cfields, $address</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#STAFF_NAME#>,<br />
<br />
{$this->lang->words['ne_support_staff']}<br />
<br />
<strong><#TITLE#></strong><br />
<br />
<#POSTER#>:<br />
<div style="background: #ebf0f3; padding: 10px;">
	<#MESSAGE#>
</div>
<br />
<br />
<#REPLY_NOTIFY#>]]></template_content>
      <template_name>staff_notify</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_emails</template_group>
      <template_content><![CDATA[<#CUSTOMER_NAME#>,<br />
<br />
{$this->lang->words['ne_support_new']}<br />
<br />
<strong><a href='<#LINK#>'><#TITLE#></a></strong><br />
<br />
<div style="background: #ebf0f3; padding: 10px;">
	<#MESSAGE#>
</div>
<br />
<br />
<#REPLY_NOTIFY#>]]></template_content>
      <template_name>support</template_name>
      <template_data/>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_nexus_payments">
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="inAcp:|:IN_ACP">
	<style type='text/css'>
.swfupload {
	position: absolute;
	z-index: 1;
}
	
#attachments { }
	#attachments li {
		background-color: #e4ebf2;
		border: 1px solid #d5dde5;
		padding: 6px 20px 6px 42px;
		margin-bottom: 10px;
		position: relative;
	}
	
		#attachments li p.info {
			color: #69727b;
			font-size: 0.8em;
			width: 300px;
		}
	
		#attachments li .links, #attachments li.error .links, #attachments.traditional .progress_bar {
			display: none;
		}
			
			#attachments li.complete .links {
				font-size: 0.9em;
				margin-right: 15px;
				right: 0px;
				top: 12px;
				display: block;
				position: absolute;
			}
			
		#attachments li .progress_bar {
			margin-right: 15px;
			width: 200px;
			right: 0px;
			top: 15px;
			position: absolute;
		}
	
		#attachments li.complete, #attachments li.in_progress, #attachments li.error {
			background-repeat: no-repeat;
			background-position: 12px 12px;
		}
	
		#attachments li.in_progress {
			background-image: url({$this->settings['public_dir']}style_images/master/loading.gif);
		}
	
		#attachments li.error {
			background-image: url({$this->settings['public_dir']}style_images/master/exclamation.png);
			background-color: #e8caca;
			border: 1px solid #ddafaf;
		}
		
			#attachments li.error .info {
				color: #8f2d2d;
			}
	
		#attachments li.complete {
			background-image: url({$this->settings['public_dir']}style_images/master/accept.png);
		}
		
		#attachments li .thumb_img {
			left: 6px;
			top: 6px;
			width: 30px;
			height: 30px;
			overflow: hidden;
			position: absolute;
		}
/*div.post_form fieldset.attachments span.desc {
	margin: 0 0 0 15px;
	display: inline;
	clear: none;
}*/
.attach_controls {
	background: url( {$this->settings['public_dir']}style_images/master/icon_attach.png ) no-repeat 3px;
	padding-left: 35px;
	min-height: 82px;
}
	.attach_controls .ipsType_subtitle { margin-bottom: 5px; }
	.attach_controls iframe { display: block; margin-bottom: 5px; }
	
.attach_button { font-weight: bold;  }
#help_msg {	margin-top: 8px; }
#attach_wrap {
	background: #eef3f8;
	padding: 6px;
	margin-top: 8px;
}
	#attach_wrap h4 {
		font-size: 1em;
		font-weight: bold;
	}
	
	#attach_wrap li {
		margin: 5px 6px;
		float: left;
	}
		
		#attach_wrap .desc.info {
			margin-left: 24px;
		}
		
.ipsButton_secondary {
	height: 22px;
	line-height: 22px;
	font-size: 12px;
	color: #7c7c7c;
	padding: 0 10px;
	background: #f6f6f6;
	background: -moz-linear-gradient(top, #f6f6f6 0%, #e5e5e5 100%); /* firefox */
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f6f6f6), color-stop(100%,#e5e5e5)); /* webkit */
	border: 1px solid #dbdbdb;
	-moz-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-webkit-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	color: #616161;
	display: inline-block;
	white-space: nowrap;
}
	.ipsButton_secondary:hover {
		color: #4c4c4c;
		border-color: #9a9a9a;
	}
	</style>
	
	<script type='text/javascript' src='{$this->settings['board_url']}/cache/lang_cache/{$this->lang->lang_id}/ipb.lang.js'></script>
	<script type='text/javascript'>
		var backup = ipb.vars['base_url'];
		ipb.vars['base_url']	= ipb.vars['front_url'];
		ipb.vars['upload_url']	= "{$this->settings['upload_url']}";
	</script>
	<if test="backup:|:$backup = $this->settings['base_url']">
		<if test="backup2:|:$this->settings['base_url'] = $this->settings['board_url'] . '/index.php?'"></if>
	</if>
</if>
<if test="attachButton:|:$this->lang->words['attach_button'] = $this->lang->words['nexus_attach_button']"></if>
<fieldset class='attachments'>
	{parse template="uploadForm" group="post" params="$data['post_key'], 'custom_pages', $data['stats'], 0"}
</fieldset>
<if test="inAcp2:|:IN_ACP">
	<script type='text/javascript'>
		//ipb.vars['base_url']	= backup;
	</script>
	<if test="backup3:|:$this->settings['base_url'] = $backup"></if>
</if>]]></template_content>
      <template_name>attachments</template_name>
      <template_data>$data=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<foreach loop="$hiddenFields as $k => $v">
	<input type='hidden' name='{$k}' value='{$v}' />
</foreach>
<ul class='payment_fields'>
	<li class='field'>
		<label for='x_card_num'>{$this->lang->words['checkout_card_number']}</label>
		<input type='text' name='x_card_num' id='x_card_num' class='input_text' />
		<br />
		<foreach loop="cardImages2:array( 'Visa', 'Mastercard', 'American Express', 'Discover', 'JCB', "Diners Club" ) as $t">
			<img src='{$this->settings['img_url']}/nexus/cards/{parse expression="str_replace( array( ' ', '/' ), '', strtolower($t) )"}.png' alt='{$t}' title='{$t}' />
		</foreach>
	</li>
	<li class='field'>
		<label for='x_exp_date'>{$this->lang->words['checkout_card_expire']}</label>
		<input type='text' name='x_exp_date' id='x_exp_date' class='input_text' size='6' /> (MM/YY)
	</li>
	<li class='field'>
		<label for='x_card_code'>{$this->lang->words['checkout_card_cvv2']}</label>
		<input type='text' name='x_card_code' id='x_card_code' size='3' class='input_text' /> <img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' />
		<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>
	</li>
</ul>
<script type='text/javascript'>
$('x_exp_date').defaultize( "MM/YY" );
</script>]]></template_content>
      <template_name>authNetDpm</template_name>
      <template_data>$hiddenFields</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="items:|:!empty( $cart['items'] )">
	<ul id='mini_cart' class='ipsPad'>
		<foreach loop="items:$cart['items'] as $item">
			<li class='item'>
				<span class='item_detail'>{$item['name']}<if test="moreThanOne:|:$item['qty'] > 1"> x{$item['qty']}</if></span>
				<span class='item_price'>{parse currency="$item['line_price']"}</span>
			</li>
		</foreach>
		<if test="discount:|:$cart['discount']">
			<li class='discount'>
				<span class='item_detail'>{$cart['discount']}% {$this->lang->words['store_bundle_discount']}</span>
				<span class='item_price'>{parse currency="$cart['difference']"}</span>
			</li>
		</if>
		<if test="noShowTax:|:!$this->settings['nexus_show_tax']">
			<li class='total subtotal'>
				<span class='item_detail'>{$this->lang->words['store_subtotal']}</span>
				<span class='item_price'>{parse currency="$cart['subtotal']"}</span>
			</li>
			<li class='total'>
				<span class='item_detail'>{$this->lang->words['store_tax']}</span>
				<span class='item_price'>{parse currency="$cart['tax']"}</span>
			</li>
		</if>
		<li class='total final'>
			<span class='item_detail'>{$this->lang->words['store_total']}</span>
			<span class='item_price'>{parse currency="$cart['total']"}</span>
		</li>
	</ul>
	<br />
	<p class='right'>
		<a href='{parse url="app=nexus&amp;module=payments&amp;do=view" base="public" template="storecart" seotitle="storecart"}' class='input_submit checkout'>{$this->lang->words['cart_view']}</a>
	</p>
	<br /><br />
<else />
	<p class='no_messages' style='text-align: center'>
		<em>{$this->lang->words['store_cart_empty']}</em>
	</p>
</if>]]></template_content>
      <template_name>cart_sidebar</template_name>
      <template_data>$cart=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<foreach loop="children:$curGroup['children'] as $groupID => $data">
	<li>
		<if test="noParent:|:$data['data']['pg_parent'] == 0">
			<img src='{$this->settings['img_url']}/folder.png' />
		</if> <a href='{parse url="app=nexus&amp;module=payments&amp;cat={$groupID}" base="public" template="storecat" seotitle="{$data['data']['pg_seo_name']}"}'>{$data['data']['pg_name']}</a>
		<if test="hasChildren:|:$data['children'] and in_array( $data['data']['pg_id'], $hierarchy )">
			<ul style='padding: 6px;'>
				{parse template="cat_menu_item" group="nexus_payments" params="$data, $hierarchy"}
			</ul>
		</if>
	</li>
</foreach>]]></template_content>
      <template_name>cat_menu_item</template_name>
      <template_data>$curGroup, $hierarchy</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<php>
	// Adjust author name as needed
	if( !$r['author']['member_id'] ){
		$r['author']['members_display_name']	= $r['author']['comment_author_name'];
	}
</php>
<if test="canEditNoPost:|:!$this->hasEditJs AND $r['comment']['_canEdit']">
	{parse template="getEditJs" group="global_comments" params=""}
</if>
<a id='comment_{$r['comment']['comment_id']}'></a>
<div data-commentid='{$r['comment']['comment_id']}' class='ipsComment ipsBox_container'>
	<div data-commentid='{$r['comment']['comment_id']}' class='<if test="commentQueued:|:!$r['comment']['comment_approved'] or $r['comment']['comment_approved'] == -1">moderated</if>' id='comment_id_{$r['comment']['comment_id']}'>
		<div id='comment_{$r['comment']['comment_id']}' class='ipsPad clearfix'>
			
			<foreach loop="ratingRange:range( 1, 5 ) as $i">
				<if test="commentRating:|:$r['comment']['review_rating'] >= $i">
					{parse replacement="rate_on"}
				<else />
					{parse replacement="rate_off"}
				</if>
			</foreach>
			by <a class='ipsUserPhotoLink' href='{parse url="showuser={$r['author']['member_id']}" template="showuser" seotitle="{$r['author']['members_seo_name']}" base="public"}'>{parse template="userHoverCard" group="global" params="$r['author']"}</a> <a rel='bookmark' class='desc lighter ipsType_smaller' href='{parse url="app=core&amp;module=global&amp;section=comments&amp;do=findComment&amp;comment_id={$r['comment']['comment_id']}&amp;parentId={$parent['parent_id']}&amp;fromApp=nexus-products" base="public"}' title='{$this->lang->words['comment_permalink']}'>{parse date="$r['comment']['comment_date']" format="short"}</a>
			
			<ul class='ipsComment_controls ipsList_inline ipsType_smaller right'>
				<if test="moderateCheckbox:|:$parent['_canModerate']">
					<li class='right'>&nbsp;&nbsp;<input class="ipsComment_mod" type='checkbox' name='' id='mod_comment_id_{$r['comment']['comment_id']}' data-status='{$r['comment']['comment_approved']}' /></li>
				</if>
				<if test="canEdit:|:$r['comment']['_canEdit']">
					<li>
						<a href="{parse url="{$settings['baseUrl']}&amp;do=showEdit&amp;comment_id={$r['comment']['comment_id']}" base="public"}" id='edit_comment_{$r['comment']['comment_id']}' class='edit_comment'>{$this->lang->words['edit_link']}</a>
					</li>
				</if>
				<if test="canHide:|:$r['comment']['comment_approved'] == 1 and $r['comment']['_canHide']">
					<li><a href='{parse url="{$settings['baseUrl']}&amp;do=hide&amp;comment_id={$r['comment']['comment_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['hide_link']}' id='hide_comment_{$r['comment']['comment_id']}'>{$this->lang->words['hide_link']}</a></li>
				</if>
				<if test="canUnhide:|:$r['comment']['comment_approved'] == -1 and $r['comment']['_canUnhide']">
					<li><a href='{parse url="{$settings['baseUrl']}&amp;do=unhide&amp;comment_id={$r['comment']['comment_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['unhide_link']}'>{$this->lang->words['unhide_link']}</a></li>
				</if>
				<if test="canApprove:|:$r['comment']['comment_approved'] == 0 and $r['comment']['_canApprove']">
					<li><a href='{parse url="{$settings['baseUrl']}&amp;do=approve&amp;comment_id={$r['comment']['comment_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' title='{$this->lang->words['approve_link']}'>{$this->lang->words['approve_link']}</a></li>
				</if>
				<if test="canDelete:|:$r['comment']['_canDelete']">
					<li>
						<a href='{parse url="{$settings['baseUrl']}&amp;do=delete&amp;comment_id={$r['comment']['comment_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' id='delete_comment_{$r['comment']['comment_id']}' class='delete_comment' title='{$this->lang->words['delete_comment']}'>{$this->lang->words['delete_link']}</a>
					</li>
				</if>
				<if test="hasReport:|:$r['comment']['urls-report']">
					<li>
						<a href="{parse url="{$r['comment']['urls-report']}&amp;st={$this->request['st']}" base="public"}">{$this->lang->words['report_link']}</a>
					</li>
				</if>
			</ul>
			
			<br /><br />
										
			<div class='comment_content ipsPad'>{$r['comment']['comment_text']}</div>
			
			<br />
			
			<if test="votes:|:$r['comment']['review_votes']">
				{parse expression="sprintf( $this->lang->words['review_number_useful'], $r['comment']['review_useful'], $r['comment']['review_votes'] )"}
			</if>
			<if test="canRate:|:$this->memberData['member_id'] AND !in_array( $r['comment']['comment_id'], $parent['myRatings'] )">
				<span class='right' id='review-helpful-{$r['comment']['comment_id']}'>{$this->lang->words['review_helpful']} <a class='clickable' onclick='reviewRate( {$r['comment']['comment_id']}, 1 )'>{$this->lang->words['yes']}</a> &middot; <a class='clickable' onclick='reviewRate( {$r['comment']['comment_id']}, 0 )'>{$this->lang->words['no']}</a></span>
			</if>
			
		</div>
	</div>
</div>
<if test="commentinitignored:|:$r['comment']['_ignored'] || $r['comment']['_repignored']">
	<script type='text/javascript'>
		ipb.comments.setCommentHidden( {$r['comment']['comment_id']} );
	</script>
</if>]]></template_content>
      <template_name>comment</template_name>
      <template_data>$r, $parent, $settings</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="haveComments:|:!empty( $comments )">
<script type='text/javascript'>
	ipb.templates['comment_moderation'] = new Template("<div id='comment_moderate_box' class='ipsFloatingAction' style='display: none'><span class='desc'>{$this->lang->words['comment_action_count']} </span><select name='modOptions' class='input_select' id='commentModAction'><option value='approve'>{$this->lang->words['approve_x_comments']}</option><option value='unapprove'>{$this->lang->words['unapprove_x_comments']}</option><option value='delete'>{$this->lang->words['delete_x_comments']}</option></select>&nbsp;&nbsp;<input type='button' class='input_submit' id='submitModAction' value='{$this->lang->words['comments_act_go']}' /></div>");
	
	ipb.templates['comment_delete'] = new Template("<h3>{$this->lang->words['comm_confirm_delete']}</h3><div class='ipsPad ipsForm_center desc'>{$this->lang->words['comm_confirm_delete_desc']}<br /><br /><input type='button' class='input_submit' id='delPush' onclick='ipb.comments.deleteIt(event)' value='{$this->lang->words['del_comm_now']}' />");
</script>
{parse js_module="comments"}
<a id='commentsStart'></a>
<if test="comments_top:|:$pages">
	<div class='topic_controls'>
		{$pages}
	</div>
</if>
<div class='ipsComment_wrap' id='comment_wrap'>
	<foreach loop="comments:$comments as $id => $r">
		{parse template="comment" group="nexus_payments" params="$r, $parent, $settings"}
		<br />
	</foreach>
</div>
<if test="comments_bottom:|:$pages">
	<div class='topic_controls'>
		{$pages}
	</div>
</if>
<script type='text/javascript'>
	ipb.global.post_width			= 500;
	document.observe("dom:loaded", function(){
		ipb.comments.parentId = {parse expression="intval( $parent['parent_id'] )"};
		ipb.comments.setData( {parse expression="json_encode( $settings )"} );
	});
</script>
</if>]]></template_content>
      <template_name>commentsList</template_name>
      <template_data><![CDATA[$comments, $settings, $pages, $parent, $preReply='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<input id='pay_submit' type='<if test="$onclick">button<else />submit</if>' value='{$this->lang->words['checkout_confirm']}' class='input_submit' style='font-size: 14px' <if test="$onclick">onclick='{$onclick}'</if> /> &nbsp; {$this->lang->words['or']} &nbsp; <a href='{$this->settings['base_url']}app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>
<if test="doubleClick:|:$this->memberData['userAgentKey'] == 'explorer' AND $this->memberData['userAgentVersion'] < 10">
	<br /><br />
	{$this->lang->words['checkout_doubleclick']}
</if>]]></template_content>
      <template_name>confirmButton</template_name>
      <template_data><![CDATA[$invoice, $onclick='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="cardOnFile:|:$cardOnFile">
	<ul class='payment_fields'>
		<li class='field'>
			<label for='cardonfile'><input type='checkbox' name='cardonfile' id='cardonfile' onclick="if(this.checked){new Effect.BlindUp( $('full_options'), { duration: 0.4 } );new Effect.BlindUp( $('renew_options'), { duration: 0.4 } );}else{new Effect.BlindDown( $('full_options'), { duration: 0.4 } );new Effect.BlindDown( $('renew_options'), { duration: 0.4 } );}" checked='checked' /> {$this->lang->words['cc_onfile']} ({$cardOnFile})</label>
		</li>
		<if test="showReccuringCode:|:$showCodeFieldForRecurringPayments">
			<li class='field'>
				<label for='code'>{$this->lang->words['checkout_card_cvv2']}</label>
				<input type='text' <if test="$giveFieldElementsNameTags">name='card_code'</if> id='code' size='3' class='input_text' /> <img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' />
				<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>
			</li>
		</if>
	</ul>
	<ul class='payment_fields' id='full_options' style='display:none'>
<else />
	<ul class='payment_fields'>
</if>
	<if test="showTypeList:|:$showTypeList">
		<li class='field'>
			<label for='card_number'>{$this->lang->words['checkout_card_type']}</label>
			<select name='card_type' id='card_type' class='input_select'>
				<foreach loop="acceptedTypes:$acceptedTypes as $t">
					<if test="cardType:|:substr( $t, 0, 1 ) != '_'">
						<option value='{$t}'>{$t}</option>
					</if>
				</foreach>
			</select>
			<if test="showLogos:|:$showLogos">
				<foreach loop="cardImages:$acceptedTypes as $t">
					<img src='{$this->settings['img_url']}/nexus/cards/{parse expression="str_replace( array( ' ', '/' ), '', strtolower($t) )"}.png' alt='{$t}' title='{$t}' />
				</foreach>
			</if>
		</li>
	</if>
	<li class='field'>
		<label for='card_number'>{$this->lang->words['checkout_card_number']}</label>
		<input type='text' <if test="$giveFieldElementsNameTags">name='card_number'</if> id='card_number' class='input_text' />
		<br />
		<if test="acceptedTypes:|:!$showTypeList and $showLogos">
			<foreach loop="cardImages2:$acceptedTypes as $t">
				<img src='{$this->settings['img_url']}/nexus/cards/{parse expression="str_replace( array( ' ', '/' ), '', strtolower($t) )"}.png' alt='{$t}' title='{$t}' />
			</foreach>
		</if>
	</li>
	<if test="isUkCard:|:$isUkCard">
		<li class='field'>
			<label for='issue_number'>{$this->lang->words['checkout_card_issueno']}</label>
			<input type='text' <if test="$giveFieldElementsNameTags">name='issue_number'</if> id='issue_number' size='3' class='input_text' />
			<span class='desc'>{$this->lang->words['checkout_ukcards_blurb']}</span>
		</li>
		<li class='field'>
			<label for='start_month'>{$this->lang->words['checkout_card_start']}</label>
			<select <if test="giveFieldElementsNameTags">name='start_month'</if> id='start_month' class='input_select'>
				<option value='00'></option>
				<option value='01'>01</option>
				<option value='02'>02</option>
				<option value='03'>03</option>
				<option value='04'>04</option>
				<option value='05'>05</option>
				<option value='06'>06</option>
				<option value='07'>07</option>
				<option value='08'>08</option>
				<option value='09'>09</option>
				<option value='10'>10</option>
				<option value='11'>11</option>
				<option value='12'>12</option>
			</select>
			<select name='start_year' id='start_year' class='input_select'>
				<option value='0000'></option>
				<foreach loop="yearsStart:range( date('Y')-4, date('Y') ) as $y">
					<option value='$y'>$y</option>
				</foreach>
			</select>
			<span class='desc'>{$this->lang->words['checkout_ukcards_blurb']}</span>
		</li>
	</if>
	<li class='field'>
		<label for='exp_month'>{$this->lang->words['checkout_card_expire']}</label>
		<select <if test="giveFieldElementsNameTags">name='exp_month'</if> id='exp_month' class='input_select'>
			<option value='01'>01</option>
			<option value='02'>02</option>
			<option value='03'>03</option>
			<option value='04'>04</option>
			<option value='05'>05</option>
			<option value='06'>06</option>
			<option value='07'>07</option>
			<option value='08'>08</option>
			<option value='09'>09</option>
			<option value='10'>10</option>
			<option value='11'>11</option>
			<option value='12'>12</option>
		</select>
		<select name='exp_year' id='exp_year' class='input_select'>
			<foreach loop="yearsExp:range( date('Y'), date('Y')+10 ) as $y">
				<option value='$y'>$y</option>
			</foreach>
		</select>
	</li>
	<if test="showCode:|:!$cardOnFile or !$showCodeFieldForRecurringPayments">
		<li class='field'>
			<label for='code'>{$this->lang->words['checkout_card_cvv2']}</label>
			<input type='text' <if test="giveFieldElementsNameTags">name='card_code'</if> id='code' size='3' class='input_text' /> <img src='{$this->settings['img_url']}/nexus/cvv2.gif' alt='CVV2 Icon' />
			<span class='desc'>{$this->lang->words['checkout_cvv2_blurb']}</span>
		</li>
	</if>
</ul>
<if test="cardOnFile2:|:$cardOnFile">
	<ul class='payment_fields' id='renew_options' style='display:none'>
<else />
	<ul class='payment_fields'>
</if>
	<if test="recurring:|:$recurring">
		<li class='field'>
			<label for='recurring'><input type='checkbox' name='recurring' id='recurring' /> {$this->lang->words[ $recurr_message ]}</label>
		</li>
	</if>
</ul>
<br />
<span class='error' id='error_message_holder'></span>]]></template_content>
      <template_name>creditCardPayments</template_name>
      <template_data><![CDATA[$transid, $methodid, $recurring, $acceptedTypes=array(), $showTypeList=FALSE, $isUkCard=FALSE, $showLogos=TRUE, $cardOnFile=NULL, $recurr_message='cc_ac', $giveFieldElementsNameTags=TRUE, $showCodeFieldForRecurringPayments=TRUE]]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse striping="donations" classes="row1,row2 altrow"}
<div class='ipsSideBlock clearfix'>
	<h3>{$this->lang->words['donations']}</h3>
	<div class='_sbcollapsable'>
		<ul>
			<foreach loop="goals:$goals as $goal">
				<li>
					<if test="goalCheck:|:!$goal['d_goal'] or $goal['d_current'] < $goal['d_goal']">
						<a href='{parse url="app=nexus&amp;module=payments&amp;section=donate" base="public"}' id='donate_button_{$goal['d_id']}' class='ipsButton_secondary right'>{$this->lang->words['donations_donate']}</a>
					</if>
					<h4 class='ipsType_sectiontitle'>{$goal['d_name']}</h4>
					<!--<p class='desc'>{$goal['d_desc']}</p>-->
					<div style='margin-top: 8px;'>
						<if test="goal:|:$goal['d_goal']">
						
								<table>
									<tr>
										<if test="gotSomething:|:$goal['percent'] > 0">
											<td width='{$goal['percent']}%' style='background-color:#225985' nowrap='nowrap'></td>
										</if>
										<if test="gotEverything:|:$goal['left'] > 0">
											<td width='{$goal['left']}%' style='background-color:#d8dde8' nowrap='nowrap'></td>
										</if>
									</tr>
								</table>
								<p class='desc ipsType_smaller' style='margin-top: 4px'>{parse expression="sprintf( $this->lang->words['donations_progress'], "{parse currency="$goal['d_current']"}", "{parse currency="$goal['d_goal']"}" )"}</p>
						</if>
					</div>
					<if test="goalCheck:|:!$goal['d_goal'] or $goal['d_current'] < $goal['d_goal']">
						<div id='donate_sidebar_{$goal['d_id']}' style='display: none'>
							<form action='{parse url="app=nexus&amp;module=payments&amp;section=donate" base="public"}' class='ipsPad' method='post'>
								<input type='hidden' name='goal' value='{$goal['d_id']}' />
								{$this->lang->words['donations_donate_enter']} <input name='amount' class='input_text' size='5' /> <input type='submit' class='input_submit' value='{$this->lang->words['donations_donate']}' />
							</form>
						</div>
						
						<script type='text/javascript'>
							if( $('donate_button_{$goal['d_id']}') ){
								$('donate_button_{$goal['d_id']}').on('click', function(e){
									Event.stop(e);
									new ipb.Popup( 'donate_{$goal['d_id']}', { type: 'balloon',
															 initial: $('donate_sidebar_{$goal['d_id']}').show(),
															 stem: true,
															 hideAtStart: false,
															 hideClose: true,
															 attach: { target: $('donate_button_{$goal['d_id']}'), position: 'auto' },
															 w: '250px' });
								});
							}
						</script>
					</if>
				</li>
			</foreach>
		</ul>
	</div>
</div>]]></template_content>
      <template_name>donationsSidebar</template_name>
      <template_data>$goals</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
</script>
{parse template="orderProgress" group="nexus_payments" params="2, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<h1 class='ipsType_pagetitle'>{$this->lang->words['personal_info']}</h1>
<br />
<div class='ipsBox'>
	<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=details" base="{$this->settings['nexus_https']}"}' method='post'>
		<input type='hidden' name='id' value='{$invoice->id}' />
		<input type='hidden' name='taxable' value='{$taxable}' />
		<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
		<div class='ipsBox_container ipsPad'>
			<ul class='ipsForm ipsForm_horizontal'>
				<foreach loop="fields:$fields as $f">
					<if test="isAddressOrPhone:|:in_array( $f['f_column'], array( 'cm_address_1', 'cm_phone' ) )">
						<br />
					</if>
					<if test="isText:|:$f['f_type'] == 'text'">
						<li class='ipsField clearfix'>
							<label for='{$f['f_column']}' class='ipsField_title'>
								<if test="isAddress1:|:$f['f_column'] == 'cm_address_1'">
									{$this->lang->words['cm_address']}
								<else />
									<if test="isAddress2:|:$f['f_column'] == 'cm_address_2'">
										&nbsp;
									<else />
										{$f['f_name']}
									</if>
								</if>
								<if test="loopPurchaseRequired:|:$f['f_purchase_require']">
									&nbsp;<span class='ipsForm_required'>*</span>
								</if>
							</label>
							<p class='ipsField_content'>
								<input type='text' id='{$f['f_column']}' name='{$f['f_column']}' maxlength='255' value='{$member[ $f['f_column'] ]}' class='input_text' />
								<if test="textError:|:in_array( $f['f_column'], $errors )">
									<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
								</if>
							</p>
						</li>
					</if>
					<if test="isDropdown:|:$f['f_type'] == 'dropdown'">
						<li class='ipsField ipsField_select clearfix'>
							<label for='{$f['f_column']}' class='ipsField_title'>
								{$f['f_name']}
								<if test="fieldIsRequired:|:$f['f_purchase_require']">
									&nbsp;<span class='ipsForm_required'>*</span>
								</if>
							</label>
							<div class='ipsField_content'>
								<select name='{$f['f_column']}' id='{$f['f_column']}' <if test="isCountry:|:$f['f_column'] == 'cm_country'">onchange='states()'</if>>
									<foreach loop="options:explode( "\n", $f['f_extra'] ) as $k => $v">
										{parse variable="selected" default="" oncondition="$v == $member[ $f['f_column'] ] or $k == $member[ $f['f_column'] ]" value=" selected='selected'"}
										<option value='<if test="isCountrySelect:|:$f['f_column'] == 'cm_country'">{$v}<else />{$k}</if>'{parse variable="selected"}><if test="isCountryWords:|:$f['f_column'] == 'cm_country'">{$this->lang->words['nc_'.$v]}<else />{$v}</if></option>
									</foreach>
								</select>
								<if test="dropdownError:|:in_array( $f['f_column'], $errors )">
									<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
								</if>
							</div>
						</li>
					</if>
					<if test="isSpecial:|:$f['f_type'] == 'special'">
						<li class='ipsField clearfix'>
							<label for='cm_state' class='ipsField_title'>
								{$this->lang->words['cm_state']}
								<if test="purchaseRequiresState:|:$f['f_purchase_require']">
									<span class='ipsForm_required'>&nbsp;*</span><span id='state-required'></span>
								<else />
									<span class='ipsForm_required' id='state-required' style='display:none'>&nbsp;*</span>
								</if>
							</label>
							<div class='ipsField_content'>
								<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$member['cm_state']}' />
								<foreach loop="statesCountries:$states as $country => $_states">
									<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
										<foreach loop="states:$_states as $s">
											{parse variable="selected" default="" oncondition="$s[0] == $member['cm_state']" value=" selected='selected'"}
											<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
										</foreach>
									</select>
								</foreach>
								<if test="specialError:|:in_array( $f['f_column'], $errors )">
									<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
								</if>
							</div>
						</li>
					</if>
				</foreach>
			</ul>
		</div>
		<fieldset class='submit'>
			<input type='submit' value='{$this->lang->words['checkout_continue']}' class='input_submit' />&nbsp;&nbsp; {$this->lang->words['or']} <a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>
		</fieldset>
	</form>
</div>
<script type='text/javascript'>
	function states()
	{
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'inline';
			
			_display = c + '-states';
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'none';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
	
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
</script>]]></template_content>
      <template_name>enterDetails</template_name>
      <template_data>$errors, $fields, $states, $member, $taxable, $invoice, $maxStep</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.nexus.checkout.js'></script>
{parse template="orderProgress" group="nexus_payments" params="4, 4, $invoice->getOrderProgress(), $invoice->id"}
<div class='ipsPad row2 altrow'>
	<div class='block_inner pad'>
		{$button}
	</div>
</div>]]></template_content>
      <template_name>extraStep</template_name>
      <template_data>$invoice, $button</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$this->lang->words['gv_buy']}</h1>
<br />
<form action="{parse url="app=nexus&amp;module=payments&amp;do=do_vouchers" base="public"}" method="post">
	<div class='ipsBox'>
		<div class='ipsBox_container ipsPad clearfix'>
			<ul class='ipsForm ipsForm_vertical'>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['gv_amount']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<foreach loop="options:$options as $o">
							<label for='amount_{$o}' <if test="showAnyAmount:|:$o == '*'">onclick="$('gv_other').style.display=''"<else />onclick="$('gv_other').style.display='none'"</if>>
								<if test="anyAmount:|:$o == '*'">
									<input id='amount_{$o}' type='radio' name='amount' value='$o' style='margin-bottom: 6px' <if test="isChecked:|:( isset( $this->request['amount'] ) and $this->request['amount'] == $o ) or count( $options ) == 1">checked='checked'</if> /> {$this->lang->words['gv_other']}
								<else />
									<input id='amount_{$o}' type='radio' name='amount' value='$o' style='margin-bottom: 6px' <if test="isChecked2:|:( isset( $this->request['amount'] ) and $this->request['amount'] == $o ) or count( $options ) == 1">checked='checked'</if> /> {parse currency="$o"}
								</if>
								<br />
							</label>
						</foreach>
						<div id='gv_other' <if test="options:|:count( $options ) > 1 or !in_array( '*', $options )">style='display:none'</if>>
							<input class='input_text' name='other_amount' size=='3' value='{$this->request['other_amount']}' /> {$this->settings['nexus_currency']}
						</div>
						<if test="errors:|:isset( $errors['amount'] )">
							<span class='error'>{$errors['amount']}</span>
						</if>
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['gv_method']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<label for='method_email' onclick="$('gv_recipient_email' ).style.display=''"><input id='method_email' type='radio' name='method' value='email' style='margin-bottom: 6px' <if test="method:|:isset( $this->request['method'] ) and $this->request['method'] == 'email'">checked='checked'</if> /> {$this->lang->words['gv_email']}</label><br />
						<label for='method_print' onclick="$('gv_recipient_email' ).style.display='none'"><input id='method_print' type='radio' name='method' value='print' style='margin-bottom: 6px' <if test="method2:|:isset( $this->request['method'] ) and $this->request['method'] == 'print'">checked='checked'</if> /> {$this->lang->words['gv_print']}</label><br />
						<if test="errors2:|:isset( $errors['method'] )">
							<span class='error'>{$errors['method']}</span>
						</if>
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['gv_recipient_name']}</label>
					<div class='ipsField_content'>
						<input class='input_text' name='recipient_name' value='{$this->request['recipient_name']}' />
					</div>
				</li>
				<li class='ipsField' id='gv_recipient_email' <if test="methodIsNotEmail:|:!isset( $this->request['method'] ) or $this->request['method'] != 'email'">style='display:none'</if>>
					<label class='ipsField_title'>{$this->lang->words['gv_recipient_email']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<input class='input_text' name='gv_recipient_email' value='{$this->request['gv_recipient_email']}' />
						<if test="recError:|:isset( $errors['gv_recipient_email'] )">
							<br />
							<span class='error'>{$errors['gv_recipient_email']}</span>
						</if>
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['gv_sender']}</label>
					<div class='ipsField_content'>
						<input class='input_text' name='sender' value='<if test="sender:|:isset( $this->request['sender'] )">{$this->request['sender']}<else />{$this->memberData['members_display_name']}</if>' />
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['gv_message']}</label>
					<div class='ipsField_content'>
						{parse editor="message" content="$messageContent" options="array()"}
					</div>
				</li>
			</ul>
		</div>
	</div>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['gv_buy']}' class='input_submit' />
	</fieldset>
</form>]]></template_content>
      <template_name>giftVouchers</template_name>
      <template_data><![CDATA[$options, $errors=array(), $messageContent='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<input type='hidden' name='serverToUse' value='{$serverToUse['server_id']}' />
<ul>
	<li class='field'>
		<strong>{$this->lang->words['hosting_domain']}</strong>
		<if test="subDomains:|:!empty( $subDomainOptions )">
			<label for='domain_option_subdomain' style='padding: 7px'><input name='domain_option' id='domain_option_subdomain' type='radio' class='input_radio' value='subdomain' onchange='changeOption()' /> {$this->lang->words['hosting_domain_subdomain']}</label>
		</if>
		<if test="purchaseDomain:|:!empty( $tldOptions )">
			<label for='domain_option_buy' style='padding: 5px'><input name='domain_option' id='domain_option_buy' type='radio' class='input_radio' value='buy' onchange='changeOption()' /> {$this->lang->words['hosting_domain_buy']}</label>
		</if>
		<if test="ownDomain:|:$serverToUse['server_nameservers']">
			<label for='domain_option_own' style='padding: 5px'><input name='domain_option' id='domain_option_own' type='radio' class='input_radio' value='own' onchange='changeOption()' /> {$this->lang->words['hosting_domain_own']}</label>
		</if>
	</li>
	<li class='field' id='options_subdomain' style='display:none'>
		http:// <input name='suburl' id='url' type='text' class='input_text' size='40' />
		<if test="justOne:|:count( $subDomainOptions ) == 1">
			<foreach loop="subDomainsOptions:$subDomainOptions as $v">
				<input type='hidden' name='domain' value='{$v}' />
				.{$v}
			</foreach>
		<else />
			. <select name='domain' id='domain' class='input_select'>
				<foreach loop="subDomainOptions2:$subDomainOptions as $v">
					<option value='{$v}'>{$v}</option>
				</foreach>
			</select>
		</if>
		
	</li>
	<li class='field' id='options_own' style='display:none'>
		http:// <input name='url' id='url' type='text' class='input_text' size='40' />
		<p class='message user_status' style='margin-top:10px'>
			{$this->lang->words['hosting_nameservers']}<br />
			{parse expression="str_replace("\n", '<br />', $serverToUse['server_nameservers'])"}
		</p>
	</li>
	<li class='field' id='options_buy' style='display:none'>
		http:// <input name='sld' id='sld' type='text' class='input_text' size='40' />
		<select name='tld'>
			<foreach loop="tldOptions:$tldOptions as $o">
				<option value='{$o[0]}'>{$o[1]}</option>
			</foreach>
		</select>
	</li>
</ul>
<br />
	
<script type='text/javascript'>
	function changeOption( id )
	{
		if ( $('options_subdomain') !== null )
		{
			$('options_subdomain').style.display = 'none';
		}
		
		if ( $('options_own') !== null )
		{
			$('options_own').style.display = 'none';
		}
		
		if ( $('options_buy') !== null )
		{
			$('options_buy').style.display = 'none';
		}
		
		if( $('domain_option_subdomain') !== null && $('domain_option_subdomain').checked )
		{
			new Effect.BlindDown( $('options_subdomain' ), { duration: 0.4 } );
		}
		else if ( $('domain_option_own') !== null && $('domain_option_own').checked )
		{
			new Effect.BlindDown( $('options_own' ), { duration: 0.4 } );
		}
		else if ( $('domain_option_buy') !== null && $('domain_option_buy').checked )
		{
			new Effect.BlindDown( $('options_buy' ), { duration: 0.4 } );
		}
	}
</script>]]></template_content>
      <template_name>hostingForm</template_name>
      <template_data>$subDomainOptions, $serverToUse, $tldOptions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse js_module="register"}
<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
	ipb.register.inSection = "mainform";
</script>
{parse template="orderProgress" group="nexus_payments" params="1, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<h2 class='maintitle'>{$this->lang->words['checkout_account']}</h2>
<div class='ipsBox' id='account_info'>
	<if test="errors:|:empty($errors)">
		<p class='message'><a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=login&amp;id={$invoice->id}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['checkout_login']}</a></p>
		<br />
	</if>
	<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=register" base="{$this->settings['nexus_https']}"}' method='post'>
		<div class='ipsBox_container ipsPad'>
			<input type='hidden' name='id' value='{$invoice->id}' />
			<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
			<h3 class='ipsType_sectiontitle'>{$this->lang->words['checkout_account']}</h3>
			<br />
			<ul class='ipsForm ipsForm_horizontal'>
				<if test="username:|:$this->settings['nexus_checkreg_usernames']">
					<li class='ipsField'>
						<label class='ipsField_title' for='username'>{$this->lang->words['reg_choose_user']} <span class='ipsForm_required'>*</span></label>
						<div class='ipsField_content'>
							<input type='text' id='username' name='username' value='{$member['username']}' class='input_text email' />
							<if test="errorsUsername:|:$errors['username']"><br /><span class='error'>{$errors['username']}</span></if>
							<br /><span class='desc'>{$this->lang->words['char_cant_use']}</em></span>
						</div>
					</li>
				</if>
				<li class='ipsField'>
					<label class='ipsField_title' for='email'>{$this->lang->words['cm_email']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<input type='text' id='email' name='email' value='{$member['email']}' class='input_text email' />
						<if test="errorsEmail:|:$errors['email']"><br /><span class='error'>{$errors['email']}</span></if>
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title' for='password1'>{$this->lang->words['cm_password']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<input type='password' id='password1' name='password1' class='input_text password' value='{$member['password1']}' />
						<if test="errorsPassword1:|:$errors['password1']"><br /><span class='error'>{$errors['password1']}</span></if>
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title' for='password2'>{$this->lang->words['cm_password_confirm']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<input type='password' id='password2' name='password2' class='input_text password' value='{$member['password2']}' />
						<if test="errorsPassword2:|:$errors['password2']"><br /><span class='error'>{$errors['password2']}</span></if>
					</div>
				</li>
				<li class='ipsField ipsField_checkbox'>
					<input type='checkbox' class="input_check" name='receive_admin_emails' id='receive_admin_emails' checked='checked' value='1' />
					<p class='ipsField_content'>
						{$this->lang->words['receive_admin_emails']}
					</p>
				</li>
				<li class='ipsField clear ipsField_checkbox'>
					<input type='checkbox' name='agree_tos' id='agree_tos' value='1' class='input_check' <if test="checkedTOS:|:$this->request['agree_tos']">checked="checked"</if> tabindex='50' />
					<p class='ipsField_content'>
						<label for='agree_tos'>
							<strong>{$this->lang->words['agree_to_tos']} <a href='#' id='tou_link'>{$this->lang->words['terms_of_use']}</a></strong>
							<if test="ieTOS:|:$errors['tos']"><br /><span class='error'>{$errors['tos']}</span></if>
						</label>
						<textarea id='tou' class='input_text' style='width: 350px; height: 100px; display: block;'>
							{$this->settings['_termsAndConditions']}
						</textarea>
					</p>
					<script type='text/javascript'>
						$('tou').hide();
						ipb.templates['registration_terms'] = new Template("<h3>{$this->lang->words['reg_terms_popup_title']}</h3><div class='ipsPad' id='tou_popup'>#{content}</div>");
					</script>
				</li>
				<if test="privvy:|:$this->settings['priv_title']">
					<li class='ipsPad_top ipsForm_center desc ipsType_smaller'>
						<a rel="nofollow" href='{parse url="app=core&amp;module=global&amp;section=privacy" template="privacy" seotitle="false" base="public"}'>{$this->settings['priv_title']}</a>
					</li>
				</if>
			</ul>
			<br /><br />
			<if test="fields:|:!empty( $fields )">
				<h3 class='ipsType_sectiontitle'>{$this->lang->words['personal_info']}</h3>
				<br />
				<ul class='ipsForm ipsForm_horizontal'>
					<foreach loop="fields:$fields as $f">
						<if test="isText:|:$f['f_type'] == 'text'">
							<li class='ipsField'>
								<label class='ipsField_title' for='{$f['f_column']}'><if test="isAddress1:|:$f['f_column'] == 'cm_address_1'">{$this->lang->words['cm_address']}<else /><if test="isAddress2:|:$f['f_column'] == 'cm_address_2'">&nbsp;<else />{$f['f_name']}</if></if> <if test="$f['f_reg_require'] or $f['f_purchase_require']"><span class='ipsForm_required'>*</span></if></label>
								<div class='ipsField_content'>
									<input type='text' id='{$f['f_column']}' name='{$f['f_column']}' maxlength='255' value='{$member[ $f['f_column'] ]}' class='input_text' />
									<if test="errorsText:|:$errors[ $f['f_column'] ]"><br /><span class='error'>{$errors[ $f['f_column'] ]}</span></if>
								</div>
							</li>
						</if>
						<if test="isDropdown:|:$f['f_type'] == 'dropdown'">
							<li class='ipsField ipsField_select'>
								<label class='ipsField_title' for='{$f['f_column']}'>{$f['f_name']} <if test="$f['f_reg_require'] or $f['f_purchase_require']"><span class='ipsForm_required'>*</span></if></label>
								<div class='ipsField_content'>
									<select name='{$f['f_column']}' id='{$f['f_column']}' <if test="isCountry:|:$f['f_column'] == 'cm_country'">onchange='states()'</if>>
									<foreach loop="options:explode( "\n", $f['f_extra'] ) as $k => $v">
										{parse variable="selected" default="" oncondition="$v == $member[ $f['f_column'] ] or $k == $member[ $f['f_column'] ]" value=" selected='selected'"}
										<option value='<if test="isCountrySelect:|:$f['f_column'] == 'cm_country'">{$v}<else />{$k}</if>'{parse variable="selected"}><if test="isCountryWords:|:$f['f_column'] == 'cm_country'">{$this->lang->words['nc_'.$v]}<else />{$v}</if></option>
									</foreach>
									</select>
									<if test="errorsCountry:|:$errors[ $f['f_column'] ]"><br /><span class='error'>{$errors[ $f['f_column'] ]}</span></if>
								</div>
							</li>
						</if>
						<if test="isSpecial:|:$f['f_type'] == 'special'">
							<li class='ipsField ipsField_select'>
								<label class='ipsField_title' for='cm_state'>
									{$this->lang->words['cm_state']}
									<if test="purchaseRequiresState:|:$f['f_purchase_require'] or $f['f_purchase_require']">
										<span class='ipsForm_required'>&nbsp;*</span><span id='state-required'></span>
									<else />
										<span class='ipsForm_required' id='state-required' style='display:none'>&nbsp;*</span>
									</if>
								</label>
								<div class='ipsField_content'>
									<input type='text' class='input_text' id='text-states' size='25' value='{$member['cm_state']}' />
									<foreach loop="statesCountries:$states as $country => $_states">
										<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
											<foreach loop="states:$_states as $s">
												{parse variable="selected" default="" oncondition="$s[0] == $member['cm_state']" value=" selected='selected'"}
												<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
											</foreach>
										</select>
									</foreach>
									<if test="errorsSpecial:|:$errors[ $f['f_column'] ]"><br /><span class='error'>{$errors[ $f['f_column'] ]}</span></if>
								</div>
							</li>
						</if>
					</foreach>
				</ul>
				<br /><br />
			</if>
			<if test="customProfileFields:|:!empty($customProfileFields)">
				<h3 class='ipsType_sectiontitle'>{$this->lang->words['checkout_cpf']}</h3>
				<br />
				<ul class='ipsForm ipsForm_horizontal'>
					<foreach loop="pfields:$customProfileFields as $_field">
						<li class='ipsField'>
							<label class='ipsField_title' for='cprofile_{$_field['id']}'>{$_field['name']} <if test="$_field['req']"><span class='ipsForm_required'>*</span></if></label>
							<div class='ipsField_content'>
								{$_field['field']}
								<if test="hasDesc:|:$_field['desc'] != ''"><br /><span class='desc'>{$_field['desc']}</span></if>
								<if test="errorsPfields:|:$errors['field_'.$_field['id']]"><br /><span class='error'>{$errors['field_'.$_field['id']]}</span></if>
							</div>
						</li>
					</foreach>
				</ul>
				<br /><br />
			</if>
			<if test="spamCheck:|:$captchaHTML or !empty($question)">
				<h3 class='ipsType_sectiontitle'>{$this->lang->words['checkout_captcha']}</h3>
				<br />
				<if test="errorsCaptcha:|:$errors['captcha']">
					<p class='message error'>{$errors['captcha']}</p>
					<br />
				</if>
				<ul class='ipsForm ipsForm_horizontal'>
					<if test="qAndA:|:!empty($question)">
						<li class='ipsField'>
							<label class='ipsField_title' for='qa_answer'>{$question['qa_question']}</label>
							<div class='ipsField_content'>
								<input type='text' name='qa_answer' id='qa_answer' value='' class='input_text' />
								<input type='hidden' name='qanda_id' value='{$question['qa_id']}' />
								<if test="errorsQAndA:|:$errors['qanda']"><br /><span class='error'>{$errors['qanda']}</span></if>
							</div>
						</li>
					</if>
					<if test="captcha:|:$captchaHTML">
						{$captchaHTML}
					</if>
				</if>
				<br /><br />
			</if>
		</div>
		<fieldset class='submit'>
			<input type='submit' value='{$this->lang->words['checkout_continue']}' class='input_submit' />&nbsp;&nbsp; {$this->lang->words['or']} <a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>
		</fieldset>
	</form>
</div>
<script type='text/javascript'>
	function states()
	{
		var s = $('text-states').value.toLowerCase();
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'inline';
			
			_display = c + '-states';
			$( c + '-states' ).select('option').each ( function ( elem ) {
				if ( elem.value.toLowerCase() == s || elem.innerHTML.toLowerCase() == s )
				{
					elem.selected = true;
				}
			} );
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'none';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
	
</script>]]></template_content>
      <template_name>loginOrRegister</template_name>
      <template_data>$errors, $fields, $states, $member, $invoice, $customProfileFields, $time_select, $captchaHTML, $question, $maxStep</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<div class='category_block block_wrap'>
	{parse template="subTabLoop" group="modcp" params=""}
	<if test="noResults:|:empty( $results )">
		<div class='no_messages'>{$this->lang->words['ur_none']}</div>
	<else />
		<table class='ipb_table'>
			<foreach loop="results:$results as $r">
				<tr>
					<td>
						<a href="{parse url="app=nexus&mpduke=payments&section=store&do=item&id={$r['p_id']}" base="public" template="showitem" seotitle="{$r['p_so_name']}"}" class='topic_title'>{$r['p_name']}</a><br />
						<foreach loop="ratingRange:range( 1, 5 ) as $i">
							<if test="ratingOn:|:$r['review_rating'] >= $i">
								{parse replacement="rate_on"}
							<else />
								{parse replacement="rate_off"}
							</if>
						</foreach> {$this->lang->words['by']} {parse template="userHoverCard" group="global" params="$r"}
						<br />
						<br />
						{$r['review_text']}
						<br />
					</td>
					<td style='min-width: 150px'>
						<ul class='ipsList_inline right'>
							<li>
								<a href='{parse url="app=core&module=modcp&fromapp=nexus&tab=unapprovedreviews&amp;do=approve&amp;id={$r['review_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' class='ipsButton_secondary ipsType_smaller'>{$this->lang->words['modcp_approvelink']}</a>
							</li>
							<li>
								<a href='{parse url="app=core&module=modcp&fromapp=nexus&tab=unapprovedreviews&amp;do=delete&amp;id={$r['review_id']}&amp;auth_key={$this->member->form_hash}" base="public"}' class='ipsButton_secondary ipsType_smaller important'>{$this->lang->words['modcp_deletelink']}</a>
							</li>
						</ul>
					</td>
				</tr>
			</foreach>
		</table>
	</if>
	</table>
</div>]]></template_content>
      <template_name>moderatorPanel</template_name>
      <template_data>$results</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<php>
	$this->templateVars['step_count'] = 1;
</php>
<div class='ipsSteps clearfix'>
	<ul>
		<foreach loop="step:$steps as $idx => $text">
			<li class="<if test="isCurrent:|:$idx == ( $this->request['step'] ? $this->request['step'] : $curStep )">ipsSteps_active<else /><if test="isDone:|:$idx < $maxStep">ipsSteps_done</if></if>" <if test="isClickable:|:$curStep != 4 and $idx != 0 and $idx <= $maxStep">onclick='window.location = "{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoiceId}&amp;step={$idx}" base="{$this->settings['nexus_https']}"}";' style='cursor:pointer'</if>>
				<strong class='ipsSteps_title'>{parse expression="sprintf($this->lang->words['public_step'], $this->templateVars['step_count'])"}</strong>
				<span class='ipsSteps_desc'>{$text}</span>
				<span class='ipsSteps_arrow'>&nbsp;</span>
				<!--Don't delete: {parse expression="$this->templateVars['step_count']++"}-->
			</li>
		</foreach>
	</ul>
</div>
<br />]]></template_content>
      <template_name>orderProgress</template_name>
      <template_data>$curStep, $maxStep, $steps, $invoiceId</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="showSteps:|:$showSteps">
	{parse template="orderProgress" group="nexus_payments" params="4, 4, $invoice->getOrderProgress(), $invoice->id"}
	<h1 class='ipsType_pagetitle'>{$this->lang->words['checkout_finished']}</h1>
	<br />
</if>
<div class='ipsBox'>
	<if test="instructions2:|:!empty( $instructions )">
		<div style='float: left; width: 49%'>
	</if>
			<div class='ipsBox_container ipsPad'>
				<h2 class='ipsType_subtitle'>{$this->lang->words['checkout_thanks']}</h2><br />
				<strong>{$this->lang->words['checkout_pending_1']}</strong><br />
				{$this->lang->words['checkout_pending_2']} {parse expression="sprintf( $this->lang->words['checkout_review'], "<a href='{parse url="app=nexus&amp;module=clients" base="public"}' title='{$this->lang->words['goto_client_area']}'>{$this->lang->words['client_area_']}</a>")"}
				<br /><br />
				{$this->lang->words['checkout_thanks_2']}
			</div>
	<if test="instructions3:|:!empty( $instructions )">
		</div>
		
		<div style='float: right; width: 50%'>
			<div class='ipsBox_container ipsPad'>
				<h2 class='ipsType_subtitle'>{$this->lang->words['checkout_instructions']}</h2><br />
				{$instructions}
			</div>
		</div>
	</if>
		
	<br class='clear' />
</div>
<if test="allowCancel:|:$allowCancel">
	<fieldset class='submit'>
		{parse expression="sprintf( $this->lang->words['cancel_transaction'], "<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=cancelWaiting&amp;id={$invoice->id}&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel'>{$this->lang->words['cancel_transaction_link']}</a>" )"}
	</fieldset>
</if>]]></template_content>
      <template_name>payment_onhold</template_name>
      <template_data>$invoice, $instructions, $showSteps=TRUE, $allowCancel=FALSE</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$this->lang->words['gv_redeem']}</h1>
<br />
<if test="hasError:|:$error">
	<p class='message error'>{$error}</p>
	<br />
</if>
<form action="{parse url="app=nexus&amp;module=payments&amp;do=do_redeem" base="public"}" method="post">
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<div class='ipsBox'>
		<div class='ipsBox_container ipsPad clearfix'>
			<ul class='ipsForm ipsForm_vertical'>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['gv_redeem_code']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<input class='input_text' name='code' value='{$this->request['code']}' />
					</div>
				</li>
			</ul>
		</div>
	</div>
	<fieldset class='submit'>
		<input type='submit' value='{$this->lang->words['gv_redeem']}' class='input_submit' />
	</fieldset>
</form>]]></template_content>
      <template_name>redeem</template_name>
      <template_data>$error</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse js_module="register"}
<form action="{parse url="app=core&amp;module=global&amp;section=register" base="public"}" method="post" name="REG" id='register'>
	<input type='hidden' name='nexus_pass' value='1' />
	<div id='register_form'>
		{parse template="registerStepBar" group="register" params="array()"}
		<if test="haserror:|:$error">
			<p class='message error'>{$error}</p>
			<br />
		</if>
		<h1 class='maintitle'>{$this->lang->words['ready_register']}</h1>
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad'>
				<fieldset class='{parse striping="register"}'>
					<p class='message unspecific'>
						{$this->lang->words['nexusreg_blurb_1']}
						<if test="forceBuy:|:! $this->settings['nexus_reg_force']"><br /><em class='desc'>{$this->lang->words['nexusreg_blurb_2']}</em></if>
					</p>
					<ul>
						<foreach loop="packages:$packages as $packageID => $package">
							<li class='field checkbox'>
								<input type='checkbox' name='cm_package[]' value='{$packageID}' {$package['checked']} /> &nbsp;&nbsp;{$package['p_name']} - {$this->lang->formatMoney( $package['p_base_price'] )}  <if test="renewalTerms:|:$package['renewal']">({$this->lang->words['renewal_prefix']} {$package['renewal']})</if><br />
								<span class='desc' style='padding-left:50px'>{$package['blurb']}</span>
							</li>
						</foreach>
					</ul>
				</fieldset>
				<br />
				<fieldset>
					<input type='submit' class='ipsButton' id='register_submit' value='{$this->lang->words['register']}' />
				</fieldset>
			</div>
		</div>
	</div>
</form>]]></template_content>
      <template_name>regForm32</template_name>
      <template_data><![CDATA[$packages, $error='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{parse expression="sprintf( $this->lang->words['review_product'], $package['p_name'] )"}</h1>
<br />
<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=save_review" base="public"}' method='post'>
	<input type='hidden' name='id' value='{$package['p_id']}' />
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<div class='ipsBox'>
		<div class='ipsBox_container ipsPad'>
			<ul class='ipsForm ipsForm_vertical'>
				<li class='ipsField ipsField_select'>
					<label class='ipsField_title'>{$this->lang->words['review_rating']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						<select name='rating'>
							<option value='0'>{$this->lang->words['review_select']}</option>
							<foreach loop="ratingRange:range( 1, 5 ) as $r">
								<option value='{$r}' <if test="ratingSelected:|:$this->request['rating'] == $r">selected='selected'</if>>{parse expression="sprintf( $this->lang->words['rating_outof'], $r, 5 )"}</option>
							</foreach>
						</select><br />
						<span class='error'>{$errors['rating']}</span>
					</div>
				</li>
				<li class='ipsField'>
					<label class='ipsField_title'>{$this->lang->words['review_review']} <span class='ipsForm_required'>*</span></label>
					<div class='ipsField_content'>
						{$editor}<br />
						<span class='error'>{$errors['review']}</span>
					</div>
				</li>
			</ul>
		</div>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['review_save']}' />
	</fieldset>
</form>]]></template_content>
      <template_name>reviewForm</template_name>
      <template_data>$package, $editor, $errors</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<php>
$address = $invoice->customer->data['cm_address_2'] ? $invoice->customer->data['cm_address_1'] . '<br />' . $invoice->customer->data['cm_address_2'] : $invoice->customer->data['cm_address_1'];
$state = $invoice->customer->data['cm_state'] ? $invoice->customer->data['cm_state'] . '<br />' : '';
</php>
<script type='text/javascript' src='{$this->settings['js_base_url']}js/ips.nexus.checkout.js'></script>
{parse template="orderProgress" group="nexus_payments" params="3, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<h1 class='ipsType_pagetitle'>{$this->lang->words['checkout_pay']}</h1>
<br />
<if test="error:|:$error">
	<p class='message error'>
		{$error}
	</p>
	<br />
</if>
<div class='ipsBox clearfix'>
	<div class='ipsLayout ipsLayout_withright ipsLayout_hugeright'>
		<div class='ipsLayout_content'>
			<div class='ipsBox_container ipsPad'>
			<h2 class='ipsType_subtitle'>{$this->lang->words['personal_info']} <span class='ipsType_smaller'>(<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;step=1" base="{$this->settings['nexus_https']}"}'>Change?</a>)</span></h2>
			<br />
				{$invoice->customer->data['cm_first_name']} {$invoice->customer->data['cm_last_name']}<br />
				{$address}<br />
				{$invoice->customer->data['cm_city']}<br />
				{$state}
				{$invoice->customer->data['cm_zip']}<br />
				{$this->lang->words[ 'nc_' . $invoice->customer->data['cm_country'] ]}
			<br />
			<table id='order_review'>
				<foreach loop="items:$items as $item">
					<tr>
						<td>
							<strong>
								<if test="groupedDiscount:|:$item['app'] == 'nexus' and $item['type'] == 'grdiscount'">
									<span data-tooltip="{parse expression="sprintf( $this->lang->words['grdiscount_explain'], $item['grdetails']['item_data']['itemName'], $item['grdetails']['parent_name'] )"}">{$item['itemName']}</span>
								<else />
									{$item['itemName']}
								</if>
							</strong>
						</td>
						<td>x {$item['quantity']}</td>
						<td style='text-align: right'>{parse currency="$item['line']"}</td>
					</tr>
				</foreach>
			</table>
			<br />
			<table id='cart_totals' style='width: 50%' class='right'>
				<if test="discount:|:$discount">
					<tr>
						<td>{$discount}% {$this->lang->words['store_bundle_discount']}</td>
						<td>- {parse currency="$difference"}</td>
					</tr>
				</if>
				<tr>
					<td>{$this->lang->words['store_subtotal']}</td>
					<td>{parse currency="$subtotal"}</td>
				</tr>
				<if test="shipping:|:$shipping">
					<tr>
						<td>{$this->lang->words['store_shipping']}</td>
						<td>{parse currency="$shipping"}</td>
					</tr>
				</if>
				<if test="tax:|:$tax">
					<tr>
						<td>{$this->lang->words['store_tax']}</td>
						<td>{parse currency="$tax"}</td>
					</tr>
				</if>
				<tr class='total'>
					<td>{$this->lang->words['store_total']}</td>
					<td>{parse currency="$invoice->total"}</td>
				</tr>
				<if test="previousTransactions:|:$previousTransactions">
					<tr>
						<td>{$this->lang->words['split_already_paid']}</td>
						<td>{parse currency="$previousTransactions"}</td>
					</tr>
					<tr class='total'>
						<td>{$this->lang->words['split_left_to_pay']}</td>
						<td>{parse currency="$invoice->total - $previousTransactions"}</td>
					</tr>
				</if>
			</table>
			<br class='clear' />
			<if test="showCoupons:|:$showCoupons">
				<div class='extra'>
					<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=coupon&amp;id={$invoice->id}" base="{$this->settings['nexus_https']}"}' method='post'>
						<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
						<if test="useCoupon:|:!$this->request['use_coupon']">
							<span id='coupon'>
								<img src='{$this->settings['img_url']}/nexus/coupon.png' alt='{$this->lang->words['icon']}' /> <a href='#'>{$this->lang->words['checkout_coupon']}</a>
							</span>
						</if>
						<span id='use_coupon' <if test="displayCoupon:|:!$this->request['use_coupon']">style='display: none'</if>>
							{$this->lang->words['checkout_coupon_code']} <input type='text' size='20' name='code' class='input_text' /> <input type='submit' class='input_submit alt' value='{$this->lang->words['checkout_coupon_apply']}' />
						</span>
					</form>
				</div>
			</if>
			</div>
		</div>
		<div class='ipsLayout_right'>
			<if test="totalZero2:|:$invoice->total - $previousTransactions == 0">
				<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}" base="{$this->settings['nexus_https']}"}' method='post'>
					<input type='hidden' name='do' value='zero' />
					<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
					<div class='ipsBox_container ipsPad'>
						<h2 class='ipsType_subtitle'>{$this->lang->words['checkout_cp_confirm']}</h2>
						<br />
						<if test="tacCheckbox:|:$this->settings['nexus_tac'] == 'checkbox'">
							<label for='tac-checkbox'><input type='checkbox' id='tac-checkbox' /> {parse expression="sprintf( $this->lang->words['checkout_terms_checkbox'], "{$this->settings['nexus_tac_link']}" )"}</label>
						</if>
						<if test="tacButton:|:$this->settings['nexus_tac'] == 'button'">
							<span class='desc'>{parse expression="sprintf( $this->lang->words['checkout_terms_button'], "{$this->settings['nexus_tac_link']}" )"}</span>
						</if>
						<br />
						<br />
					</div>
					<fieldset class='submit' id='confirm'>
						<input type='submit' value='{$this->lang->words['checkout_confirm']}' class='input_submit' style='font-size: 14px'/>
						&nbsp; {$this->lang->words['or']} &nbsp;
						<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>
					</fieldset>
				</form>
			<else />
				<form action='{parse url="app=nexus&amp;module=payments&amp;section=receive&amp;do=validate" base="{$this->settings['nexus_https']}"}' method='post' id='do_pay' onsubmit='return nexusCheckout.submitForm( {$transaction['t_id']} )'>
					<input type='hidden' name='nexusinvoice' value='{$invoice->id}' />
					<input type='hidden' name='transid' id='transid' value='0' />
					<input type='hidden' name='hidden_field' id='hidden_field' value='' />
					<div class='ipsBox_container ipsPad'>
						<h2 class='ipsType_subtitle clearfix'><span class='left'>{$this->lang->words['checkout_cp_pay']}</span><span class='right'>{parse currency="$transaction['t_amount']"}</h2>
						<br />
						<if test="hasCredit:|:$this->memberData['cm_credits'] and $canUseCredit">
							<p class='message' style='margin-bottom: 10px'>
								{parse expression="sprintf( $this->lang->words['store_credit'], "{parse currency="$this->memberData['cm_credits']"}")"} <a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=credit&amp;id={$invoice->id}&amp;secure_key={$this->member->form_hash}" base="public"}'>{$this->lang->words['checkout_credit']}</a>
							</p>
						</if>
						
						<div id='method_dropdown'>
							<strong>{$this->lang->words['checkout_method']}</strong>
							
							<div style='margin-top: 5px; margin-bottom: 6px'>
								<select name='method_id' class='input_select' id='payment_toggle'>
									<option value='--'>{$this->lang->words['checkout_type_select']}</option>
									<foreach loop="methods:$methods as $method">
										<option value='{$method['m_id']}'>{$method['m_name']}</option>
									</foreach>
								</select>
							</div>
							
							<if test="splitPayments:|:$this->settings['nexus_split_payments'] != -1 and $invoice->total >= $this->settings['nexus_split_payments']"><a href='#' id='split_popup_link' class='ipsType_smaller'>{$this->lang->words['split_payment']}</a></if>
						</div>
												
						<div id='methods'>
							<foreach loop="method:$methods as $method">
								<div id='method_pane_{$method['m_id']}' class='method' style='display: none'>
									<div class='pad' id='method_contents_{$method['m_id']}'>
			
									</div>
								</div>
							</foreach>
						</div>
		
						<if test="tacCheckbox:|:$this->settings['nexus_tac'] == 'checkbox'">
							<div id='tac'>
								<label for='tac-checkbox'><input type='checkbox' id='tac-checkbox' /> {parse expression="sprintf( $this->lang->words['checkout_terms_checkbox'], "{$this->settings['nexus_tac_link']}" )"}</label>
							</div>
						</if>
		
						<if test="tacButton:|:$this->settings['nexus_tac'] == 'button'">
							<br />
							<span class='desc'>{parse expression="sprintf( $this->lang->words['checkout_terms_button'], "{$this->settings['nexus_tac_link']}" )"}</span>
							<br />
						</if>
						<br />
					</div>
					<fieldset class='submit' id='confirm'>
						<input id='pay_submit' type='submit' value='{$this->lang->words['checkout_confirm']}' class='input_submit' style='font-size: 14px'/>
						&nbsp; {$this->lang->words['or']} &nbsp;
						<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>
						<if test="doubleClick:|:$this->memberData['userAgentKey'] == 'explorer' AND $this->memberData['userAgentVersion'] < 10">
							<br /><br />
							{$this->lang->words['checkout_doubleclick']}
						</if>
					</fieldset>
				</form>
			</if>
		</div>
	</div>
</div>
<div class='popupWrapper' id='split_popup' style='display:none'>
	<div class='popupInner'>
		<h3>{$this->lang->words['split_payment']}</h3>
		<div class='ipsPad'>
			<p class='ipsType_text'>{$this->lang->words['split_payments_desc']}</p>
			<br />
			<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}" base="{$this->settings['nexus_https']}"}' method='post'>
				<input id='split_amount' class='input_text' name='split' /> <input type='submit' class='input_submit' value='{$this->lang->words['split_payments_go']}' />
			</form>
			<br />
		</div>
	</div>
</div>

<script type='text/javascript'>
	ipb.lang['checkout_nomethod'] = "{$this->lang->words['checkout_nomethod']}";
	ipb.lang['checkout_accept_terms'] = "{$this->lang->words['checkout_accept_terms']}";
	
	$('split_amount').defaultize( "{$this->lang->words['split_payments_label']}" );
	
	function doPopUp( e, elem )
	{
		new ipb.Popup('split-popup', { type: 'modal', stem: true, attach: { target: elem, position: 'auto' }, hideAtStart: false, w: '500px', initial: $('split_popup').innerHTML } );
	}
	
	ipb.delegate.register('#split_popup_link', doPopUp );
	if( $('coupon') )
	{
		$('coupon').observe('click', function(e){
			Event.stop(e);
			$('coupon').hide();
			$('use_coupon').show();
		});
	}
	if( $('payment_toggle') )
	{
		$('payment_toggle').observe('change', function(e){
			Event.stop(e);
			if( $('method_pane_' + $('payment_toggle').value) )
			{
				toggleMethod( $('payment_toggle').value );
			}
		});
	}
	
	function toggleMethod( id )
	{
		$('methods').select('.method').invoke('hide');
		new Ajax.Request( "{parse url="app=nexus&module=ajax&section=store" base="{$this->settings['nexus_https']}"}&invoice={$invoice->id}&method=" + id + "&transid={$transaction['t_id']}&secure_key={$this->member->form_hash}",
		{
			onSuccess: function( t )
			{
				\$('transid').value = t.responseJSON['transid'];
				if ( t.responseJSON['error'] )
				{
					alert( t.responseJSON['error'] );
				}
				if( t.responseJSON['html'] )
				{
					\$( 'method_contents_'  + id ).innerHTML = t.responseJSON['html'];
					new Effect.BlindDown( $('method_pane_' + id ), { duration: 0.4 } );
				}
				if( t.responseJSON['formUrl'] )
				{
					\$('do_pay').action = t.responseJSON['formUrl'];
				}
				if( t.responseJSON['js'] )
				{
					eval( t.responseJSON['js'] );
				}
				if( t.responseJSON['button'] )
				{
					\$('confirm').innerHTML = t.responseJSON['button'];
					
					$('cancel_order').observe('click', function(e){
						if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
						{
							Event.stop(e);
						}
					});
				}
				else
				{
					var doubleClick = "";
					
					if ( Prototype.Browser.IE && parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5)) < 10 )
					{
						var doubleClick = "<br /><br />{$this->lang->words['checkout_doubleclick']}";
					}
				
					\$('confirm').innerHTML = "<input id='pay_submit' type='submit' value='{$this->lang->words['checkout_confirm']}' class='input_submit' style='font-size: 14px'/> &nbsp; {$this->lang->words['or']} &nbsp; <a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>" + doubleClick;
					
					$('cancel_order').observe('click', function(e){
						if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
						{
							Event.stop(e);
						}
					});
				}
			}
		});
	}
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
	
	<if test="paymentMethods:|:count( $methods ) == 1">
		<foreach loop="methodJs:$methods as $method">
			$('payment_toggle').value = {$method['m_id']};
			toggleMethod( {$method['m_id']} );
		</foreach>
		$('method_dropdown').hide();
	</if>
</script>]]></template_content>
      <template_name>selectMethod</template_name>
      <template_data>$invoice, $items, $subtotal, $tax, $shipping, $discount, $difference, $methods, $error, $showCoupons, $maxStep, $transaction, $previousTransactions, $canUseCredit=TRUE</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<script type='text/javascript'>
	var _countriesWithStates = [];
	<foreach loop="statesJs:$states as $k => $v">
		_countriesWithStates["{$k}"] = 1;
	</foreach>
</script>
{parse template="orderProgress" group="nexus_payments" params="2, $maxStep, $invoice->getOrderProgress(), $invoice->id"}
<h1 class='ipsType_pagetitle'>{$this->lang->words['checkout_shipmethods']}</h1>
<br />
<div class='ipsBox'>
	<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=shipping_address" base="{$this->settings['nexus_https']}"}' method='post'>
		<input type='hidden' name='id' value='{$invoice->id}' />
		<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
		<div class='ipsBox_container ipsPad'>
			<h3>{$this->lang->words['shipping_address']}</h3>
			<br />
			
			<if test="invalidAddress:|:in_array( 'address_verify', $errors )">
				<p class='message error'>{$this->lang->words['shipping_api_address_fail']}</p>
				<br />
			</if>
			
			<ul class='ipsForm ipsForm_horizontal'>
				<li class='ipsField clearfix'>
					<label for='cm_first_name' class='ipsField_title'>
						{$this->lang->words['cm_first_name']}
						&nbsp;<span class='ipsForm_required'>*</span>
					</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_first_name' name='cm_first_name' maxlength='255' value='{$shipAddress['cm_first_name']}' class='input_text' />
						<if test="fnError:|:in_array( 'cm_first_name', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_first_name' class='ipsField_title'>
						{$this->lang->words['cm_last_name']}
						&nbsp;<span class='ipsForm_required'>*</span>
					</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_last_name' name='cm_last_name' maxlength='255' value='{$shipAddress['cm_last_name']}' class='input_text' />
						<if test="lnError:|:in_array( 'cm_last_name', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_address_1' class='ipsField_title'>
						{$this->lang->words['cm_address']}
						&nbsp;<span class='ipsForm_required'>*</span>
					</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_address_1' name='cm_address_1' maxlength='255' value='{$shipAddress['cm_address_1']}' class='input_text' />
						<if test="a1Error:|:in_array( 'cm_address_1', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_address_2' class='ipsField_title'>&nbsp;</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_address_2' name='cm_address_2' maxlength='255' value='{$shipAddress['cm_address_2']}' class='input_text' />
						<if test="a2Error:|:in_array( 'cm_address_2', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_city' class='ipsField_title'>
						{$this->lang->words['cm_city']}
						&nbsp;<span class='ipsForm_required'>*</span>
					</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_city' name='cm_city' maxlength='255' value='{$shipAddress['cm_city']}' class='input_text' />
						<if test="cError:|:in_array( 'cm_city', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField ipsField_select'>
					<label for='cm_state'  class='ipsField_title'>
						{$this->lang->words['cm_state']}
						<span class='ipsForm_required' id='state-required' style='display:none'>&nbsp;*</span>
					</label>
					<div class='ipsField_content'>
						<input type='text' class='input_text' id='text-states' size='25' name='cm_state' value='{$shipAddress['cm_state']}' />
						<foreach loop="statesSelect:$states as $country => $_states">
							<select name='_cm_state' id='{$country}-states' class='input_select' style='display:none'>
								<foreach loop="states:$_states as $s">
									{parse variable="selected" default="" oncondition="$s[0] == $shipAddress['cm_state']" value=" selected='selected'"}
									<option value='{$s[0]}'{parse variable="selected"}>{$s[1]}</option>
								</foreach>
							</select>
						</foreach>
						<if test="sError:|:in_array( 'cm_state', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</div>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_zip' class='ipsField_title'>
						{$this->lang->words['cm_zip']}
						&nbsp;<span class='ipsForm_required'>*</span>
					</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_zip' name='cm_zip' maxlength='255' value='{$shipAddress['cm_zip']}' class='input_text' />
						<if test="zError:|:in_array( 'cm_zip', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField ipsField_select'>
					<label for='cm_country' class='ipsField_title'>{$this->lang->words['cm_country']}</label>
					<div class='ipsField_content'>
						<select name='cm_country' id='cm_country' onchange='states()'>
							<foreach loop="countries:$countries as $k => $v">
								<option value='{$k}' <if test="selectedCountry:|:$k == $shipAddress['cm_country']">selected='selected'</if>>{$v}</option>
							</foreach>
						</select>
						<if test="coError:|:in_array( 'cm_country', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</div>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_phone' class='ipsField_title'>
						{$this->lang->words['cm_phone']}
					</label>
					<p class='ipsField_content'>
						<input type='text' id='cm_phone' name='cm_phone' maxlength='255' value='{$shipAddress['cm_phone']}' class='input_text' />
						<if test="pError:|:in_array( 'cm_phone', $errors )">
							<span class='error'>{$this->lang->words['err_cart_cf_required']}</span>
						</if>
					</p>
				</li>
				<li class='ipsField clearfix'>
					<label for='cm_phone' class='ipsField_title'>
						&nbsp;
					</label>
					<p class='ipsField_content'>
						<input type='submit' value="{$this->lang->words['checkout_update_shipping']}" class='ipsButton_secondary' />
					</p>
				</li>
				
			</ul>
		</form>
			
			<br /><br />
		
		<form action='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;do=shipping" base="{$this->settings['nexus_https']}"}' method='post'>
			<input type='hidden' name='id' value='{$invoice->id}' />
			<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
			<h3>{$this->lang->words['checkout_ship_select']}</h3>
			<p style='padding:10px'>
				{$this->lang->words['checkout_ship_blurb_1']}<br />
				{$this->lang->words['checkout_ship_blurb_2']}<br /><br />
			</p>
			<foreach loop="groups:$data['groupedItems'] as $groupID => $_items">
				<div class='ship_select'>
					<select name='shipping[$groupID]'>
					<foreach loop="methods:$data['shipping'] as $id => $_methods">
						<if test="group:|:$id == $groupID">
							<foreach loop="options:$_methods as $k => $v">
								{parse variable="selected" default="" oncondition="$data['selected'][ $groupID ] == $k" value="selected='selected'"}
								<option value='{$k}' {parse variable="selected"}>{$v}</option>
							</foreach>
						</if>
					</foreach>
					</select>
					<ul class='bullets'>
						<foreach loop="items:$_items as $item">
							<li>{$item['itemName']}</li>
						</foreach>
					</ul>
				</div>
			</foreach>
		</div>
		<fieldset class='submit'>
			<input type='submit' value='{$this->lang->words['checkout_continue']}' class='input_submit' />&nbsp;&nbsp; {$this->lang->words['or']} <a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}&amp;do=cancel&amp;secure_key={$this->member->form_hash}" base="public"}' class='cancel' id='cancel_order'>{$this->lang->words['cancel']}</a>
		</fieldset>
	</form>
</div>
<script type='text/javascript'>
	if( $('cancel_order') )
	{
		$('cancel_order').observe('click', function(e){
			if( !confirm("{$this->lang->words['checkout_cancel_confirm']}") )
			{
				Event.stop(e);
			}
		});
	}
	
	function states()
	{
		var s = $('text-states').value.toLowerCase();
		var c = $('cm_country').value;
		if ( c in _countriesWithStates )
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( c + '-states' ).style.display = '';
			$( c + '-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'inline';
			
			_display = c + '-states';
			$( c + '-states' ).select('option').each ( function ( elem ) {
				if ( elem.value.toLowerCase() == s || elem.innerHTML.toLowerCase() == s )
				{
					elem.selected = true;
				}
			} );
		}
		else
		{
			$( _display ).style.display = 'none';
			$( _display ).name = '_state';
			
			$( 'text-states' ).style.display = '';
			$( 'text-states' ).name = 'cm_state';
			
			$( 'state-required' ).style.display = 'none';
			
			_display = 'text-states';
		}
	}
	
	var _display = 'text-states';
	states();
</script>]]></template_content>
      <template_name>selectShipping</template_name>
      <template_data>$invoice, $shipAddress, $states, $countries, $data, $maxStep, $member, $errors</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$title}</h1>
<br />
<div class='ipsLayout ipsLayout_withleft ipsLayout_withright ipsLayout_largeright'>
	<div class='ipsLayout_left'>
		<div class='general_box'>
			<h3>{$this->lang->words['store_categories']}</h3>
			<ul style='padding: 6px;'>
				{parse template="cat_menu_item" group="nexus_payments" params="$packageGroups[0], $hierarchy"}
			</ul>
		</div>
		<if test="giftVouchers:|:$this->settings['nexus_gift_vouchers']">
			<br />
			<div class='general_box'>
				<h3>{$this->lang->words['gift_vouchers']}</h3>
				<ul style='padding: 6px;'>
					<li><img src='{$this->settings['img_url']}/nexus/gifts.png' /> <a href='{parse url="app=nexus&amp;module=payments&amp;do=vouchers" base="public" template="gift_vouchers" seotitle="gift_vouchers"}'>{$this->lang->words['gv_buy']}</a></li>
					<li><img src='{$this->settings['img_url']}/nexus/gifts.png' /> <a href='{parse url="app=nexus&amp;module=payments&amp;do=redeem" base="public" template="redeem" seotitle="redeem"}'>{$this->lang->words['gv_redeem']}</a></li>
				</ul>
			</div>
		</if>
	</div>
	<div class='ipsLayout_right'>
		<div class='general_box clearfix'>
			<h3>{$this->lang->words['store_cart']}</h3>
			{parse template="cart_sidebar" group="nexus_payments" params="$cart"}
		</div>
		<if test="hasCredits:|:$this->memberData['cm_credits']">
			<div class='message unspecific' style='margin-top: 10px'>
				{parse expression="sprintf( $this->lang->words['store_credit'], "{parse currency="$this->memberData['cm_credits']"}")"}
			</div>
		</if>
	</div>
	
	<div class='ipsLayout_content'>
		
			<div class='maintitle ipsFilterbar clearfix'>
				<if test="catId:|:!$cat['pg_id']">
					<ul class='ipsList_inline left'>
						<if test="showFeatured:|:$featured">
							<li <if test="active:|:$this->request['featured'] || !$this->request['featured'] && !$this->request['popular'] && !$this->request['latest']">class='active'</if>>
								<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;featured=1&amp;view={$this->request['view']}" base="public" template="store-featured" seotitle="featured"}' title='{$this->lang->words['store__featured']}'>{$this->lang->words['store_featured']}</a>
							</li>
						</if>
						<li <if test="popular:|:$this->request['popular']">class='active'</if>>
							<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;popular=1&amp;view={$this->request['view']}" base="public" template="store-popular" seotitle="popular"}' title='{$this->lang->words['store__popular']}'>{$this->lang->words['store_popular']}</a>
						</li>
						<li <if test="popular:|:$this->request['latest']">class='active'</if>>
							<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;latest=1&amp;view={$this->request['view']}" base="public" template="store-latest" seotitle="latest"}' title='{$this->lang->words['store__latest']}'>{$this->lang->words['store_latest']}</a>
						</li>
					</ul>
				<else />
					{$cat['pg_name']}
				</if>
				<if test="viewSwitch:|:$this->settings['nexus_store_viewswitch']">
					<ul class='ipsList_inline right'>
						<li>{$this->lang->words['store_view']}</li>
						<li <if test="viewList:|:$this->request['view'] == 'list'">class='active'</if>>
							<if test="catId2:|:!$cat['pg_id']">
								<if test="$this->request['featured'] || !$this->request['featured'] && !$this->request['popular'] && !$this->request['latest']">
									<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;featured=1&amp;view=list" base="public" template="store-featured" seotitle="featured"}'>{$this->lang->words['store_view_list']}</a>
								<else />
									<if test="latest:|:$this->request['latest']">
										<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;latest=1&amp;view=list" base="public" template="store-latest" seotitle="latest"}'>{$this->lang->words['store_view_list']}</a>
									<else />
										<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;popular=1&amp;view=list" base="public" template="store-popular" seotitle="popular"}'>{$this->lang->words['store_view_list']}</a>
									</if>
								</if>
							<else />
								<a href='{parse url="app=nexus&amp;module=payments&amp;cat={$cat['pg_id']}&amp;view=list&amp;st={$this->request['st']}" base="public" template="storecat" seotitle="{$cat['pg_seo_name']}"}'>{$this->lang->words['store_view_list']}</a>
							</if>
						</li>
						<li <if test="viewGrid:|:$this->request['view'] == 'grid'">class='active'</if>>
							<if test="catId3:|:!$cat['pg_id']">
								<if test="$this->request['featured'] || !$this->request['featured'] && !$this->request['popular'] && !$this->request['latest']">
									<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;featured=1&amp;view=grid" base="public" template="store-featured" seotitle="featured"}'>{$this->lang->words['store_view_grid']}</a>
								<else />
									<if test="latest2:|:$this->request['latest']">
										<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;latest=1&amp;view=grid" base="public" template="store-latest" seotitle="latest"}'>{$this->lang->words['store_view_grid']}</a>
									<else />
										<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;popular=1&amp;view=grid" base="public" template="store-popular" seotitle="popular"}'>{$this->lang->words['store_view_grid']}</a>
									</if>
								</if>
							<else />
								<a href='{parse url="app=nexus&amp;module=payments&amp;cat={$cat['pg_id']}&amp;view=grid&amp;st={$this->request['st']}" base="public" template="storecat" seotitle="{$cat['pg_seo_name']}"}'>{$this->lang->words['store_view_grid']}</a>
							</if>
						</li>
					</ul>
				</if>
			</div>
		
		<div class='ipsBox' <if test="gridCenter:|:$this->request['view'] == 'grid'">style='text-align:center'</if>>
			<if test="noPackages:|:empty( $packages )">
				<p class='no_messages'>
					{$this->lang->words['store_empty']}
				</p>
			<else />
				<foreach loop="packages:$packages as $packageID => $package">
					<if test="whichView:|:$this->request['view'] == 'grid'">
						{parse template="storeGridView" group="nexus_payments" params="$package"}
					<else />
						{parse template="storeListView" group="nexus_payments" params="$package"}
					</if>
				</foreach>
			</if>
		</div>
		
		{$pagination}
		
	</div>
</div>]]></template_content>
      <template_name>showStore</template_name>
      <template_data>$packages, $packageGroups, $hierarchy, $cart, $title, $featured, $pagination, $cat</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<div class='ipsPad' style='display: inline-block;'>
	<div class='ipsBox_container ipsPad' style='text-align:center; width: {parse expression="( $this->settings['nexus_thumb_width'] + 80 )"}px; height: {parse expression="( $this->settings['nexus_thumb_height'] + 80 )"}px;'>
		<div style='height: {$this->settings['nexus_thumb_height']}px;'>
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'><img src='{$package['thumbnail']}' {IPSLib::getTemplateDimensions( $package['thumbnail'], $this->settings['nexus_thumb_width'], $this->settings['nexus_thumb_height'] )} /></a><br />
		</div>
		<br />
		<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>
			<if test="longName:|:strlen( $package['p_name'] ) > 27">
				{parse expression="IPSText::truncate( $package['p_name'], 27 )"}
			<else />
				{$package['p_name']}
			</if>
		</a><br />
		<br />
		<span class='price'>{$this->lang->formatMoney( $package['p_base_price'] )}</span><br />
		<if test="renewalTerms:|:$package['renewal']">
			<span class='renew desc'>{$package['renewal']}</span>
		<else />
			&nbsp;
		</if>
	</div>
</div>]]></template_content>
      <template_name>storeGridView</template_name>
      <template_data>$package</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<div class='ipsBox_container ipsPad storeList'>
	<if test="thumbnail:|:$package['thumbnail']"><a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'><img class='left ipsPad' src='{$package['thumbnail']}' {IPSLib::getTemplateDimensions( $package['thumbnail'], $this->settings['nexus_thumb_width'], $this->settings['nexus_thumb_height'] )}/></a></if>
	
	<div class='right ipsPad' style='text-align: center; min-width: 100px'>
		<span class='price'>{$this->lang->formatMoney( $package['p_base_price'] )}</span>
		<if test="renewalTerms:|:$package['renewal']">
			<br />
			<span class='renew desc'>{$package['renewal']}</span>
		</if>
		<br /><br />
		<if test="addToCart:|:$package['p_stock']">
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=add&amp;id={$package['p_id']}&amp;k={$this->member->form_hash}&amp;ref=store" base="public"}' class='input_submit'>{$this->lang->words['store_add']}</a>
		<else />
			<span class='desc lighter'>{$this->lang->words['store_nostock']}</span>
		</if>
	</div>
	
	<h2 class='ipsType_subtitle'><a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>{$package['p_name']}</a></h2>
	<if test="stock:|:$this->settings['nexus_show_stock'] and $package['p_stock'] and $package['p_stock'] != -1">
		<p class='desc'>{$package['p_stock']} {$this->lang->words['in_stock']}</p>
	</if>
	<br />
	
	<if test="description:|:$package['p_desc']">
		{$package['blurb']}
	</if>
	
	
	<br class='clear' />
</div>
<br />]]></template_content>
      <template_name>storeListView</template_name>
      <template_data>$package</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<if test="thumbnail:|:$r['thumbnail']">
	<span class='icon'>
		<img class='left' src='{$r['thumbnail']}' {IPSLib::getTemplateDimensions( $r['thumbnail'], $this->settings['nexus_thumb_width'], $this->settings['nexus_thumb_height'] )} />
	</span>
</if>
<div class='result_info'>
	<h3><a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$r['p_id']}" base="public" template="storeitem" seotitle="{$r['p_seo_name']}"}'>{$r['p_name']}</a></h3>
	<p>{$r['blurb']}</p>
</p>
</div>]]></template_content>
      <template_name>storeSearch</template_name>
      <template_data>$r</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse template="orderProgress" group="nexus_payments" params="4, 4, $invoice->getOrderProgress(), $invoice->id"}
<h1 class='ipsType_pagetitle'>{$this->lang->words['checkout_finished']}</h1>
<br />
<div class='ipsBox'>
	<if test="instructions2:|:!empty( $instructions )">
		<div style='float: left; width: 49%'>
	</if>
			<div class='ipsBox_container ipsPad'>
				<h2 class='ipsType_subtitle'>{$this->lang->words['checkout_thanks']}</h2><br />
				{$this->lang->words['checkout_approved']}
				
				<ul id='package_list' class='nexus_block_list'>
					<foreach loop="purchases:$invoice->getPurchases() as $i">
						{parse template="purchaseRow" group="nexus_clients" params="$i, array(), array()"}
					</foreach>
				</ul>
			</div>
	<if test="instructions3:|:!empty( $instructions )">
		</div>
		
		<div style='float: right; width: 50%'>
			<div class='ipsBox_container ipsPad'>
				<h2 class='ipsType_subtitle'>{$this->lang->words['checkout_instructions']}</h2><br />
				{$instructions}
			</div>
		</div>
	</if>
	<br class='clear' />
</div>
<if test="isPaid:|:$invoice->status != 'paid'">
	<fieldset class='submit'>
		<a href='{parse url="app=nexus&amp;module=payments&amp;section=pay&amp;id={$invoice->id}" base="public"}' class='input_submit'>{$this->lang->words['split_payments_go']}</a>
	</fieldset>
</if>]]></template_content>
      <template_name>thanks</template_name>
      <template_data>$invoice, $instructions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<p class='message'>
	{$this->lang->words['cart_added']}{$added['p_name']}
	<a href='{parse url="app=nexus&amp;module=payments&amp;section=store" base="public" template="app=nexus" seotitle="nexus"}' class='right'>{$this->lang->words['cart_continue']} {$this->lang->words['_rarr']}</a>
	<br class='clear' />
</p>
<br />
<h1 class='ipsType_pagetitle'>{$this->lang->words['store_upsell']}</h1>
<br />
<div class='ipsLayout ipsLayout_withright ipsLayout_largeright'>
	<div class='ipsLayout_right'>
		<div class='general_box clearfix'>
			<h3>{$this->lang->words['store_cart']}</h3>
			{parse template="cart_sidebar" group="nexus_payments" params="$cart"}
		</div>
	</div>
	
	<div class='ipslayout_content'>
	
		<div class='ipsBox'>
			<foreach loop="packages:$packages as $packageID => $package">
				<div class='ipsBox_container ipsPad'>
				
					<if test="thumbnail:|:$package['thumbnail']"><a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id=$packageID" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'><img class='left' src='{$package['thumbnail']}' {IPSLib::getTemplateDimensions( $package['thumbnail'], $this->settings['nexus_thumb_width'], $this->settings['nexus_thumb_height'] )} /></a></if>
					
					<div class='right ipsPad' style='text-align: center; width: 100px'>
						<span class='price'>{$this->lang->formatMoney( $package['p_base_price'] )}</span>
						<if test="renewalTerms:|:$package['renewal']">
							<br />
							<span class='renew desc'>{$package['renewal']}</span>
						</if>
						<br /><br />
						<if test="addToCart:|:$package['p_stock']">
							<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=add&amp;id=$packageID&amp;k={$this->member->form_hash}&amp;ref=store" base="public"}' class='input_submit'>{$this->lang->words['store_add']}</a>
						<else />
							<span class='desc lighter'>{$this->lang->words['store_nostock']}</span>
						</if>
					</div>
					
					<h2 class='ipsType_subtitle'><a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id=$packageID" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>{$package['p_name']}</a></h2>
					<if test="stock:|:$this->settings['nexus_show_stock'] and $package['p_stock'] and $package['p_stock'] != -1">
						<p class='desc'>{$package['p_stock']} {$this->lang->words['in_stock']}</p>
					</if>
					<br />
					
					<if test="description:|:$package['p_desc']">
						{$package['blurb']}
					</if>
					
					
					<br style='clear:left' />
				
				</div>
				<br />
			</foreach>
		</div>
	
	</div>
</div>]]></template_content>
      <template_name>upsell</template_name>
      <template_data>$added, $packages, $cart</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[<h1 class='ipsType_pagetitle'>{$this->lang->words['store_cart']}</h1>
<br />
<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=update_cart" base="public"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<table class='ipb_table'>
		<tr class='header'>
			<th style='width: 70px'>{$this->lang->words['cart_qty']}</th>
			<th colspan='2'>{$this->lang->words['cart_desc']}</th>
			<th style='width: 20%' class='short'>{$this->lang->words['cart_unit']}</th>
			<th style='width: 20%; text-align: right'>{$this->lang->words['cart_line']}</th>
		</tr>
		<if test="items:|:count( $cart['items'] )">
			<foreach loop="cartitems:$cart['items'] as $id => $i">
				<tr>
					<td style='width: 15%'>
						<if test="hasFields:|:!isset( $i['_cfields'] )">
							<input type='hidden' name='_qty[{$i['k']}]' value='{$i['qty']}' />
							<input type='text' class='input_text' value='{$i['qty']}' name='qty[{$i['k']}]' size='2' />&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=remove&amp;id={parse expression="implode(',',$i['ids'])"}&amp;k={$this->member->form_hash}" base="public"}' class='cancel' style='font-size: 10px'>{$this->lang->words['cart_remove']}</a>
						<else />
							<span class='desc'>{$i['qty']}</span>
						</if>
					</td>
					<if test="image:|:$i['packageData']['thumbnail']">
						<td style='width: 60px' class='short'>
							<img src="{$i['packageData']['thumbnail']}" class='left' {parse resize_image="{$i['packageData']['thumbnail']}" maxwidth="60" maxheight="60"} />
						</td>
						<td>
					<else />
						<td colspan='2'>
					</if>
						<h3 style='margin: 0; padding: 0'>{$i['name']}</h3>
					</td>
					<td class='short'>
						<if test="unitPrice:|:!isset( $i['_cfields'] )">
							{$i['unit_price']}
						</if>
					</td>
					<td style='text-align: right; padding-right: 10px;'>
						<if test="linePrice:|:!isset( $i['_cfields'] )">
							<strong>{parse currency="$i['line_price']"}</strong>
						</if>
					</td>
				</tr>
				<if test="listCfields:|:isset( $i['_cfields'] )">
					<foreach loop="cfields:$i['_cfields'] as $k => $v">
						<tr>
							<td style='width: 15%'>
								<input type='hidden' name='_qty[{$k}]' value='{parse expression="count($i['_qty'][$k])"}' />
								<input type='text' class='input_text' value='{parse expression="count($i['_qty'][$k])"}' name='qty[{$k}]' size='2' />&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=remove&amp;id={parse expression="implode(',',$i['_qty'][$k])"}&amp;k={$this->member->form_hash}" base="public"}' class='cancel' style='font-size: 10px'>{$this->lang->words['cart_remove']}</a>
							</td>
							<td style='padding-left: 30px'>
								<img src='{$this->settings['img_url']}/nexus/sub_package.png' alt='|-' />
							</td>
							<td>
								<em>{$v}</em>
							</td>
							<td class='short'>
								{$i['unit_prices'][$k]}
							</td>
							<td style='text-align: right; padding-right: 10px;'>
								<strong>{$i['line_prices'][$k]}</strong>
							</td>
						</tr>
					</foreach>
				</if>
				<if test="extraItemsCheck:|:isset( $i['extraItems'] )">
					<foreach loop="extraItemsLoop:$i['extraItems'] as $item">
						<tr>
							<td style='width: 15%'>
								&nbsp;
							</td>
							<td style='padding-left: 30px'>
								<img src='{$this->settings['img_url']}/nexus/sub_package.png' alt='|-' />
							</td>
							<td>
								<em>{$item['itemName']}</em>
							</td>
							<td class='short'>
								{parse currency="$item['cost']"}
							</td>
							<td style='text-align: right; padding-right: 10px;'>
								<strong>{parse currency="$item['cost'] * $item['quantity']"}</strong>
							</td>
						</tr>
					</foreach>
				</if>
			</foreach>
		<else />
			<tr>
				<td colspan='4'>
					<em>{$this->lang->words['store_cart_empty']}</em>
				</td>
			</tr>
		</if>
	</table>
	<br />
	<div class='left' style='text-align:center'>
		<input type='submit' class='input_submit alt' value='{$this->lang->words['cart_update']}' /></form><br /><br />
		<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=empty&amp;k={$this->member->form_hash}" base="public"}' class='cancel' style='font-size: 10px; text-decoration: none'>{$this->lang->words['store_cart_clear']}</a>
	</div>
	<div class='right'>
		<table id='cart_totals'>
			<if test="discount:|:$cart['discount']">
				<tr>
					<td>{$cart['discount']}% {$this->lang->words['store_bundle_discount']}</td>
					<td>{parse currency="-$cart['difference']"}</td>
				</tr>
			</if>
			<if test="showTax:|:!$this->settings['nexus_show_tax']">
				<tr>
					<td>{$this->lang->words['store_subtotal']}</td>
					<td>{parse currency="$cart['subtotal']"}</td>
				</tr>
				<tr>
					<td>{$this->lang->words['store_tax']}</td>
					<td>{parse currency="$cart['tax']"}</td>
				</tr>
				<tr class='total'>
					<td>{$this->lang->words['store_total']}</td>
					<td>{parse currency="$cart['total']"}</td>
				</tr>
			<else />
				<tr class='total'>
					<td>{$this->lang->words['store_total']}</td>
					<td>{parse currency="$cart['total']"}</td>
				</tr>
			</if>
		</table>
		<br />
		<p class='right'>
			<a href='{parse url="app=nexus&amp;module=payments&amp;section=store" base="public" template="app=nexus" seotitle="nexus"}'>{$this->lang->words['cart_continue']}</a>&nbsp; {$this->lang->words['or']} &nbsp;<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=checkout&amp;k={$this->member->form_hash}" base="public"}' class='input_submit' style='font-size: 13px'>{$this->lang->words['store_checkout']}</a>
		</p>
	</div>
</form>]]></template_content>
      <template_name>viewCart</template_name>
      <template_data>$cart</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_payments</template_group>
      <template_content><![CDATA[{parse template="include_lightbox" group="global" params=""}
<script type='text/javascript'>
	var options = Array();
	var addtocart = '<input type="submit" value="{$this->lang->words['store_add']}" class="input_submit">';
	var nostock = "<span class='out_of_stock'><em>{$this->lang->words['store_nostock']}</em></span>";
	var optionsExpanded = false;
	
	function expandOptions()
	{
		if ( optionsExpanded == true )
		{
			$('product-form').submit();
		}
		else
		{
			new Effect.BlindDown( $('options' ), { duration: 0.4 } );
			optionCheck();
		
			optionsExpanded = true;
		}
	}
	
	function selectImage( location, dims )
	{
		$('main_image').innerHTML = "<a href='{$this->settings['upload_url']}/"+location+"' rel='lightbox' target='_blank'><img src='{$this->settings['upload_url']}/"+location+"' "+dims+" /></a><br />";
	}
	
	function optionCheck()
	{
		var saveOptions = Array();
		for ( var foo = 0; foo <= options.length; foo++ )
		{
			if ( options[foo] != undefined && $('f_'+ options[foo] ) != undefined )
			{
				saveOptions[ options[foo] ] = options[foo] + ':' + $('f_'+ options[foo] ).value;
			}
		}
				
		new Ajax.Request( ipb.vars['base_url'] + "app=nexus&module=ajax&section=optioncheck&secure_key={$this->member->form_hash}",
		{
			evalJSON: 'force',
			parameters:
	    	{
	    		package: {$package['p_id']},
	    		options: saveOptions.join(','),
	    		renew_term: ( $('renew-options-select') ) ? $('renew-options-select').value : null,
	    	},
			onSuccess: function( t )
			{
				if ( t.responseJSON['error'] )
				{
					alert( t.responseJSON['error'] );
				}
				else
				{
					if ( t.responseJSON['stock'] == 0 )
					{
						if ( inStock )
						{
							new Effect.Fade( $('add-to-cart'), {duration: 0.2, afterFinish: function () { $('add-to-cart').innerHTML = nostock; new Effect.Appear( $('add-to-cart'), { duration: 0.4 } ) } } );
						}
						inStock = 0;
					}
					else
					{
						if ( !inStock )
						{
							new Effect.Fade( $('add-to-cart'), {duration: 0.2, afterFinish: function () { $('add-to-cart').innerHTML = addtocart; new Effect.Appear( $('add-to-cart'), { duration: 0.4 } ) } } );
						}
						inStock = 1;
												
						if ( $('base-price').innerHTML.replace(/\s/g, "") != t.responseJSON['base_price'].replace(/\s/g, "") )
						{
							$('base-price').innerHTML = t.responseJSON['base_price'];
							Effect.Pulsate( $('base-price'), { pulses: 2, duration: 0.5 } );
						}
																								
						if ( $('original-price') != null && $('original-price').innerHTML.replace(/\s/g, "") != t.responseJSON['original_price'].replace(/\s/g, "") )
						{
							$('original-price').innerHTML = t.responseJSON['original_price'];
							Effect.Pulsate( $('original-price'), { pulses: 2, duration: 0.5 } );
						}
												
						if ( $('renew-terms').innerHTML.replace(/\s/g, "") != t.responseJSON['renew_terms'].replace(/\s/g, "") )
						{
							$('renew-terms').innerHTML = t.responseJSON['renew_terms'];
							Effect.Pulsate( $('renew-terms'), { pulses: 2, duration: 0.5 } );
						}
					}
				}
				
			}
		});
	}
	
	function reviewRate( id, rating )
	{
		new Ajax.Request( ipb.vars['base_url'] + "app=nexus&module=ajax&section=reviewrate&secure_key={$this->member->form_hash}",
		{
			parameters:
	    	{
	    		review: id,
	    		rating: rating
	    	},
			onSuccess: function( t )
			{
				$( 'review-helpful-' + id ).innerHTML = "{$this->lang->words['review_vote_thanks']}";
			}
		});
	}
	
</script>
<div class='ipsLayout ipsLayout_withright ipsLayout_largeright'>
	<div class='ipsLayout_right'>
		<div class='general_box clearfix'>
			<h3>{$this->lang->words['store_cart']}</h3>
			{parse template="cart_sidebar" group="nexus_payments" params="$cart"}
		</div>
	</div>
	<div class='ipsLayout_content'>
		<div class='ipsBox'>
			<div class='ipsBox_container ipsPad clearfix'>
				<if test="noImages:|:!empty($images)">
					<div class='ipsLayout ipsLayout_withleft ipsLayout_largeleft'>
						<div class='ipsLayout_left' style='text-align: center'>
							<div id='main_image'>
								
							</div>
							<foreach loop="images:$images as $image">
								<if test="moreThanOneImage:|:count($images) > 1">
									<span onclick="selectImage('{$image['image_location']}','{$image['image_dims']}')" class='clickable'><img src="{$this->settings['upload_url']}/{$image['image_location']}" {parse resize_image="{$this->settings['upload_url']}/{$image['image_location']}" maxwidth="50" maxheight="50"} /></span>
								</if>
								<if test="imageIsPrimary:|:$image['image_primary']">
									<script type='text/javascript'>
										selectImage('{$image['image_location']}','{$image['image_dims']}');
									</script>
								</if>
							</foreach>
						</div>
						<div class='ipsLayout_content'>
				</if>
							<h1 class='ipsType_pagetitle'>{$package['p_name']}</h1>
							<if test="reviewable:|:$package['p_reviewable']">
								<foreach loop="ratingRange:range( 1, 5 ) as $r">
									<if test="ratingIsOn:|:$rating['avg'] >= $r">
										{parse replacement="rate_on"}
									<else />
										{parse replacement="rate_off"}
									</if>
								</foreach>
								<a href='#reviews' class='desc'>({parse expression="sprintf( $this->lang->words['number_of_reviews'], $rating['count'] )"}<if test="bought:|:$bought != 'NO_PURCHASE'"> &middot; <a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=review_write&amp;id={$package['p_id']}" base="public"}'>{$this->lang->words['write_a_review']}</a></if>)</a>
							</if>
							<br /><br />
							<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=add" base="public"}' method='post' enctype='multipart/form-data' id='product-form'>
								<input type='hidden' name='id' value='{$package['p_id']}' />
								<input type='hidden' name='k' value='{$this->member->form_hash}' />
								<input type='hidden' name='ref' value='item' />
								<div id='options'>
									<if test="cfields:|:!empty($customfields)">
										<br /><br />
										<div class='fields'>
											<ul>
												<foreach loop="fields:$customfields as $f">
													<script type='text/javascript'>options[ options.length + 1 ] = {$f->id};</script>
													<li class='field'>
														<label for='f_{$f->id}'><strong>{$f->name}</strong> <if test="isRequired:|:$f->required"><span class='required'>{$this->lang->words['store_required']}</span></if></label>
														{$f->edit( TRUE, 'optionCheck()' )}
													</li>
												</foreach>
											</ul>
										</div>
									</if>
									{$extra}
									<if test="associates:|:!empty($associate)">
										<br /><br />
										<h3>{$this->lang->words['store_associate']}</h3>
										<div class='fields'>
											<if test="assocError:|:$errors['assoc']">
												<p class='message error'>{$errors['assoc']}</p><br />
											</if>
											<ul>
												<li class='field'>
													<select name='assoc' class='input_select'>
														<foreach loop="associates:$associate as $a">
															<option value="{$a['bought']}.{$a['id']}">{$a['name']}<if test="hasSticky:|:$a['cf']"> ({$a['cf']})</if></option>
														</foreach>
													</select>
												</li>
											</ul>
										</div>
									</if>
									<br /><br />
									
								</div>
								<if test="discountedPrice:|:$package['_original_price'] != $package['p_base_price']">
									<span class='ipsType_small original_price'><strike id='original-price'>{$this->lang->formatMoney( $package['_original_price'], FALSE )}</strike></span>&nbsp;&nbsp;
								</if>
								<span class='price' id='base-price'>{$this->lang->formatMoney( $package['p_base_price'] )}</if>
								</span> <span class='desc lighter'>{$this->settings['nexus_tax_explain']}</span>
									<if test="renewalTerms:|:!empty( $renewOptions )">
									&nbsp;
									<div class='renew desc'>
										{$this->lang->words['store_renewal']}
										<span id='renew-terms'>
											<if test="singleRenewOption:|:count( $renewOptions ) == 1">
												{$package['renewal']}
											<else />
												<select name="renewals" onchange="optionCheck()" id="renew-options-select">
													<foreach loop="renewOptions:$renewOptions as $k => $v">
														<option value="{$k}">{$v}</option>
													</foreach>
												</select>
											</if>
										</span>
									</div>
								</if>
								&nbsp;
								<span id='add-to-cart'>
									<if test="stock:|:$package['p_stock']">
										<script type='text/javascript'>var inStock = 1;</script>
										<if test="moreToShow:|:!empty($customfields) or !empty($associate) or $extra">
											<input id='expandOptionsButton' type="button" value="{$this->lang->words['store_add']}" class="input_submit" onclick="expandOptions()" style='display:none'>
											<input id='submitButton' type="submit" value="{$this->lang->words['store_add']}" class="input_submit">
										<else />
											<input type="submit" value="{$this->lang->words['store_add']}" class="input_submit">
										</if>
									<else />
										<script type='text/javascript'>var inStock = 0;</script>
										<span class='out_of_stock'><em>{$this->lang->words['store_nostock']}</em></span>
									</if>
								</span>
								<if test="stock:|:$this->settings['nexus_show_stock'] and $package['p_stock'] and $package['p_stock'] != -1">
									<p class='desc'>{$package['p_stock']} {$this->lang->words['in_stock']}</p>
								</if>
							</form>
							<br />
							<br />
							{$package['p_desc']}<br />
							<br />
							<br />
						</div>
			<if test="noImages2:|:!empty($images)">
					</div>
				</div>
			</if>
		</div>
		<if test="canShare:|:$this->settings['sl_enable']">
			<div class='ipsPad'>
				{$shareLinks}
			</div>
		</if>
		<if test="haveReviews:|:$package['p_reviewable'] and $reviews">
			<br /><br />
			<a name='reviews'><h2 class='ipsType_subtitle'>{$this->lang->words['review_reviews']}</h2></a><br />
			<div class='maintitle ipsFilterbar clearfix'>
				<ul class='ipsList_inline ipsType_smaller'>
					<li <if test="sortHelpful:|:$this->request['rs_by'] == 'review_useful' and $this->request['rs_order'] == 'desc'">class='active'</if>>
						<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}&amp;st={$this->request['st']}&amp;rs_by=review_useful&amp;rs_order=desc" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>{$this->lang->words['review_sort_helpful']}</a>
					</li>
					<li <if test="sortLatest:|:$this->request['rs_by'] == 'comment_date' and $this->request['rs_order'] == 'desc'">class='active'</if>>
						<a href='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}&amp;st={$this->request['st']}&amp;rs_by=comment_date&amp;rs_order=desc" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}'>{$this->lang->words['review_sort_latest']}</a>
					</li>
					<li <if test="sortCustom:|:$this->request['rs_by'] == 'review_rating' or $this->request['rs_order'] == 'asc'">class='active'</if>>
						<a href='#custom_menucontent' id='custom'>{$this->lang->words['review_sort_custom']}</a>
					</li>
				</ul>
			</div>
			<div id='custom_menucontent' class='ipbmenu_content ipsPad'>
				<form action='{parse url="app=nexus&amp;module=payments&amp;section=store&amp;do=item&amp;id={$package['p_id']}" base="public" template="storeitem" seotitle="{$package['p_seo_name']}"}' method='post'>
					<strong>{$this->lang->words['review_sort_by']}</strong><br />
					<select name='rs_by'>
						<option value='review_useful' <if test="optionHelpful:|:$this->request['rs_by'] == 'review_useful'">selected='selected'</if>>{$this->lang->words['review_sort__helpful']}</option>
						<option value='comment_date' <if test="optionLatest:|:$this->request['rs_by'] == 'comment_date'">selected='selected'</if>>{$this->lang->words['review_sort__date']}</option>
						<option value='review_rating' <if test="optionRating:|:$this->request['rs_by'] == 'review_rating'">selected='selected'</if>>{$this->lang->words['review_sort__rating']}</option>
					</select>
					<br /><br />
					<strong>{$this->lang->words['review_sort_order']}</strong><br />
					<select name='rs_order'>
						<option value='asc' <if test="sortAsc:|:$this->request['rs_order'] == 'asc'">selected='selected'</if>>{$this->lang->words['review_sort__asc']}</option>
						<option value='desc' <if test="sortDesc:|:$this->request['rs_order'] == 'desc'">selected='selected'</if>>{$this->lang->words['review_sort__desc']}</option>
					</select>
					<br /><br />
					<input type="submit" value="{$this->lang->words['review_sort_submit']}" class="input_submit" />
				</form>
			</div>
			<script type='text/javascript'>
				new ipb.Menu( $('custom'), $('custom_menucontent'), { stopClose: true } );
			</script>
			<div class='ipsBox'>
				{$reviews}
			</div>
		</if>
	</div>
</div>
<if test="notAdding:|:$this->request['do'] != 'add'">
	<script type='text/javascript'>
	// In case they don't have javascript enabled, we hide the options with javascript
	if ( $('options') )
	{
		$('options').style.display = 'none';
	}
	if ( $('submitButton') )
	{
		$('submitButton').style.display = 'none';
	}
	if ( $('expandOptionsButton') )
	{
		$('expandOptionsButton').style.display = 'inline';
	}
	</script>
</if>]]></template_content>
      <template_name>viewItem</template_name>
      <template_data>$package, $customfields, $associate, $extra, $cart, $shareLinks, $images, $reviews, $rating, $bought, $renewOptions</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
  <templategroup group="skin_nexus_support">
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<php>
	$parent = $p['ps_parent'];
	$dashes = 0;
	while ( $parent != 0 )
	{
		$dashes ++;
		$parent = $packages[ $parent ]['ps_parent'];
	}
	
	if ( $dashes )
	{
		$p['ps_name'] = str_repeat( '- ', $dashes ) . $p['ps_name'];
	}
</php>
<option value='{$p['ps_id']}'<if test="disabled:|:$p['disabled']"> disabled='disabled'<else /><if test="selected:|:$p['ps_id'] == $selected"> selected='selected'</if></if>>{$p['ps_name']}</option>
<if test="hasChildren:|:is_array( $parentMap[ $p['ps_id'] ] )">
	<foreach loop="children:$parentMap[ $p['ps_id'] ] as $child">
		{parse template="_packageSelect" group="nexus_support" params="$packages[ $child ], $selected, $parentMap, $packages"}
	</foreach>
</if>]]></template_content>
      <template_name>_packageSelect</template_name>
      <template_data>$p, $selected, $parentMap, $packages</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<if test="inAcp:|:IN_ACP">
	<style type='text/css'>		
.swfupload {
	position: absolute;
	z-index: 1;
}
	
#attachments { }
	#attachments li {
		background-color: #e4ebf2;
		border: 1px solid #d5dde5;
		padding: 6px 20px 6px 42px;
		margin-bottom: 10px;
		position: relative;
	}
	
		#attachments li p.info {
			color: #69727b;
			font-size: 0.8em;
			width: 300px;
		}
	
		#attachments li .links, #attachments li.error .links, #attachments.traditional .progress_bar {
			display: none;
		}
			
			#attachments li.complete .links {
				font-size: 0.9em;
				margin-right: 15px;
				right: 0px;
				top: 12px;
				display: block;
				position: absolute;
			}
			
		#attachments li .progress_bar {
			margin-right: 15px;
			width: 200px;
			right: 0px;
			top: 15px;
			position: absolute;
		}
	
		#attachments li.complete, #attachments li.in_progress, #attachments li.error {
			background-repeat: no-repeat;
			background-position: 12px 12px;
		}
	
		#attachments li.in_progress {
			background-image: url({$this->settings['public_dir']}style_images/master/loading.gif);
		}
	
		#attachments li.error {
			background-image: url({$this->settings['public_dir']}style_images/master/exclamation.png);
			background-color: #e8caca;
			border: 1px solid #ddafaf;
		}
		
			#attachments li.error .info {
				color: #8f2d2d;
			}
	
		#attachments li.complete {
			background-image: url({$this->settings['public_dir']}style_images/master/accept.png);
		}
		
		#attachments li .thumb_img {
			left: 6px;
			top: 6px;
			width: 30px;
			height: 30px;
			overflow: hidden;
			position: absolute;
		}
/*div.post_form fieldset.attachments span.desc {
	margin: 0 0 0 15px;
	display: inline;
	clear: none;
}*/
.attach_controls {
	background: url( {$this->settings['public_dir']}style_images/master/icon_attach.png ) no-repeat 3px;
	padding-left: 35px;
	min-height: 82px;
}
	.attach_controls .ipsType_subtitle { margin-bottom: 5px; }
	.attach_controls iframe { display: block; margin-bottom: 5px; }
	
.attach_button { font-weight: bold;  }
#help_msg {	margin-top: 8px; }
#attach_wrap {
	background: #eef3f8;
	padding: 6px;
	margin-top: 8px;
}
	#attach_wrap h4 {
		font-size: 1em;
		font-weight: bold;
	}
	
	#attach_wrap li {
		margin: 5px 6px;
		float: left;
	}
		
		#attach_wrap .desc.info {
			margin-left: 24px;
		}
		
.ipsButton_secondary {
	height: 22px;
	line-height: 22px;
	font-size: 12px;
	color: #7c7c7c;
	padding: 0 10px;
	background: #f6f6f6;
	background: -moz-linear-gradient(top, #f6f6f6 0%, #e5e5e5 100%); /* firefox */
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f6f6f6), color-stop(100%,#e5e5e5)); /* webkit */
	border: 1px solid #dbdbdb;
	-moz-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-webkit-box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	box-shadow: 0px 1px 0px rgba(255,255,255,1) inset, 0px 1px 0px rgba(0,0,0,0.3);
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	color: #616161;
	display: inline-block;
	white-space: nowrap;
}
	.ipsButton_secondary:hover {
		color: #4c4c4c;
		border-color: #9a9a9a;
	}
	</style>
	
	<script type='text/javascript' src='{$this->settings['board_url']}/cache/lang_cache/{$this->lang->lang_id}/ipb.lang.js'></script>
	<script type='text/javascript'>
		var backup = ipb.vars['base_url'];
		ipb.vars['base_url']	= ipb.vars['front_url'];
		ipb.vars['upload_url']	= "{$this->settings['upload_url']}";
	</script>
	<if test="backup1:|:$backup = $this->settings['base_url']">
		<if test="backup2:|:$this->settings['base_url'] = $this->settings['board_url'] . '/index.php?'"></if>
	</if>
<else />
	<if test="nexusHttps:|:$this->settings['nexus_https'] == 'https'">
		<script type='text/javascript'>
			ipb.vars['base_url'] = ipb.vars['base_url'].replace( 'http://', 'https://' );
		</script>
	</if>
</if>
<if test="attachButton:|:$this->lang->words['attach_button'] = $this->lang->words['nexus_attach_button']"></if>
<fieldset class='attachments'>
	{parse template="uploadForm" group="post" params="$data['post_key'], 'support', $data['stats'], 0"}
</fieldset>
<if test="inAcp2:|:IN_ACP">
	<script type='text/javascript'>
		//ipb.vars['base_url']	= backup;
	</script>
	<if test="backup3:|:$this->settings['base_url'] = $backup"></if>
</if>]]></template_content>
      <template_name>attachments</template_name>
      <template_data>$data=array()</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<div class='ipsPad'>
	<div class='topic_buttons'>
		<ul>
			<li><a href='{parse url="app=nexus&amp;module=support&amp;section=new" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['new_request']}</a>
		</ul>
	</div>
	<h1 class='ipsType_pagetitle'>{$this->lang->words['support_requests']}</h1>
	<br />
	
	{parse striping="tickets" classes="row1,row2"}
	<table class='ipb_table topic_list'>
		<tr class='header'>
			<th>&nbsp;</th>
			<th>{$this->lang->words['support_title']}</th>
			<th>{$this->lang->words['support_last_reply']}</th>
			<th>{$this->lang->words['support_status']}</th>
		</tr>
		<if test="requests:|:count( $requests )">
			<foreach loop="requests:$requests as $request">
				<tr class='__topic <if test="isUnread:|:$request['_isUnread']">unread</if>'>
					<td class='col_f_icon altrow short'><if test="isUnread2:|:$request['_isUnread']"><img src='{$this->settings['img_url']}/t_new.png' /></if></td>
					<td>
						<if test="isOpen:|:$request['r_status_open'] && !$request['r_status_locked']">
							<strong><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="{$this->settings['nexus_https']}"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a></strong>
						<else />
							<a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}" base="{$this->settings['nexus_https']}"}' title='{$this->lang->words['support_view']}'>{$request['r_title']}</a>
						</if>
						<br />
						<span class='desc'>{$request['r_department_text']}</span>
					</td>
					<td>{parse date="$request['r_last_reply']" format="joined"}</td>
					<td>
						{$request['r_status_text']}
					</td>
				</tr>
			</foreach>
		<else />
			<tr>
				<td colspan='4' class='no_messages'>
					{$this->lang->words['support_empty']}
				</td>
			</tr>
		</if>				
	</table>
	<br />
	<if test="pagination:|:count( $requests )">
	{$pagination}
	<br />
	</if>
</div>]]></template_content>
      <template_name>customerList</template_name>
      <template_data>$requests,$pagination</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<li class='ipsField'>
	<label class='ipsField_title'>{$field->name} <if test="required:|:$field->required"><span class='ipsForm_required'>*</span></if></label>
	<div class='ipsField_content'>
		{$field->edit( TRUE )}
	</div>
</li>]]></template_content>
      <template_name>customField</template_name>
      <template_data>$field</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=support&amp;section=guests" base="{$this->settings['nexus_https']}"}' method='post'>
	<div class='ipsPad'>
		<div class='topic_buttons'>
			<ul>
				<li><a href='{parse url="app=nexus&amp;module=support&amp;section=new" base="{$this->settings['nexus_https']}"}'>{$this->lang->words['new_request']}</a>
			</ul>
		</div>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['support_requests']}</h1>
		<br />
		
		<if test="error:|:$error">
			<p class='message error'>{$error}</p>
		</if>
		<br />
		
		<p>{$this->lang->words['support_g_blurb']}</p>
		<br /><br />
		
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField'>
				<label for='email' class='ipsField_title'>{$this->lang->words['support_g_email']}</label>
				<p class='ipsField_content'>
					<input name='email' class='input_text' size='40' id='email' value='{$this->request['email']}' />
				</p>
			</li>
			<li class='ipsField'>
				<label for='key' class='ipsField_title'>{$this->lang->words['support_g_key']}</label>
				<p class='ipsField_content'>
					<input name='key' class='input_text' size='5' id='key' value='{$this->request['key']}' />
				</p>
			</li>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['support_retrieve']}' />
	</fieldset>
</form>]]></template_content>
      <template_name>guestAccess</template_name>
      <template_data>$error</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<form action='{parse url="app=nexus&amp;module=support&amp;section=new&amp;do=submit" base="{$this->settings['nexus_https']}"}' method='post'>
	<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
	<input type='hidden' name='post_key' value='{$postkey}' />
	<div class='ipsPad'>
		<h1 class='ipsType_pagetitle'>{$this->lang->words['request_info']}</h1>
		<br />
        <if test="errorsCheck:|:!empty($errors)">
            <p class='message error'>
                <foreach loop="errors:$errors as $e">
                    <if test="haveLangString:|:isset( $this->lang->words[ $e ] )">{$this->lang->words[ $e ]}<else />{$e}</if><br />
                </foreach>
            </p>
            <br /><br />
        </if>
        <if test="hostingProblemsCheck:|:!empty($hostingProblems)">
            <p class='message'>
				{$this->lang->words['hosting_problems']}<br />
                <foreach loop="hostingProblems:$hostingProblems as $s">
                    {$s}<br />
                </foreach>
            </p>
            <br /> <br />
        </if>
		<ul class='ipsForm ipsForm_vertical'>
			<if test="guest:|:!$this->memberData['member_id']">
				<li class='ipsField'>
					<label for='email' class='ipsField_title'>{$this->lang->words['support_g_email']} <span class='ipsForm_required'>*</span></label>
					<p class='ipsField_content'><input name='email' class='input_text' size='40' id='email' value='{$this->request['email']}' /></p>
				</li>
			</if>
			<li class='ipsField'>
				<label for='title' class='ipsField_title'>{$this->lang->words['support_title']} <span class='ipsForm_required'>*</span></label>
				<p class='ipsField_content'><input name='title' class='input_text' size='40' id='title' value='{$this->request['title']}' /></p>
			</li>
			<li class='ipsField isField_select'>
				<label for='department' class='ipsField_title'>{$this->lang->words['support_department']} <span class='ipsForm_required'>*</span></label>
				<div class='ipsField_content'>
					<select name='department' id='department' onchange='departmentChange();'>
						<option value='0'>{$this->lang->words['select_box_select']}</option>
						<foreach loop="departments:$availableDepartments as $department">
							<option value='{$department['dpt_id']}'<if test="departmentSelected:|:$this->request['department'] == $department['dpt_id']"> selected='selected'</if>>{$department['dpt_name']}</option>
						</foreach>
					</select>
				</div>
			</li>
			<if test="severity:|:!$this->memberData['cm_no_sev']">
				<if test="justOne:|:count($severities)==1">
					<foreach loop="severitiesOne:$severities as $s">
						<input type='hidden' name='severity' value='{$s['sev_id']}' />
					</foreach>
				<else />
					<li class='ipsField ipsField_select'>
						<label for='severity' class='ipsField_title'>{$this->lang->words['support_severity']}</label>
						<div class='ipsField_content'>
							<if test="sev2:|:count($severities)==2">
								<foreach loop="severitiesTwo:$severities as $s">
									<if test="sevDefault:|:!$s['sev_default']">
										<input type='checkbox' name='severity' value='{$s['sev_id']}'<if test="sevChecked:|:$this->request['severity'] == $s['sev_id']"> checked='checked'</if> /> {$s['sev_name']}
									</if>
								</foreach>
							<else />
								<select name='severity'>
									<foreach loop="severities:$severities as $s">
										<option value='{$s['sev_id']}' <if test="sevSelected:|:( !$this->request['severity'] and $s['sev_default'] ) or ( $this->request['severity'] == $s['sev_id'] )">selected='selected'</if> >{$s['sev_name']}</option>
									</foreach>
								</select>
							</if>
							<if test="sevBlurb:|:$this->settings['nexus_severity_blurb']">
								<br /><span class='desc'>{$this->settings['nexus_severity_blurb']}</span>
							</if>
						</div>
					<li>
				</if>
			</if>
			<li id='package-select' class='ipsField ipsField_select' style='display:none'>
				{$itnitialPackageSelect}
			</li>
			<li id='ppi-message' class='ipsField' style='display:none'>
				
			</li>
			<li class='ipsField' id='main-field'>
				<label class='ipsField_title'>{$this->lang->words['support_message']} <span class='ipsForm_required'>*</span></label>
				<div class='ipsField_content'>
					{$editor}
					{$attachments}
				</div>
			</li>
			<div id='custom-fields'>
			
			</div>
			<if test="captcha:|:$captchaHTML">
				{$captchaHTML}
			</if>
		</ul>
	</div>
	<fieldset class='submit'>
		<input type='submit' class='input_submit' value='{$this->lang->words['support_submit']}' />&nbsp;&nbsp;{$this->lang->words['or']}&nbsp;&nbsp;<a href='{parse url="app=nexus&amp;module=support" base="{$this->settings['nexus_https']}"}' title='{$this->lang->words['cancel']}' class='cancel'>{$this->lang->words['cancel']}</a>
	</fieldset>
</form>
<script type='text/javascript'>
	var ppiLang = "{$this->lang->words['support_ppi_message']}";
	
	function departmentChange()
	{
		new Ajax.Request( ipb.vars['base_url'] + "app=nexus&module=ajax&section=support&do=get-package-options&department=" + $('department').value + "&secure_key={$this->member->form_hash}&selected={$this->request['package']}",
			{
				parameters: {
					cfields: '{$cfields}'
				},
				onSuccess: function( t )
				{
					if ( t.responseJSON['ppi']  )
					{
						\$('package-select').style.display = 'none';
						\$('custom-fields').innerHTML = '';
						\$('main-field').style.display = 'none';
						\$('ppi-message').style.display = '';
						
						\$('ppi-message').innerHTML = "<p class='message'>" + ppiLang.replace( '{PPI_AMOUNT}', t.responseJSON['ppi'] ) + "</p>";
					}
					else
					{
						\$('main-field').style.display = '';
						\$('ppi-message').style.display = 'none';
						
						if ( t.responseJSON['packageSelect'] )
						{								
							\$('package-select').innerHTML = t.responseJSON['packageSelect'];
							if ( t.responseText )
							{
								\$('package-select').style.display = '';
							}
						}
						else
						{
							\$('package-select').style.display = 'none';
						}
						
						\$('custom-fields').innerHTML = t.responseJSON['customFields'];
					}
				}
			});
	}
	
	<if test="departmentChange:|:$this->request['department']">
		departmentChange();
	</if>
	
</script>]]></template_content>
      <template_name>newRequest</template_name>
      <template_data><![CDATA[$availableDepartments, $severities, $editor, $attachments, $postkey, $captchaHTML, $errors, $hostingProblems, $cfields='']]></template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<label for='package' class='ipsField_title'>{$this->lang->words['support_package']}</label>
<div class='ipsField_content'>
	<select name='package'>
		<option value='0'>{$this->lang->words['select_box_select']}</option>
		<if test="hasChildren:|:is_array( $parentMap[0] )">
			<foreach loop="children:$parentMap[0] as $id">
				{parse template="_packageSelect" group="nexus_support" params="$packages[ $id ], $selected, $parentMap, $packages"}
			</foreach>
		</if>
	</select>
</div>]]></template_content>
      <template_name>packageSelect</template_name>
      <template_data>$packages, $selected, $parentMap</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<if test="disablelightbox:|:!$this->settings['disable_lightbox']">
{parse template="include_lightbox" group="global" params=""}
</if>
{parse js_module="rating"}
<div class='ipsPad'>
	<div class='ipsSideBlock ipsPad right' style='width: 23%; border: 1px solid #dbe4ef;'>
		<ul class='ipsForm ipsForm_vertical'>
			<li class='ipsField'>
				<p class='ipsField_title'>{$this->lang->words['support_id']}</p>
				<p class='ipsField_content'>{$request['r_id']}</p>
			</li>
			<li class='ipsField'>
				<if test="statuses:|:!empty($setableStatuses)">
					<a href='#' id='set-status' class='ipsButton_secondary right ipbmenu'>{$this->lang->words['support_set_status']}</a>
					<div id='set-status_menucontent' class='ipbmenu_content'>
						<ul>
							<foreach loop="statuses:$setableStatuses as $status">
								<li><a href="{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}&amp;status={$status['status_id']}&amp;secure_key={$this->member->form_hash}" base="{$this->settings['nexus_https']}"}">{$status['status_public_set']}</a></li>
							</foreach>
						</ul>
					</div>
					<script type='text/javascript'>
						new ipb.Menu( $('set-status'), $('set-status_menucontent'), { stopClose: false } );
					</script>
				</if>
				<p class='ipsField_title'>{$this->lang->words['support_status']}</p>
				<p class='ipsField_content'>
					{$request['r_status_text']}
				</p>
			</li>
			<li class='ipsField'>
				<p class='ipsField_title'>{$this->lang->words['support_started']}</p>
				<p class='ipsField_content'>{parse date="$request['r_started']" format="joined"}</p>
			</li>
			<li class='ipsField'>
				<p class='ipsField_title'>{$this->lang->words['support_last_reply']}</p>
				<p class='ipsField_content'>{parse date="$request['r_last_reply']" format="joined"}</p>
			</li>
			<li class='ipsField'>
				<p class='ipsField_title'>{$this->lang->words['support_department']}</p>
				<p class='ipsField_content'>{$request['r_department_text']}</p>
			</li>
			<if test="severity:|:$this->settings['nexus_severities']">
				<if test="statuses:|:!empty($setableSeverities)">
					<a href='#' id='set-severity' class='ipsButton_secondary right ipbmenu'>{$this->lang->words['support_set_severity']}</a>
					<div id='set-severity_menucontent' class='ipbmenu_content'>
						<ul>
							<foreach loop="statuses:$setableSeverities as $sev">
								<li><a href="{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}&amp;severity={$sev['sev_id']}&amp;secure_key={$this->member->form_hash}" base="{$this->settings['nexus_https']}"}">{$sev['sev_name']}</a></li>
							</foreach>
						</ul>
					</div>
					<script type='text/javascript'>
						new ipb.Menu( $('set-severity'), $('set-severity_menucontent'), { stopClose: false } );
					</script>
				</if>
				<li class='ipsField'>
					<p class='ipsField_title'>{$this->lang->words['support_severity']}</p>
					<p class='ipsField_content'>{$request['r_severity_text']}</p>
				</li>
			</if>
			<if test="haveNotifies:|:!empty( $request['r_notify'] )">
				<li class='ipsField'>
					<p class='ipsField_title'>{$this->lang->words['cc_list']}</p>
					<p class='ipsField_content'>
						<foreach loop="notifies:$request['r_notify'] as $cc">
							<if test="isMember:|:$cc['type'] == 'm'">
								{parse template="userHoverCard" group="global" params="$cc['value']"}
							<else />
								{$cc['value']}
							</if>
							<br />
						</foreach>
					</p>
				</li>
			</if>
		</ul>
	</div>
		
	<div class='left' style='width: 73%'>
		<h1 class='ipsType_pagetitle'>{$request['r_title']}</h1>
		<br />
		
		<if test="haveFields:|:!empty( $request['r_cfields'] )">
			<div class='ipsSideBlock' style='border: 1px solid #dbe4ef;'>
				<ul class='ipsForm ipsForm_horizontal'>
					<foreach loop="cfields:$request['r_cfields'] as $field">
						<li class='ipsField ipsField_select'>
							<p class='ipsField_title'>{$field->name}</p>
							<p class='ipsField_content' style='line-height: 1.8;'>
								{$field}
							</p>
						</li>
					</foreach>
				</ul>
			</div>
			<br /><br />
		</if>
		
		<if test="pag:|:$pagination">
			<div class='pagination'>{$pagination}</div>
			<br /><br />
		</if>
		
		<foreach loop="messages:$messages as $message">
			<div class='ipsBox_container clearfix'>
				<div class='bar'>
					<strong><if test="member:|:$message['reply_member']['member_id']">{$message['reply_member']['members_display_name']}<else /><em>{$message['reply_email']}</em></if></strong>
					<p class='right desc'>{$message['reply_date']}</p>
				</div>
				<div class='ipsPad ipsType_textblock'>
					{$message['reply_post']}
				</div>
				<if test="satisfaction:|:$message['reply_type'] == 's' and $this->memberData['member_id'] == $request['r_member'] and $this->settings['nexus_support_satisfaction']">
					<div class='ipsPad ipsType_small right'>
						{$this->lang->words['support_request_rate']}
						&nbsp;
						<a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;do=rate&amp;id={$message['reply_id']}&amp;rating=1&amp;secure_key={$this->member->form_hash}" base="public"}' id='reply_{$message['reply_id']}_rate_1' title='{$this->lang->words['top_js_1star']}'>
						<if test="rate1:|:$message['rating_rating'] >= 1">
							{parse replacement="rate_on"}
						<else />
							{parse replacement="rate_off"}
						</if>
						</a><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;do=rate&amp;id={$message['reply_id']}&amp;rating=2&amp;secure_key={$this->member->form_hash}" base="public"}' id='reply_{$message['reply_id']}_rate_2' title='{$this->lang->words['top_js_2star']}'>
						<if test="rate2:|:$message['rating_rating'] >= 2">
							{parse replacement="rate_on"}
						<else />
							{parse replacement="rate_off"}
						</if>
						</a><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;do=rate&amp;id={$message['reply_id']}&amp;rating=3&amp;secure_key={$this->member->form_hash}" base="public"}' id='reply_{$message['reply_id']}_rate_3' title='{$this->lang->words['top_js_3star']}'>
						<if test="rate3:|:$message['rating_rating'] >= 3">
							{parse replacement="rate_on"}
						<else />
							{parse replacement="rate_off"}
						</if>
						</a><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;do=rate&amp;id={$message['reply_id']}&amp;rating=4&amp;secure_key={$this->member->form_hash}" base="public"}' id='reply_{$message['reply_id']}_rate_4' title='{$this->lang->words['top_js_4star']}'>
						<if test="rate4:|:$message['rating_rating'] >= 4">
							{parse replacement="rate_on"}
						<else />
							{parse replacement="rate_off"}
						</if>
						</a><a href='{parse url="app=nexus&amp;module=support&amp;section=view&amp;do=rate&amp;id={$message['reply_id']}&amp;rating=5&amp;secure_key={$this->member->form_hash}" base="public"}' id='reply_{$message['reply_id']}_rate_5' title='{$this->lang->words['top_js_5star']}'>
						<if test="rate5:|:$message['rating_rating'] >= 5">
							{parse replacement="rate_on"}
						<else />
							{parse replacement="rate_off"}
						</if>
						</a>
						<script type='text/javascript'>
						//<!#^#|CDATA|
							rating = new ipb.rating( 'reply_{$message['reply_id']}_rate_', { 
												url: ipb.vars['base_url'] + 'app=nexus&module=ajax&section=support&do=rate&reply={$message['reply_id']}&md5check=' + ipb.vars['secure_hash'],
												cur_rating: {$message['rating_rating']},
												rated: <if test="jsHasRates:|:$message['rating_rating'] != 0">1<else />0</if>,
												allow_rate: true,
												multi_rate: 1,
												show_rate_text: false
											  } );
							
							rating._rateClick = function( e )
							{
								img = Event.findElement(e, 'a');
								
								$('rating_popup_key').value = img.id;
								ratingPopup = new ipb.Popup('rating-popup', { type: 'modal', hideAtStart: false, w: '500px', initial: $('rating_popup').innerHTML } );
							}
							rating._setUpImages();
						//|#^#]>
						</script>
					</div>
				</if>
			</div>
			<br />
		</foreach>
			
		<if test="pag2:|:$pagination">
			<br /><br />
			<div class='pagination'>{$pagination}</div>
		</if>
		
	</div>
	
	<br class='clear' />
		
	<if test="reply:|:!$statuses['statuses'][ $request['r_status'] ]['status_is_locked']">
		<h2 class='ipsType_subtitle'>{$this->lang->words['support_reply']}</h2>
		<br />
		<if test="replyErrors:|:!empty($errors)">
			<br />
			<p class='message error'>
				<foreach loop="errors:$errors as $e">
					{$this->lang->words[ $e ]}<br />
				</foreach>
			</p>
			<br />
		</if>
		<div class='post_form'>
			<form action='{parse url="app=nexus&amp;module=support&amp;section=view&amp;id={$request['r_id']}&amp;do=submit" base="{$this->settings['nexus_https']}"}' method='post'>
				<input type='hidden' name='secure_key' value='{$this->member->form_hash}' />
				<input type='hidden' name='post_key' value='{$postkey}' />
				<input type="hidden" name="fast_reply_used" value="1" />
				<input type="hidden" name="enableemo" value="yes" />
				<input type="hidden" name="enablesig" value="yes" />
				<fieldset id='form_editor'>
					{$editor}
				</fieldset>
				<fieldset class='attachments' id='attach_editor'>
					{$attachments}
				</fieldset>
				<fieldset class='submit'>
					<input type='submit' class='input_submit' id='submit_post' value='{$this->lang->words['support_reply']}' />
				</fieldset>
			</form>
		</div>
	</if>
	
</div>
<div class='popupWrapper' id='rating_popup' style='display:none'>
	<div class='popupInner'>
		<form action='{parse url="app=nexus&amp;module=support&amp;section=view&amp;do=rate_feedback&amp;id={$message['reply_id']}" base="{$this->settings['nexus_https']}"}' method='post'>
			<input type='hidden' name='reply_key' id='rating_popup_key' value='' />
			<input type='hidden' name='secure_hash' value='{$this->member->form_hash}' />
			<h3>{$this->lang->words['rating_feedback']}</h3>
			<div class='ipsPad'>
				{$this->lang->words['rating_feedback_blurb']}<br />
				<br />
				<textarea name='message' style='width: 100%' rows='5'></textarea>
			</div>
			<fieldset class='submit'>
				<input type='submit' class='input_submit' value='{$this->lang->words['rating_feedback_send']}' /> &nbsp;&nbsp;<span class='clickable cancel' onclick="ratingPopup.hide()">{$this->lang->words['rating_feedback_cancel']}</span>
			</fieldset>
		</form>
	</div>
</div>]]></template_content>
      <template_name>requestView</template_name>
      <template_data>$request, $messages, $pagination, $editor, $attachments, $postkey, $statuses, $setableStatuses, $setableSeverities, $errors</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
    <template>
      <template_group>skin_nexus_support</template_group>
      <template_content><![CDATA[<div class='ipsSideBlock clearfix'>
	<h3>{$this->lang->words['support_staff_title']}</h3>
	<div class='_sbcollapsable'>
		<div class='ipsPad'>
			<a href='{$this->settings['_admin_link']}?app=nexus&amp;module=tickets&amp;section=list' target='_blank'>{$count} {$this->lang->words['support_staff_text']}</a>
		</div>
	</div>
</div>]]></template_content>
      <template_name>sidebar</template_name>
      <template_data>$count</template_data>
      <template_removable>0</template_removable>
      <template_user_added>0</template_user_added>
      <template_user_edited>0</template_user_edited>
      <template_master_key>root</template_master_key>
    </template>
  </templategroup>
</templates>
